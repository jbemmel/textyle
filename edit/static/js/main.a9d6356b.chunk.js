(this.webpackJsonptextyle=this.webpackJsonptextyle||[]).push([[1],{77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(1),i=n.n(a),c=n(22),s=n.n(c),l=n(4),o="[TILESET] Add one",u="[TILESET] Load existing textures",d="[TILESET] Texture loading complete",h="[TILESET] Select",b="[TILESET] Update",f="[TILESET] Delete",x="[TILE] Select",j="[TOOL] Select",v="[SIDEBAR] Display",p="[TILE] Set size",m="[LAYER] Add one",O="[LAYER] Update",g="[LAYER] Delete",y="[LAYER] Select",w="[LAYER] Move",L="[LAYER] Toggle Visibility",T=function(e,t,n,r){return{type:o,payload:{name:e,tileSize:t,tilesetIndex:n,data:r}}},I=function(e,t,n){return{type:u,payload:{name:e,tileSize:t,tilesetIndex:n}}},E=function(e){return{type:h,payload:{name:e}}},S=function(e,t,n){return{type:b,payload:{name:e,tileSize:t,tilesetIndex:n}}},A=function(e){return{type:j,payload:{tool:e}}},z=function(e){return{type:v,payload:{display:e}}},C=function(e){var t=e||{},n=t.name,r=t.tileSize,a=t.x,i=t.y,c=t.width,s=t.height;return{type:m,payload:{name:n,tileSize:r,x:a,y:i,width:c,height:s}}},N=function(e,t){return{type:O,payload:{name:e,tileSize:t}}},k=function(e){return{type:y,payload:{name:e}}},R=n(19),M=n(11),P=n(16),_=n(34),U=n(33),D=n(20),F=n(21),B=n(3),Z={tilesetNames:[],tilesets:{},selectedTileset:"",selectedTile:-1,hasLoadedTextures:!1},V="DEFAULT_TOOL",X="PLACEMENT_TOOL",Y="ERASER_TOOL",H="FILL_TOOL",W="PAN_TOOL",G="MAGNIFY_TOOL",K={selectedTool:X,showSidebar:!1,tileSize:[32,32]},q={selected:"",names:[],layers:{},lastIdx:0},J=Object(P.c)({tileset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:case o:var n=t.payload,r=n.name,a=n.tileSize,i=n.tilesetIndex;return Object(B.a)(Object(B.a)({},e),{},{tilesetNames:[].concat(Object(F.a)(e.tilesetNames),[r]),tilesets:Object(B.a)(Object(B.a)({},e.tilesets),{},Object(D.a)({},r,{tileSize:a,tilesetIndex:i})),selectedTileset:r});case b:var c=t.payload,s=c.name,l=c.tileSize,j=c.tilesetIndex;if(!e.tilesetNames.includes(s))return e;var v=l||e.tilesets[s].tileSize,p=j||e.tilesets[s].tilesetIndex;return Object(B.a)(Object(B.a)({},e),{},{tilesets:Object(B.a)(Object(B.a)({},e.tilesets),{},Object(D.a)({},s,{tileSize:v,tilesetIndex:p}))});case d:return Object(B.a)(Object(B.a)({},e),{},{hasLoadedTextures:!0});case h:var m=t.payload.name;return Object(B.a)(Object(B.a)({},e),{},{selectedTileset:m});case f:var O=t.payload.name,g=e.tilesetNames.filter((function(e){return e!==O})),y=e.tilesets,w=(y[O],Object(_.a)(y,[O].map(U.a))),L=e.selectedTileset;if(L===O&&g.length>0){var T=Math.max(e.tilesetNames.indexOf(O)-1,0);L=g[T]}else 0==g.length&&(L="");return Object(B.a)(Object(B.a)({},e),{},{selectedTileset:L,tilesetNames:g,tilesets:w});case x:var I=t.payload.value;return Object(B.a)(Object(B.a)({},e),{},{selectedTile:I});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:var n=t.payload.tool;return Object(B.a)(Object(B.a)({},e),{},{selectedTool:n});case v:var r=t.payload.display;return Object(B.a)(Object(B.a)({},e),{},{showSidebar:r});case p:var a=t.payload.size;return a?Object(B.a)(Object(B.a)({},e),{},{tileSize:a}):e;default:return e}},layers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:var n=t.payload,r=n.name,a=n.tileSize;return r&&""!==r||(r="Layer ".concat(e.lastIdx+1)),Object(B.a)(Object(B.a)({},e),{},{names:[].concat(Object(F.a)(e.names),[r]),layers:Object(B.a)(Object(B.a)({},e.layers),{},Object(D.a)({},r,{id:e.lastIdx,tileSize:a,visible:!0})),selected:r,lastIdx:e.lastIdx+1});case O:var i=t.payload,c=i.name,s=i.tileSize;if(!c||""===c||!e.names.includes(c))return e;var l=e.layers[c];return Object(B.a)(Object(B.a)({},e),{},{layers:Object(B.a)(Object(B.a)({},e.layers),{},Object(D.a)({},c,{id:l.id,tileSize:s||l.tileSize,visible:l.visible}))});case g:var o=t.payload.name,u=e.layers,d=(u[o],Object(_.a)(u,[o].map(U.a))),h=e.names.filter((function(e){return e!==o})),b=e.selected;if(b===o&&h.length>0){var f=Math.max(e.names.indexOf(o)-1,0);b=h[f]}else 0===h.length&&(b="");return Object(B.a)(Object(B.a)({},e),{},{names:h,layers:d,selected:b});case y:var x=t.payload.name;return Object(B.a)(Object(B.a)({},e),{},{selected:x});case w:var j=t.payload,v=j.name,p=j.to,T=e.names.indexOf(v),I=e.names;return-1!==T&&(I.splice(T,1),I.splice(p,0,v)),Object(B.a)(Object(B.a)({},e),{},{names:I});case L:var E=t.payload.name;return Object(B.a)(Object(B.a)({},e),{},{layers:Object(B.a)(Object(B.a)({},e.layers),{},Object(D.a)({},E,Object(B.a)(Object(B.a)({},e.layers[E]),{},{visible:!e.layers[E].visible})))});default:return e}}}),Q=n(6),$=n.n(Q),ee=n(8),te="json",ne=n(18),re="lastSelectedTileset",ae=new ne.a("textures-store","textures"),ie=function(){var e=Object(ee.a)($.a.mark((function e(){var t;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ne.d)(ae);case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=Object(ee.a)($.a.mark((function e(t){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ne.c)(t,ae);case 3:return n=e.sent,e.abrupt("return",n);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=Object(ee.a)($.a.mark((function e(t,n,r){return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ne.e)(t,{file:r,tileSize:n,tilesetIndex:je.lastId},ae);case 3:return e.next=5,je.addTiles(t,n);case 5:localStorage.setItem(re,t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),le=function(){var e=Object(ee.a)($.a.mark((function e(t,n,r){var a;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue(t);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Object(ne.c)(t,ae);case 8:return a=e.sent,e.next=11,Object(ne.e)(t,{file:a.file,tileSize:n||a.tileSize,tilesetIndex:r||a.tilesetIndex},ae);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n,r){return e.apply(this,arguments)}}(),oe=function(){var e=Object(ee.a)($.a.mark((function e(t){return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ne.b)(t,ae);case 3:localStorage.getItem(re)===t&&localStorage.removeItem(re),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=Object(ee.a)($.a.mark((function e(t){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ne.d)(ae);case 3:return n=e.sent,e.abrupt("return",n.includes(t));case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=Object(ee.a)($.a.mark((function e(t,n){var r,a;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(je.lastId>0)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,ue(t);case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,je.addTiles(t,n);case 10:return r=e.sent,e.next=13,Object(ne.c)(t,ae);case 13:return(a=e.sent).tilesetIndex=r,e.next=17,Object(ne.e)(t,a,ae);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),console.error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[2,19]])})));return function(t,n){return e.apply(this,arguments)}}(),he=function(){var e=Object(ee.a)($.a.mark((function e(t){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce(t);case 3:if((n=e.sent).file){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",createImageBitmap(n.file));case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),be=function(e,t,n){n=n||[0,0];var r=e.target.getBoundingClientRect();Math.floor(e.target.width/t[0]);return[Math.floor((e.pageX+n[0]-r.left)/t[0]),Math.floor((e.pageY+n[1]-r.top)/t[1])]},fe=function(e,t,n){if(t[0]>=n[0]||t[1]>=n[1])return[[0,0],[0,0],[0,0],[0,0]];var r=1*t[0]/n[0],a=1*t[1]/n[1],i=Math.floor(n[0]/t[0]),c=Math.floor(n[1]/t[1]),s=i*c,l=Math.floor(e%i),o=Math.floor(e%s/i),u=l*(n[0]/i)*1/n[0],d=o*(n[1]/c)/n[1];return[[u,d],[u+r,d],[u+r,d+a],[u,d+a]]},xe=function(e,t){var n=e.getContext("2d");n.strokeStyle="#dddddd",n.lineWidth=1;for(var r=t[1];r<e.height;r+=t[1])n.beginPath(),n.moveTo(0,r+.5),n.lineTo(e.width,r+.5),n.stroke();for(var a=t[0];a<e.width;a+=t[0])n.beginPath(),n.moveTo(a+.5,0),n.lineTo(a+.5,e.height),n.stroke()},je=new function e(){var t=this;Object(M.a)(this,e),this.addTiles=function(){var e=Object(ee.a)($.a.mark((function e(n,r){var a,i,c,s,l,o,u;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(n);case 2:for(a=e.sent,i=Math.floor(a.width/r[0]),c=Math.floor(a.height/r[1]),s=t.lastId,l=0;l<c;l++)for(o=0;o<i;o++)u=fe(l*i+o,r,[a.width,a.height]),t.tiles[t.lastId]={size:r,tileset:n,uv:u},++t.lastId;return e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.get=function(e){return e<0||e>=t.tiles.length?null:t.tiles[e]},this.tiles=[],this.lastId=0},ve=function(){var e=Object(ee.a)($.a.mark((function e(){var t,n,r,a,i,c,s,l,o,u,d,h,b,f,x,j,v,p;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t={}).map={},(n=ge.getState()).layers&&n.layers.layers){e.next=6;break}return console.error("There are no layers in the current project."),e.abrupt("return",JSON.stringify(t));case 6:r=n.layers.names,a=n.layers.layers,t.map.layers=[],i=Object(R.a)(r);try{for(i.s();!(c=i.n()).done;){for(s=c.value,l=a[s],10,10,0,0,(o={}).name=s,o.width=me.layerWidth(l.id),o.height=me.layerHeight(l.id),o.x=me.layerX(l.id),o.y=me.layerY(l.id),o.data=[],u=0;u<10;u++)for(d=0;d<10;d++)h=me.get(d,u,l.id),o.data.push(h);t.map.layers.push(o)}}catch(m){i.e(m)}finally{i.f()}b=n.tileset.tilesetNames,t.tilesets=[],f=Object(R.a)(b),e.prev=14,f.s();case 16:if((x=f.n()).done){e.next=27;break}return j=x.value,(v={}).name=j,e.next=22,ce(j);case 22:p=e.sent,v.tileIndex=p.tilesetIndex,t.tilesets.push(v);case 25:e.next=16;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(14),f.e(e.t0);case 32:return e.prev=32,f.f(),e.finish(32);case 35:return t.tiles=je.tiles,e.abrupt("return",JSON.stringify(t));case 37:case"end":return e.stop()}}),e,null,[[14,29,32,35]])})));return function(){return e.apply(this,arguments)}}(),pe=new function e(){var t=this;Object(M.a)(this,e),this.init=function(){var e=Object(ee.a)($.a.mark((function e(r,a){var i,c;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([n.e(0),n.e(4)]).then(n.bind(null,82));case 3:return t.wasm=e.sent,e.next=6,n.e(0).then(n.bind(null,80));case 6:i=e.sent,c=i.memory,t.map=t.wasm.Tilemap.new(),t.memory=c,t.hasInitialized=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("[x] Error loading grid: ".concat(e.t0.message));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),this.width=function(){return t.map.width()},this.height=function(){return t.map.height()},this.addLayer=function(e,n,r,a){e&&n||(e=0,n=0),r&&a||(r=pe.width(),a=pe.height()),t.map.add_layer(e,n,r,a)},this.get=function(e,n,r){return t.map.get(e,n,r)},this.set=function(e,n,r,a){t.map.set(e,n,r,a)},this.fill=function(e,n,r,a){t.map.fill(e,n,r,a)},this.layerWidth=function(e){return t.map.layer_width(e)},this.layerHeight=function(e){return t.map.layer_height(e)},this.layerX=function(e){return t.map.layer_x(e)},this.layerY=function(e){return t.map.layer_y(e)},this.export=function(e){switch(e){case te:return ve();default:return null}},this.hasInitialized=!1},me=pe,Oe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||P.d,ge=Object(P.e)(J,Oe(Object(P.a)((function(e){return function(e){return function(t){switch(t.type){case m:var n=t.payload||{},r=n.x,a=n.y,i=n.width,c=n.height;me.addLayer(r,a,i,c)}return e(t)}}}),(function(e){return function(e){return function(t){switch(t.type){case o:var n=t.payload||{},r=n.name,a=n.tileSize,i=n.data;se(r,a,i);break;case u:var c=t.payload||{},s=c.name,l=c.tileSize;de(s,l);break;case b:var d=t.payload||{},h=d.name,x=d.tileSize,j=d.tilesetIndex;le(h,x,j);break;case f:var v=(t.payload||{}).name;oe(v)}return e(t)}}})))),ye=function e(t,n,r){var a=this;Object(M.a)(this,e),this.init=function(){var e=a.createShader(a.vertexSource,a.gl.VERTEX_SHADER),t=a.createShader(a.fragmentSource,a.gl.FRAGMENT_SHADER);a.id=a.gl.createProgram(),a.gl.attachShader(a.id,e),a.gl.attachShader(a.id,t),a.gl.linkProgram(a.id),a.gl.getProgramParameter(a.id,a.gl.LINK_STATUS)||console.error("Unable to initialize the shader program: "+a.gl.getProgramInfoLog(a.id))},this.createShader=function(e,t){var n=a.gl.createShader(t);if(a.gl.shaderSource(n,e),a.gl.compileShader(n),!a.gl.getShaderParameter(n,a.gl.COMPILE_STATUS)){var r=a.gl.getShaderInfoLog(n);console.error("Could not compile shader: "+r)}return n},this.use=function(){a.gl.useProgram(a.id)},this.setMat4=function(e,t){a.gl.uniformMatrix4fv(a.gl.getUniformLocation(a.id,e),!1,t)},this.setInt=function(e,t){a.gl.uniform1i(a.gl.getUniformLocation(a.id,e),t)},this.gl=t,this.vertexSource=n,this.fragmentSource=r,this.init()},we=n(30),Le=function e(t,n){var r=this;Object(M.a)(this,e),this.init=function(e){r.id=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r.id),r.width=1,r.height=1;var t=new Uint8Array([0,0,0,0]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,t),he(r.idbKey).then((function(t){t&&(r.width=t.width,r.height=t.height,e.bindTexture(e.TEXTURE_2D,r.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))}))},this.bind=function(e){e.bindTexture(e.TEXTURE_2D,r.id)},this.idbKey=n,this.id=null,this.width=0,this.height=0,this.init(t)},Te=function(){function e(){var t=this;Object(M.a)(this,e),this.add=function(e,n){t.indexMap.set(n,t.map.size),t.map.set(n,new Le(e,n))},this.map=new Map,this.indexMap=new Map}return Object(we.a)(e,[{key:"get",value:function(e){return this.map.get(e)}},{key:"getIndex",value:function(e){return this.indexMap.get(e)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"remove",value:function(e){this.map.delete(e)}}]),e}(),Ie="uMVP",Ee="uSamplers",Se="aPosition",Ae="aTextureCoord",ze="aTextureIdx",Ce="aColor",Ne="#version 300 es\n\n      in vec2 ".concat(Se,";\n      in float ").concat(ze,";\n      in vec2 ").concat(Ae,";\n      in vec4 ").concat(Ce,";\n\n      out vec2 vTextureCoord;\n      out float vTextureIdx;\n      out vec4 vColor;\n\n      uniform mat4 ").concat(Ie,";\n\n      void main() {\n        gl_Position = ").concat(Ie," * vec4(aPosition, 0.0, 1.0);\n        vTextureCoord = ").concat(Ae,";\n        vTextureIdx = ").concat(ze,";\n        vColor = ").concat(Ce,";\n      }\n      "),ke="#version 300 es\n\n      precision mediump float;\n\n      in vec2 vTextureCoord;\n      in float vTextureIdx;\n      in vec4 vColor;\n\n      out vec4 oColor;\n\n      uniform sampler2D ".concat(Ee,"[11];\n\n      void main() {\n        vec4 finalColor = vec4(0.0);\n        int tid = int(vTextureIdx + 0.5);\n\n        switch (tid)\n        {\n          case 0:\n            finalColor = texture(").concat(Ee,"[0], vTextureCoord);\n            break;\n          case 1:\n            finalColor = texture(").concat(Ee,"[1], vTextureCoord);\n            break;\n          case 2:\n            finalColor = texture(").concat(Ee,"[2], vTextureCoord);\n            break;\n          case 3:\n            finalColor = texture(").concat(Ee,"[3], vTextureCoord);\n            break;\n          case 4:\n            finalColor = texture(").concat(Ee,"[4], vTextureCoord);\n            break;\n          case 5:\n            finalColor = texture(").concat(Ee,"[5], vTextureCoord);\n            break;\n          case 6:\n            finalColor = texture(").concat(Ee,"[6], vTextureCoord);\n            break;\n          case 7:\n            finalColor = texture(").concat(Ee,"[7], vTextureCoord);\n            break;\n          case 8:\n            finalColor = texture(").concat(Ee,"[8], vTextureCoord);\n            break;\n          case 9:\n            finalColor = texture(").concat(Ee,"[9], vTextureCoord);\n            break;\n          case 10:\n            finalColor = texture(").concat(Ee,"[10], vTextureCoord);\n            break;\n        }\n\n        oColor = finalColor;\n      }\n      "),Re=function e(t,n){var r=this;Object(M.a)(this,e),this.initialize=function(){r.vertices=new Float32Array(36e4),r.indices=function(e){for(var t=0,n=new Uint16Array(e),r=0;r<e;r+=6)n[r]=t,n[r+1]=t+1,n[r+2]=t+2,n[r+3]=t,n[r+4]=t+2,n[r+5]=t+3,t+=4;return n}(6e4),r.VAO=r.gl.createVertexArray(),r.VBO=r.gl.createBuffer(),r.EBO=r.gl.createBuffer(),r.gl.bindVertexArray(r.VAO),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.VBO),r.gl.bufferData(r.gl.ARRAY_BUFFER,r.vertices,r.gl.DYNAMIC_DRAW);var e=r.gl.getAttribLocation(r.shaderProgram.id,Se);r.gl.vertexAttribPointer(e,2,r.gl.FLOAT,!1,36,0),r.gl.enableVertexAttribArray(e);var t=r.gl.getAttribLocation(r.shaderProgram.id,Ae);r.gl.vertexAttribPointer(t,2,r.gl.FLOAT,!1,36,8),r.gl.enableVertexAttribArray(t);var n=r.gl.getAttribLocation(r.shaderProgram.id,ze);r.gl.vertexAttribPointer(n,1,r.gl.FLOAT,!1,36,16),r.gl.enableVertexAttribArray(n);var a=r.gl.getAttribLocation(r.shaderProgram.id,Ce);r.gl.vertexAttribPointer(a,4,r.gl.FLOAT,!1,36,20),r.gl.enableVertexAttribArray(a),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,r.EBO),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,r.indices,r.gl.STATIC_DRAW),r.vertexIndex=0,r.indexCount=0},this.begin=function(){r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.VBO)},this.emplace=function(e,t,n){var a=je.get(e);if(a){var i=0,c=0,s=0,l=0;n&&(i=n.r,c=n.g,s=n.b,l=n.a);var o=0;r.textureManager.has(a.tileset)||r.textureManager.add(r.gl,a.tileset),o=r.textureManager.getIndex(a.tileset),r.vertices[r.vertexIndex++]=t[0],r.vertices[r.vertexIndex++]=t[1],r.vertices[r.vertexIndex++]=a.uv[0][0],r.vertices[r.vertexIndex++]=a.uv[0][1],r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=t[0]+a.size[0],r.vertices[r.vertexIndex++]=t[1],r.vertices[r.vertexIndex++]=a.uv[1][0],r.vertices[r.vertexIndex++]=a.uv[1][1],r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=t[0]+a.size[0],r.vertices[r.vertexIndex++]=t[1]+a.size[1],r.vertices[r.vertexIndex++]=a.uv[2][0],r.vertices[r.vertexIndex++]=a.uv[2][1],r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=t[0],r.vertices[r.vertexIndex++]=t[1]+a.size[1],r.vertices[r.vertexIndex++]=a.uv[3][0],r.vertices[r.vertexIndex++]=a.uv[3][1],r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=l,r.indexCount+=6}else console.error("Could not get tile data for tile ".concat(a))},this.flush=function(){r.gl.bufferSubData(r.gl.ARRAY_BUFFER,0,r.vertices.subarray(0,r.vertexIndex)),r.vertexIndex=0},this.render=function(){if(0!==r.indexCount){var e=0;r.textureManager.map.forEach((function(t){r.gl.activeTexture(r.gl.TEXTURE0+e),t.bind(r.gl),r.shaderProgram.setInt("".concat(Ee,"[").concat(e,"]"),e),++e})),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.bindVertexArray(r.VAO),r.gl.drawElements(r.gl.TRIANGLES,r.indexCount,r.gl.UNSIGNED_SHORT,0),r.indexCount=0}},this.gl=t,this.shaderProgram=n,this.textureManager=new Te,this.initialize()},Me=n(23),Pe=[.25,.5,.75,1,1.25,1.5,1.75],_e=function e(t,n){var r=this;Object(M.a)(this,e),this.setOrigin=function(e,t){r.origin=[r.position[0],r.position[1]],r.clientOrigin=[e,t]},this.moveTo=function(e,t){r.position=[r.origin[0]+(r.clientOrigin[0]-e),r.origin[1]+(r.clientOrigin[1]-t),r.cameraZ],r.calculateMvp()},this.setZoom=function(e){r.zoom=r.clampZoom(e),r.calculateMvp()},this.applyZoom=function(e){r.zoom+=e,Math.abs(r.zoom)<10||(r.zoom<0?r.zoomLevel=Math.max(0,r.zoomLevel-1):r.zoom>0&&(r.zoomLevel=Math.min(Pe.length-1,r.zoomLevel+1)),r.perceivedWidth=r.width/Pe[r.zoomLevel],r.perceivedHeight=r.height/Pe[r.zoomLevel],r.zoom=0,r.calculateMvp())},this.incrementZoom=function(){r.zoomLevel=Math.min(Pe.length-1,r.zoomLevel+1),r.perceivedWidth=r.width/Pe[r.zoomLevel],r.perceivedHeight=r.height/Pe[r.zoomLevel],r.calculateMvp()},this.decrementZoom=function(){r.zoomLevel=Math.max(0,r.zoomLevel-1),r.perceivedWidth=r.width/Pe[r.zoomLevel],r.perceivedHeight=r.height/Pe[r.zoomLevel],r.calculateMvp()},this.getMvp=function(){return r.mvp},this.getZoomLevel=function(){return Pe[r.zoomLevel]},this.calculateMvp=function(){var e=r.position[0]/Pe[r.zoomLevel],t=r.position[1]/Pe[r.zoomLevel];Me.a.ortho(r.projection,e,r.perceivedWidth+e,r.perceivedHeight+t,t,r.near,r.far),Me.a.multiply(r.mvp,r.projection,r.modelView)},this.updateViewport=function(e,t){r.width=e,r.height=t,r.perceivedWidth=r.width/Pe[r.zoomLevel],r.perceivedHeight=r.height/Pe[r.zoomLevel],r.calculateMvp()},this.width=t,this.height=n,this.zoomLevel=3,this.zoom=0,this.perceivedWidth=this.width,this.perceivedHeight=this.height,this.origin=[0,0],this.clientOrigin=[0,0],this.cameraZ=80,this.position=[0,0,this.cameraZ],this.near=.1,this.far=100,this.projection=Me.a.create(),this.modelView=Me.a.create(),this.mvp=Me.a.create(),Me.a.translate(this.modelView,this.modelView,[0,0,-this.cameraZ]),this.calculateMvp()},Ue=new function e(){var t=this;Object(M.a)(this,e),this.hasInitialized=!1,this.init=function(e){t.gl=e,t.gl&&(t.gl.enable(t.gl.BLEND),t.gl.blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),t.shaderProgram=new ye(t.gl,Ne,ke),t.shaderProgram.use(),t.camera=new _e(t.gl.canvas.width,t.gl.canvas.height),t.shaderProgram.setMat4(Ie,t.camera.getMvp()),t.batch=new Re(t.gl,t.shaderProgram),t.hasInitialized=!0)},this.setClearColor=function(e,n,r,a){t.gl.clearColor(e,n,r,a)},this.updateViewport=function(e,n){t.camera.updateViewport(e,n)},this.render=function(){t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.renderTilemap(),window.requestAnimationFrame(t.render)},this.renderTilemap=function(){if(me.hasInitialized){t.shaderProgram.use();var e=t.gl.canvas.width,n=t.gl.canvas.height,r=ge.getState().layers;t.shaderProgram.setMat4(Ie,t.camera.getMvp()),t.batch.begin();var a,i=Object(R.a)(r.names);try{for(i.s();!(a=i.n()).done;){var c=a.value,s=r.layers[c];if(s.visible&&s.id>=0)for(var l=0,o=0;o<n;l++,o+=s.tileSize[1])for(var u=0,d=0;d<e;u++,d+=s.tileSize[0]){var h=me.get(u,l,s.id);-1!=h&&t.batch.emplace(h,[d,o])}}}catch(b){i.e(b)}finally{i.f()}t.batch.flush(),t.batch.render()}}},De=function(){var e=Object(l.c)(),t=Object(a.useRef)(),n=Object(l.d)((function(e){return e.canvas.tileSize}));return Object(a.useEffect)((function(){t.current&&(t.current.width=t.current.clientWidth,t.current.height=t.current.clientHeight,me.hasInitialized||me.init().then((function(){e(C({name:"",tileSize:n,x:0,y:0,width:Math.floor(t.current.width/n[0])+1,height:Math.floor(t.current.height/n[1])+1}))})),Ue.hasInitialized||(Ue.init(t.current.getContext("webgl2")),Ue.setClearColor(31/255,41/255,55/255,1),window.requestAnimationFrame(Ue.render)))}),[n,e]),Object(r.jsx)("canvas",{id:"tilemap-canvas",ref:t,className:"col-span-full row-span-full z-0 w-full h-full"})},Fe=function(){var e=Object(l.c)(),t=Object(a.useRef)(),n=Object(l.d)((function(e){return{selectedLayer:Object(B.a)({name:e.layers.selected},e.layers.layers[e.layers.selected]),layers:e.layers.layers}})),i=n.selectedLayer,c=n.layers,s=Object(l.d)((function(e){return e.tileset.selectedTile})),o=Object(l.d)((function(e){return e.canvas})).selectedTool;Object(a.useEffect)((function(){var e=t.current;if(e){window.addEventListener("resize",(function(){e&&Ue.updateViewport(e.clientWidth,e.clientHeight)})),t.current.width=e.clientWidth,t.current.height=e.clientHeight;var n=function(e){return e.preventDefault()};return e.addEventListener("wheel",n,{passive:!1}),function(){e.removeEventListener("wheel",n)}}}),[]),Object(a.useEffect)((function(){var t=function(t){" "===t.key&&e(A(W))},n=function(t){" "===t.key&&e(A(V))};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[e]),Object(a.useEffect)((function(){var e=t.current;i.tileSize&&e&&(e.getContext("2d").clearRect(0,0,e.width,e.height),xe(e,i.tileSize))}),[i]);var u=function(e){var t=Ue.camera.getZoomLevel(),n=be(e,[i.tileSize[0]*t,i.tileSize[1]*t],Ue.camera.position),r=i.id;switch(o){case V:break;case X:null!==s&&void 0!==s&&-1!==s&&me.set.apply(me,Object(F.a)(n).concat([s,r]));break;case Y:me.set.apply(me,Object(F.a)(n).concat([-1,r]));break;case W:if(0==e.clientX||0==e.clientY)break;Ue.camera.moveTo(e.clientX,e.clientY)}};return Object(r.jsx)("canvas",{id:"editor-canvas",ref:t,onWheel:function(e){e.altKey&&Ue.camera.applyZoom(e.deltaY)},onMouseDown:function(e){i.name&&c[i.name]&&(!function(e){switch(o){case H:var t=Ue.camera.getZoomLevel(),n=be(e,[i.tileSize[0]*t,i.tileSize[1]*t],Ue.camera.position),r=i.id;me.fill.apply(me,Object(F.a)(n).concat([s,r]));break;case W:Ue.camera.setOrigin(e.clientX,e.clientY);break;case G:e.altKey?Ue.camera.decrementZoom():Ue.camera.incrementZoom()}}(e),u(e))},onDragOver:function(e){i.name&&c[i.name]&&u(e)},onDragStart:function(e){var t=document.createElement("img");t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.dataTransfer.setDragImage(t,0,0)},className:"col-span-full row-span-full z-10 w-full h-full",draggable:"true"})},Be=function(){return Object(r.jsx)("div",{className:"col-span-full row-span-full flex flex-col",children:Object(r.jsxs)("section",{className:"grid flex-1 bg-gray-600",children:[Object(r.jsx)(Fe,{}),Object(r.jsx)(De,{})]})})},Ze=n(32),Ve=n(9),Xe=n(25),Ye=n(13),He=n.n(Ye),We="border-gray-600",Ge="h-7",Ke=function(e){var t=e.iconPath,n=e.routerPath,i=Object(l.c)(),c=Object(l.d)((function(e){return e.canvas.showSidebar})),s=Object(a.useState)("#/".concat(n)===window.location.hash),o=Object(Ve.a)(s,2),u=o[0],d=o[1];return Object(r.jsx)(Xe.b,{replace:u,to:n,className:"w-full",activeClassName:"".concat("bg-gray-800"," ").concat("text-green-400"),isActive:function(e,t){return null!==e&&c},children:Object(r.jsx)("button",{className:"w-full py-3 flex justify-center ".concat("hover:bg-gray-800"," ").concat("hover:text-green-300"),onClick:function(){var e="#/".concat(n)===window.location.hash;d(e),e?i(z(!c)):c||i(z(!0))},"data-tip":!0,"data-for":n,"data-testid":n,children:Object(r.jsx)(He.a,{path:t,size:1})})})},qe="tiles",Je="import",Qe="save",$e="settings",et="help",tt=new Map;tt.set(V,"default tool"),tt.set(X,"placement tool"),tt.set(Y,"erase tool"),tt.set(H,"fill tool"),tt.set(W,"pan tool"),tt.set(G,"zoom"),tt.set(qe,"tab tiles"),tt.set(Je,"tab import"),tt.set(Qe,"tab export"),tt.set($e,"settings tab"),tt.set(et,"help tab");var nt=tt,rt=n(7);function at(){return(at=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function it(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var ct=a.createElement("mask",{id:"path-1-outside-1",maskUnits:"userSpaceOnUse",x:.745167,y:.745174,width:271.529,height:271.529,fill:"black"},a.createElement("rect",{fill:"white",x:.745167,y:.745174,width:271.529,height:271.529}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46 136.51L91.2548 91.2548L91.9619 90.5477L136.51 46L181.057 90.5477L181.764 91.2548L227.019 136.51L181.764 181.765L136.51 136.51L91.2548 181.765L46 136.51Z"})),st=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46 136.51L91.2548 91.2548L91.9619 90.5477L136.51 46L181.057 90.5477L181.764 91.2548L227.019 136.51L181.764 181.765L136.51 136.51L91.2548 181.765L46 136.51Z",fill:"#34D399"}),lt=a.createElement("path",{d:"M46 136.51L23.3726 113.882L0.745167 136.51L23.3726 159.137L46 136.51ZM136.51 46L159.137 23.3726L136.51 0.745174L113.882 23.3726L136.51 46ZM227.019 136.51L249.647 159.137L272.274 136.51L249.647 113.882L227.019 136.51ZM181.764 181.765L159.137 204.392L181.764 227.019L204.392 204.392L181.764 181.765ZM136.51 136.51L159.137 113.882L136.51 91.2548L113.882 113.882L136.51 136.51ZM91.2548 181.765L68.6274 204.392L91.2548 227.019L113.882 204.392L91.2548 181.765ZM68.6274 68.6274L23.3726 113.882L68.6274 159.137L113.882 113.882L68.6274 68.6274ZM69.3345 67.9203L68.6274 68.6274L113.882 113.882L114.589 113.175L69.3345 67.9203ZM113.882 23.3726L69.3345 67.9203L114.589 113.175L159.137 68.6274L113.882 23.3726ZM203.685 67.9203L159.137 23.3726L113.882 68.6274L158.43 113.175L203.685 67.9203ZM158.43 113.175L159.137 113.882L204.392 68.6274L203.685 67.9203L158.43 113.175ZM159.137 113.882L204.392 159.137L249.647 113.882L204.392 68.6274L159.137 113.882ZM204.392 113.882L159.137 159.137L204.392 204.392L249.647 159.137L204.392 113.882ZM204.392 159.137L159.137 113.882L113.882 159.137L159.137 204.392L204.392 159.137ZM113.882 204.392L159.137 159.137L113.882 113.882L68.6274 159.137L113.882 204.392ZM23.3726 159.137L68.6274 204.392L113.882 159.137L68.6274 113.882L23.3726 159.137Z",fill:"#0A0913",mask:"url(#path-1-outside-1)"}),ot=a.createElement("rect",{x:91.2548,y:181.765,width:64,height:64,transform:"rotate(-45 91.2548 181.765)",fill:"#FBFDFC",stroke:"#0A0913",strokeWidth:32});function ut(e,t){var n=e.title,r=e.titleId,i=it(e,["title","titleId"]);return a.createElement("svg",at({width:"100%",height:"100%",viewBox:"0 0 273 273",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},i),n?a.createElement("title",{id:r},n):null,ct,st,lt,ot)}var dt=a.forwardRef(ut),ht=(n.p,function(){var e=[{path:qe,icon:rt.q},{path:Qe,icon:rt.b},{path:Je,icon:rt.p},{path:$e,icon:rt.a},{path:et,icon:rt.i}].map((function(e){return Object(r.jsxs)("div",{className:"flex",children:[Object(r.jsx)(Ke,{routerPath:e.path,iconPath:e.icon}),Object(r.jsx)(Ze.a,{id:e.path,place:"right",effect:"solid",delayShow:600,children:nt.get(e.path)})]},e.path)}));return Object(r.jsxs)("div",{className:"flex flex-col justify-end bg-almost-black border-r ".concat(We),children:[Object(r.jsx)("div",{className:"flex-1 flex flex-col justify-start",children:Object(r.jsx)("div",{className:"py-3 px-0.5",children:Object(r.jsx)(dt,{})})}),e]})}),bt=function(e){var t=e.children,n=e.title;return Object(r.jsxs)("div",{className:"flex-1 flex flex-col text-sm",children:[Object(r.jsx)("h2",{className:"".concat(Ge," bg-almost-black border-b ").concat(We," px-2 flex items-center"),children:n}),t]})},ft=function(e){return e.layers},xt=function(e){return function(e){return ft(e)?ft(e).names:[]}(e).map((function(t){return function(e,t){return ft(e)?Object(B.a)(Object(B.a)({},ft(e).layers[t]),{},{name:t}):{}}(e,t)}))},jt=function(e){return xt(e).reverse()},vt=n(47),pt=function(e){var t=e.title,n=e.children,i=Object(a.useState)(!0),c=Object(Ve.a)(i,2),s=c[0],l=c[1],o=s?rt.k:rt.l,u=s?"border-b ".concat(We):"";return Object(r.jsxs)("div",{className:u,children:[Object(r.jsxs)("div",{className:"text-xs flex items-center hover:bg-gray-800 cursor-pointer border-b ".concat(We," ").concat(Ge),onDoubleClick:function(e){return l(!s)},children:[Object(r.jsx)(He.a,{path:o,size:1}),Object(r.jsx)("h1",{className:"select-none",children:t})]}),Object(r.jsx)(vt.Collapse,{isOpened:s,children:Object(r.jsx)("div",{className:"text-xs text-gray-300 px-2 py-2",children:n})})]})},mt=n(28),Ot=function(e){var t=e.layer,n=e.index,a=e.isSelected,i=Object(l.c)(),c=function(){i(k(t.name))},s=function(){var e;i((e=t.name,{type:L,payload:{name:e}}))},o=t.visible?rt.f:rt.g,u=a?"bg-gray-700 hover:text-white":"bg-gray-800 hover:bg-gray-900",d=t.visible?"layer-visible":"layer-hidden";return Object(r.jsx)("div",{className:"border-t border-gray-700 first:border-t-0",children:Object(r.jsx)(mt.b,{draggableId:t.name,index:n,children:function(e,n){var a=Object(B.a)({cursor:"default"},e.draggableProps.style);return Object(r.jsxs)("li",Object(B.a)(Object(B.a)(Object(B.a)({className:"flex items-center select-none ".concat(u),ref:e.innerRef},e.draggableProps),e.dragHandleProps),{},{style:a,"data-testid":d,children:[Object(r.jsx)("span",{className:"flex-1 pl-4 py-1",onClick:c,children:t.name}),Object(r.jsx)("span",{onClick:s,className:"cursor-pointer pr-4 py-1 hover:text-white","data-testid":"hide-layer-button",children:Object(r.jsx)(He.a,{path:o,size:.6})})]}))}})})},gt=n(31),yt=n.n(gt),wt=function(e){var t=e.children,n=e.open,a=e.title,i=e.onClose;return Object(r.jsxs)(yt.a,{isOpen:n,contentLabel:a,onRequestClose:i,style:{overlay:{backgroundColor:"rgba(0,0,0,0.6)",zIndex:"29"},content:{backgroundColor:"rgb(17, 24, 39)",borderRadius:"0.25rem",borderColor:"rgb(75, 85, 99)",color:"rgb(249, 250, 251)",top:"50%",left:"50%",right:"0",bottom:"0",transform:"translate(-50%, -50%)",zIndex:"30",padding:"1rem",height:"max-content",width:"max-content"}},children:[Object(r.jsx)("h1",{children:a}),Object(r.jsx)("div",{className:"text-xs",children:t})]})},Lt=function(e){var t=e.text,n=e.onClick;return Object(r.jsx)("div",{className:"cursor-pointer block bg-green-600 hover:bg-green-700 active:bg-green-800 px-1 py-2 flex items-center text-center rounded-sm w-full",onClick:n,children:Object(r.jsx)("p",{className:"flex-1 text-white",children:t})})},Tt=function(e){var t=e.layerName,n=e.open,i=e.onClose,c=Object(l.c)(),s=Object(a.useState)(0),o=Object(Ve.a)(s,2),u=o[0],d=o[1],h=Object(a.useState)(0),b=Object(Ve.a)(h,2),f=b[0],x=b[1],j=Object(l.d)((function(e){return e.layers.layers[t].tileSize}));Object(a.useEffect)((function(){j&&(d(j[0]),x(j[1]))}),[j]);var v=function(){var e=Object(ee.a)($.a.mark((function e(){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[parseInt(u),parseInt(f)],c(N(t,n)),i&&i();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(wt,{title:"Tileset Settings",open:n,onClose:i,children:[Object(r.jsxs)("form",{className:"mb-2",children:[Object(r.jsxs)("label",{children:["Tile dimensions (px):",Object(r.jsx)("br",{})]}),Object(r.jsxs)("div",{className:"mt-2",children:[Object(r.jsx)("input",{type:"number",value:u,onChange:function(e){d(e.target.value)},className:"w-14 mr-1"}),Object(r.jsx)("input",{type:"number",value:f,onChange:function(e){x(e.target.value)},className:"w-14 ml-1"})]})]}),Object(r.jsxs)("div",{className:"flex mt-2",children:[Object(r.jsx)("span",{className:"w-full mr-1",children:Object(r.jsx)(Lt,{text:"Update",onClick:v})}),Object(r.jsx)("span",{className:"w-full ml-1",children:Object(r.jsx)(Lt,{text:"Cancel",onClick:i})})]})]})},It=function(e){var t=e.selectedLayer,n=Object(l.c)(),i=Object(l.d)((function(e){return e.canvas.tileSize})),c=Object(a.useState)(!1),s=Object(Ve.a)(c,2),o=s[0],u=s[1];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"flex items-center justify-start mt-1",children:[Object(r.jsx)("button",{onClick:function(){n(C({tileSize:i}))},"data-testid":"add-layer-button",className:"hover:text-white",children:Object(r.jsx)(He.a,{path:rt.o,size:.7})}),Object(r.jsx)("button",{onClick:function(){u(!0)},className:"hover:text-white",children:Object(r.jsx)(He.a,{path:rt.a,size:.6})}),Object(r.jsx)("button",{onClick:function(){n({type:g,payload:{name:t}})},"data-testid":"delete-layer-button",className:"hover:text-white",children:Object(r.jsx)(He.a,{path:rt.d,size:.65})})]}),o&&Object(r.jsx)(Tt,{layerName:t,open:o,onClose:function(){u(!1)}})]})},Et=function(){var e=Object(l.c)(),t=Object(l.d)((function(e){return{selectedLayer:e.layers.selected,layers:jt(e)}})),n=t.selectedLayer,a=t.layers,i=a.map((function(e,t){return Object(r.jsx)(Ot,{index:t,layer:e,isSelected:e.name===n},e.name)})),c=a&&a.length?Object(r.jsx)(mt.a,{onDragEnd:function(t){var n,r;e((n=t.draggableId,r=a.length-t.destination.index-1,{type:w,payload:{name:n,to:r}}))},onBeforeDragStart:function(t){e(k(t.draggableId))},children:Object(r.jsx)(mt.c,{droppableId:"layers",children:function(e){return Object(r.jsxs)("ul",Object(B.a)(Object(B.a)({},e.droppableProps),{},{ref:e.innerRef,className:"border rounded-sm border-gray-700",children:[i,e.placeholder]}))}})}):Object(r.jsx)("div",{});return Object(r.jsxs)(pt,{title:"Layers",children:[c,Object(r.jsx)(It,{selectedLayer:n})]})},St=function(e){var t=e.tilesetName,n=e.selectable,i=e.tileSize,c=e.tilesetIndex,s=Object(l.c)(),o=Object(a.useState)(null),u=Object(Ve.a)(o,2),d=u[0],h=u[1],b=Object(a.useState)(c),f=Object(Ve.a)(b,2),j=f[0],v=f[1],p=Object(a.useState)(i),m=Object(Ve.a)(p,2),O=m[0],g=m[1],y=Object(a.useRef)(null),w=Object(a.useRef)(null);Object(a.useEffect)((function(){g(i)}),[i]),Object(a.useEffect)((function(){v(c)}),[c]),Object(a.useEffect)((function(){if(t&&""!==t&&y.current&&w.current){var e=w.current,n=y.current;ce(t).then((function(t){var r=new FileReader,a=new Image;r.onload=function(r){a.onload=function(){g(t.tileSize),e.width=a.width,e.height=a.height,n.width=a.width,n.height=a.height,e.getContext("2d").drawImage(a,0,0),v(t.tilesetIndex)},a.src=r.target.result},r.readAsDataURL(t.file)}))}}),[t]),Object(a.useEffect)((function(){var e=y.current;e&&O&&(e.getContext("2d").clearRect(0,0,e.width,e.height),xe(e,O),d&&function(e,t,n){var r=e.getContext("2d");r.fillStyle="rgba(79, 70, 229, 0.4)",r.fillRect(t[0]*n[0]+1,t[1]*n[1]+1,n[0]-1,n[1]-1)}(e,d,O))}),[O,d]);return""===t?Object(r.jsx)("div",{}):Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("div",{className:"max-h-40 max-w-full overflow-scroll border inline-block rounded-sm mt-2",children:Object(r.jsxs)("div",{className:"grid",children:[Object(r.jsx)("canvas",{id:"grid-canvas",onMouseUp:function(e){if(n&&O){var t=be(e,O),r=j+t[1]*Math.floor(e.target.width/O[0])+t[0];s({type:x,payload:{value:r}}),h(t)}},ref:y,className:"col-span-full row-span-full z-10 overflow-hidden"}),Object(r.jsx)("canvas",{id:"tileset-canvas",ref:w,className:"col-span-full row-span-full z-0 overflow-hidden"})]})})})},At=function(e){var t=e.value,n=e.options,a=e.onChange;return Object(r.jsx)("select",{className:"text-gray-400 w-full px-1 py-1 bg-gray-800 hover:bg-gray-700 hover:text-white border border-gray-700 rounded-sm",value:t,onChange:a,"data-testid":"select-tag",children:n})},zt=function(){var e=Object(l.c)(),t=Object(l.d)((function(e){return e.tileset})),n=t.selectedTileset,i=t.tilesetNames;Object(a.useEffect)((function(){var t=localStorage.getItem(re);t&&""!==t?e(E(t)):localStorage.setItem(re,"")}),[e]);var c,s=[],o=Object(R.a)(i);try{for(o.s();!(c=o.n()).done;){var u=c.value;s.push(Object(r.jsx)("option",{value:u,"data-testid":u,children:u},u))}}catch(d){o.e(d)}finally{o.f()}return i.length>0&&Object(r.jsx)(At,{value:n,options:s,onChange:function(t){var n=t.target.value;localStorage.setItem(re,n),e(E(n))}})},Ct=function(e){e.title;var t=e.onUpload;return Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"file",name:"tilesetFile",id:"tilesetFile",min:"1",max:"100",value:"",onChange:t,style:{width:"0.1px",height:"0.1px",opacity:0,overflow:"hidden",position:"absolute",zIndex:"-1"}}),Object(r.jsx)("label",{htmlFor:"tilesetFile",className:"block ",children:Object(r.jsx)(Lt,{text:"Choose a file..."})})]})},Nt=function(e){var t=e.tilesetName,n=e.open,i=e.onClose,c=Object(l.c)(),s=Object(a.useState)(0),o=Object(Ve.a)(s,2),u=o[0],d=o[1],h=Object(a.useState)(0),b=Object(Ve.a)(h,2),f=b[0],x=b[1],j=Object(l.d)((function(e){return e.tileset.tilesets[t].tileSize}));Object(a.useEffect)((function(){j&&(d(j[0]),x(j[1]))}),[j]);var v=function(){var e=Object(ee.a)($.a.mark((function e(){var n,r;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[parseInt(u),parseInt(f)],e.next=3,je.addTiles(t,n);case 3:r=e.sent,c(S(t,n,r)),i&&i();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(wt,{title:"Tileset Settings",open:n,onClose:i,children:[Object(r.jsxs)("form",{className:"mb-2",children:[Object(r.jsxs)("label",{children:["Tile dimensions (px):",Object(r.jsx)("br",{})]}),Object(r.jsxs)("div",{className:"mt-2",children:[Object(r.jsx)("input",{type:"number",value:u,onChange:function(e){d(e.target.value)},className:"w-14 mr-1"}),Object(r.jsx)("input",{type:"number",value:f,onChange:function(e){x(e.target.value)},className:"w-14 ml-1"})]})]}),u>0&&f>0&&Object(r.jsx)(St,{tilesetName:t,selectable:!1,tileSize:[parseInt(u),parseInt(f)]}),Object(r.jsxs)("div",{className:"flex mt-2",children:[Object(r.jsx)("span",{className:"w-full mr-1",children:Object(r.jsx)(Lt,{text:"Update",onClick:v})}),Object(r.jsx)("span",{className:"w-full ml-1",children:Object(r.jsx)(Lt,{text:"Cancel",onClick:i})})]})]})},kt=function(e){var t=e.selectedTileset,n=Object(l.c)(),i=Object(a.useState)(!1),c=Object(Ve.a)(i,2),s=c[0],o=c[1];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"flex items-center justify-start",children:[Object(r.jsx)("button",{onClick:function(){o(!0)},className:"hover:text-white",children:Object(r.jsx)(He.a,{path:rt.a,size:.6})}),Object(r.jsx)("button",{onClick:function(){n({type:f,payload:{name:t}})},className:"hover:text-white","data-testid":"tileset-footer-delete-button",children:Object(r.jsx)(He.a,{path:rt.d,size:.65})})]}),s&&Object(r.jsx)(Nt,{tilesetName:t,open:s,onClose:function(){o(!1)}})]})},Rt=function(){var e=Object(l.c)(),t=(Object(l.d)((function(e){return e.tileset.tilesetNames})),Object(l.d)((function(e){return e.tileset.hasLoadedTextures}))),n=Object(l.d)((function(e){return e.tileset.selectedTileset})),i=Object(l.d)((function(e){return e.canvas.tileSize})),c=Object(l.d)((function(e){return e.tileset.tilesets[n]}));Object(a.useEffect)((function(){t||ie().then(function(){var t=Object(ee.a)($.a.mark((function t(n){var r,a,i,c;return $.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Object(R.a)(n),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=11;break}return i=a.value,t.next=7,ce(i);case 7:c=t.sent,e(I(i,c.tileSize,c.tilesetIndex));case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:e({type:d,payload:{}});case 20:case"end":return t.stop()}}),t,null,[[1,13,16,19]])})));return function(e){return t.apply(this,arguments)}}())}),[e,t]);var s=function(){var t=Object(ee.a)($.a.mark((function t(n){return $.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.target.files.length<=0)&&n.target.files[0]){t.next=2;break}return t.abrupt("return");case 2:e(T(n.target.files[0].name,i,je.lastId,n.target.files[0]));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsx)(pt,{title:"Tileset",children:t?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(zt,{}),Object(r.jsx)("div",{className:"mt-2","data-testid":"tileset-file-input",children:Object(r.jsx)(Ct,{title:"Add Tileset",onUpload:function(e){return s(e)}})}),c&&Object(r.jsx)(St,{tilesetName:n,selectable:!0,tileSize:c.tileSize,tilesetIndex:c.tilesetIndex}),n&&Object(r.jsx)(kt,{selectedTileset:n})]}):Object(r.jsx)("div",{})})},Mt=function(){return Object(r.jsxs)(bt,{title:"Edit",children:[Object(r.jsx)(Et,{}),Object(r.jsx)(Rt,{})]})},Pt=function(){return Object(r.jsx)(bt,{title:"Import",children:Object(r.jsx)("h3",{children:"Import"})})},_t=function(e){var t=e.format,n=e.onOptionSelected,a=[te,"tmx"].map((function(e){return Object(r.jsx)("option",{value:e,children:e},e)}));return Object(r.jsx)(At,{value:t,options:a,onChange:n})},Ut=function(){var e=Object(a.useState)(te),t=Object(Ve.a)(e,2),n=t[0],i=t[1],c=function(){var e=Object(ee.a)($.a.mark((function e(){var t,r,a,i;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.export(n);case 2:t=e.sent,r="tilemap."+n,a=new Blob([t],{type:"application/json"}),(i=document.createElement("a")).href=URL.createObjectURL(a),i.download=r,i.click();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(bt,{title:"Export Map",children:[Object(r.jsx)(_t,{format:n,onOptionSelected:function(e){i(e.target.value)}}),Object(r.jsx)(Lt,{text:"Export",onClick:c})]})},Dt=function(){var e=Object(l.c)(),t=Object(l.d)((function(e){return e.canvas.tileSize})),n=Object(a.useState)(t[0]),i=Object(Ve.a)(n,2),c=i[0],s=i[1],o=Object(a.useState)(t[1]),u=Object(Ve.a)(o,2),d=u[0],h=u[1];return Object(r.jsx)(bt,{title:"Project Settings",children:Object(r.jsxs)("form",{children:[Object(r.jsxs)("label",{children:["Global tile dimensions (px):",Object(r.jsx)("br",{})]}),Object(r.jsxs)("div",{className:"mt-2",children:[Object(r.jsx)("input",{type:"number",value:c,onChange:function(e){s(e.target.value)},className:"w-14 mr-1"}),Object(r.jsx)("input",{type:"number",value:d,onChange:function(e){h(e.target.value)},className:"w-14 ml-1"})]}),Object(r.jsx)("label",{htmlFor:"apply-globally",children:"Apply to existing layers and tilesets"}),Object(r.jsx)("input",{type:"checkbox",name:"apply-globally"}),Object(r.jsx)(Lt,{text:"Update project",onClick:function(){var t;e((t=[parseInt(c),parseInt(d)],{type:p,payload:{size:t}}))}})]})})},Ft=function(){return Object(r.jsx)(bt,{title:"Help"})},Bt=n(10),Zt=function(){var e=Object(l.c)(),t=Object(l.d)((function(e){return e.canvas.showSidebar}));Object(a.useEffect)((function(){var t=window.location.hash;t&&""!==t&&"#/"!==t&&e(z(!0))}),[]);var n=t?{width:"23vw",gridTemplateColumns:"40px 1fr"}:{width:"40px",gridTemplateColumns:"40px 0px"},i=t?{width:"100%",borderRight:"1px solid rgb(75, 85, 99)"}:{width:"0"};return Object(r.jsxs)("aside",{style:Object(B.a)({transition:"all 150ms ease-in-out",display:"grid"},n),children:[Object(r.jsx)(ht,{}),Object(r.jsx)("div",{className:"bg-gray-900 border-b ".concat(We),style:i,"data-testid":t?"sidebar-element":"",children:t&&Object(r.jsxs)(Bt.c,{children:[Object(r.jsx)(Bt.a,{path:"/".concat(qe),children:Object(r.jsx)(Mt,{})}),Object(r.jsx)(Bt.a,{path:"/".concat(Je),children:Object(r.jsx)(Pt,{})}),Object(r.jsx)(Bt.a,{path:"/".concat(Qe),children:Object(r.jsx)(Ut,{})}),Object(r.jsx)(Bt.a,{path:"/".concat($e),children:Object(r.jsx)(Dt,{})}),Object(r.jsx)(Bt.a,{path:"/".concat(et),children:Object(r.jsx)(Ft,{})})]})})]})},Vt=function(e){var t=e.iconPath,n=e.tool,a=Object(l.c)(),i=Object(l.d)((function(e){return e.canvas.selectedTool})),c=n===i?"text-green-400 hover:text-green-500":"hover:text-green-500 cursor-pointer";return Object(r.jsxs)("button",{className:"px-3 py-2 cursor-default",role:"button","data-testid":n===i?"selected-tool":"",children:[Object(r.jsx)("div",{className:c,onClick:function(){a(A(n))},"data-tip":!0,"data-for":n,"data-testid":n,children:Object(r.jsx)(He.a,{path:t,size:.68})}),Object(r.jsx)(Ze.a,{id:n,place:"bottom",effect:"solid",delayShow:600,children:nt.get(n)})]})},Xt=function(){return Object(r.jsx)("nav",{className:"col-start-2 col-end-5 row-start-1 row-end-2 z-20 flex flex-row items-stretch border-b border-r bg-almost-black ".concat(We," ").concat("h-7"),children:Object(r.jsxs)("div",{className:"flex flex-row justify-start items-center flex-grow",children:[Object(r.jsx)(Vt,{iconPath:rt.c,tool:V}),Object(r.jsx)(Vt,{iconPath:rt.n,tool:X}),Object(r.jsx)(Vt,{iconPath:rt.e,tool:Y}),Object(r.jsx)(Vt,{iconPath:rt.m,tool:H}),Object(r.jsx)(Vt,{iconPath:rt.h,tool:W}),Object(r.jsx)(Vt,{iconPath:rt.j,tool:G})]})})},Yt=function(){return Object(r.jsx)("div",{className:"h-screen w-screen flex flex-col bg-gray-900 border-l border-t ".concat(We," text-gray-100"),children:Object(r.jsxs)("main",{className:"flex-1 grid grid-cols-4",style:{gridTemplateRows:"1.75rem 1fr",gridTemplateColumns:"auto 1fr 1fr 1fr"},children:[Object(r.jsx)("div",{className:"col-start-1 col-end-2 row-start-1 row-end-3 z-20 flex",children:Object(r.jsx)(Xe.a,{className:"flex-1",children:Object(r.jsx)(Zt,{})})}),Object(r.jsx)(Xt,{}),Object(r.jsx)(Be,{})]})})};n(77);yt.a.setAppElement("#root"),s.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(l.a,{store:ge,children:Object(r.jsx)(Yt,{})})}),document.getElementById("root"))}},[[78,2,3]]]);
//# sourceMappingURL=main.a9d6356b.chunk.js.map