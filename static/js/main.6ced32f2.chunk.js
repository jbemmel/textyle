(this.webpackJsonpaestyle=this.webpackJsonpaestyle||[]).push([[1],{63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),i=n.n(a),c=n(20),o=n.n(c),s=n(5),l="[TILESET] Add one",u="[TILESET] Add multiple",d="[TILESET] Select",h="[TILE] Select",v="[TOOL] Select",f="[LAYER] Add one",x="[LAYER] Delete",b="[LAYER] Select",j="[LAYER] Move",g="[LAYER] Toggle Visibility",p=function(e){return{type:l,payload:{name:e}}},O=function(e){return{type:d,payload:{name:e}}},m=function(e,t,n,r,a){return{type:f,payload:{name:e,x:t,y:n,width:r,height:a}}},y=function(e){return{type:b,payload:{name:e}}},T=n(31),E=n(16),w=n.n(E),I="DEFAULT_TOOL",R="PLACEMENT_TOOL",A="FILL_TOOL",C="MOVE_TOOL",L="tiles",M="map",S="import",P="save",N="settings",k="help",_=new Map;_.set(I,"default tool"),_.set(R,"placement tool"),_.set(A,"fill tool"),_.set(C,"move tool"),_.set(L,"tab tiles"),_.set(M,"tab map"),_.set(S,"tab import"),_.set(P,"tab export"),_.set(N,"settings tab"),_.set(k,"help tab");var U=_,D="lastSelectedTileset",z="#dddddd",F=function(e){var t=e.iconPath,n=e.tool,a=Object(s.c)(),i=Object(s.d)((function(e){return e.canvas.selectedTool})),c=n===i?"text-indigo-400 hover:text-indigo-500":"hover:text-indigo-500 cursor-pointer";return Object(r.jsxs)("button",{className:"px-4 py-2 cursor-default",role:"button","data-testid":n===i?"selected-tool":"",children:[Object(r.jsx)("div",{className:c,onClick:function(){a(function(e){return{type:v,payload:{tool:e}}}(n))},"data-tip":!0,"data-for":n,"data-testid":n,children:Object(r.jsx)(w.a,{path:t,size:.75})}),Object(r.jsx)(T.a,{id:n,place:"bottom",effect:"solid",delayShow:600,children:U.get(n)})]})},B=n(8),V=function(){return Object(r.jsx)("nav",{className:"flex flex-row items-stretch bg-black",children:Object(r.jsxs)("div",{className:"flex flex-row justify-start items-center flex-grow",children:[Object(r.jsx)(F,{iconPath:B.c,tool:I}),Object(r.jsx)(F,{iconPath:B.m,tool:R}),Object(r.jsx)(F,{iconPath:B.l,tool:A}),Object(r.jsx)(F,{iconPath:B.d,tool:C})]})})},X=n(21),Y=n(9),G=n(14),W=n(18),Z=n(4),H={tilesetNames:[],selectedTileset:"",selectedTile:-1},q={selectedTool:I},J=n(42),K=n(41),Q=n(27),$={selected:"",names:[],layers:{},lastIdx:0},ee=Object(G.c)({tileset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:var n=t.payload.names;return Object(Z.a)(Object(Z.a)({},e),{},{tilesetNames:[].concat(Object(W.a)(e.tilesetNames),Object(W.a)(n))});case l:var r=t.payload.name;return Object(Z.a)(Object(Z.a)({},e),{},{tilesetNames:[].concat(Object(W.a)(e.tilesetNames),[r]),selectedTileset:r});case d:var a=t.payload.name;return Object(Z.a)(Object(Z.a)({},e),{},{selectedTileset:a});case h:var i=t.payload.value;return Object(Z.a)(Object(Z.a)({},e),{},{selectedTile:i});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:var n=t.payload.tool;return Object(Z.a)(Object(Z.a)({},e),{},{selectedTool:n});default:return e}},layers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:var n=t.payload.name;return n||(n="Layer ".concat(e.lastIdx+1)),Object(Z.a)(Object(Z.a)({},e),{},{names:[].concat(Object(W.a)(e.names),[n]),layers:Object(Z.a)(Object(Z.a)({},e.layers),{},Object(Q.a)({},n,{id:e.lastIdx,visible:!0})),selected:n,lastIdx:e.lastIdx+1});case x:var r=t.payload.name,a=e.layers,i=(a[r],Object(J.a)(a,[r].map(K.a))),c=e.names.filter((function(e){return e!==r})),o=e.selected;if(o===r&&c.length>0){var s=Math.max(e.names.indexOf(r)-1,0);o=c[s]}else 0===c.length&&(o="");return Object(Z.a)(Object(Z.a)({},e),{},{names:c,layers:i,selected:o});case b:var l=t.payload.name;return Object(Z.a)(Object(Z.a)({},e),{},{selected:l});case j:var u=t.payload,d=u.name,h=u.to,v=e.names.indexOf(d),p=e.names;return-1!==v&&(p.splice(v,1),p.splice(h,0,d)),Object(Z.a)(Object(Z.a)({},e),{},{names:p});case g:var O=t.payload.name;return Object(Z.a)(Object(Z.a)({},e),{},{layers:Object(Z.a)(Object(Z.a)({},e.layers),{},Object(Q.a)({},O,Object(Z.a)(Object(Z.a)({},e.layers[O]),{},{visible:!e.layers[O].visible})))});default:return e}}}),te=n(6),ne=n.n(te),re=n(10),ae=new function e(){var t=this;Object(Y.a)(this,e),this.init=function(){var e=Object(re.a)(ne.a.mark((function e(r,a){var i,c;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([n.e(0),n.e(4)]).then(n.bind(null,69));case 3:return t.wasm=e.sent,e.next=6,n.e(0).then(n.bind(null,67));case 6:i=e.sent,c=i.memory,t.map=t.wasm.Tilemap.new(),t.memory=c,t.hasInitialized=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("[x] Error loading grid: ".concat(e.t0.message));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),this.width=function(){return t.map.width()},this.height=function(){return t.map.height()},this.addLayer=function(e,n,r,a){e&&n||(e=0,n=0),r&&a||(r=ae.width(),a=ae.height()),t.map.add_layer(e,n,r,a)},this.get=function(e,n,r){return t.map.get(e,n,r)},this.set=function(e,n,r,a){t.map.set(e,n,r,a)},this.fill=function(e,n,r,a){t.map.fill(e,n,r,a)},this.dump=function(e){},console.log("DEBUG: CONSTRUCTING GRID"),this.hasInitialized=!1},ie=ae,ce=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||G.d,oe=Object(G.e)(ee,ce(Object(G.a)((function(e){return function(e){return function(t){switch(t.type){case f:var n=t.payload||{},r=n.x,a=n.y,i=n.width,c=n.height;ae.addLayer(r,a,i,c)}return e(t)}}}))));function se(e,t,n){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(r);console.error("Could not compile shader: "+a)}return r}var le=function e(t,n,r){var a=this;Object(Y.a)(this,e),this.init=function(){var e=se(a.gl,a.vertexSource,a.gl.VERTEX_SHADER),t=se(a.gl,a.fragmentSource,a.gl.FRAGMENT_SHADER);if(a.id=a.gl.createProgram(),a.gl.attachShader(a.id,e),a.gl.attachShader(a.id,t),a.gl.linkProgram(a.id),!a.gl.getProgramParameter(a.id,a.gl.LINK_STATUS))return console.error("Unable to initialize the shader program: "+a.gl.getProgramInfoLog(a.id)),null},this.use=function(){a.gl.useProgram(a.id)},this.setMat4=function(e,t){a.gl.uniformMatrix4fv(a.gl.getUniformLocation(a.id,e),!1,t)},this.setInt=function(e,t){a.gl.uniform1i(a.gl.getUniformLocation(a.id,e),t)},this.gl=t,this.vertexSource=n,this.fragmentSource=r,this.init()},ue=n(30),de=n(23),he=new de.a("textures-store","textures"),ve=function(){var e=Object(re.a)(ne.a.mark((function e(){var t;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(de.c)(he);case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=Object(re.a)(ne.a.mark((function e(t){return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(de.b)(t,he);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=Object(re.a)(ne.a.mark((function e(t,n){return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(de.d)(t,n,he);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),be=function(){var e=Object(re.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe(t);case 3:if((n=e.sent).file){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",createImageBitmap(n.file));case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),je=function(e,t,n){n=n||[0,0];var r=e.target.getBoundingClientRect();Math.floor(e.target.width/t[0]);return[Math.floor((e.clientX+n[0]-r.left)/t[0]),Math.floor((e.clientY+n[1]-r.top)/t[1])]},ge=function(e,t,n){if(t[0]>=n[0]||t[1]>=n[1])return[[0,0],[0,0],[0,0],[0,0]];var r=1*t[0]/n[0],a=1*t[1]/n[1],i=Math.floor(n[0]/t[0]),c=Math.floor(n[1]/t[1]),o=i*c,s=Math.floor(e%i),l=Math.floor(e%o/i),u=s*(n[0]/i)*1/n[0],d=l*(n[1]/c)/n[1];return[[u,d],[u+r,d],[u+r,d+a],[u,d+a]]},pe=function e(t,n){var r=this;Object(Y.a)(this,e),this.create=function(e){r.id=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r.id),r.width=1,r.height=1;var t=new Uint8Array([0,0,0,0]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,t),be(r.name).then((function(t){t&&(r.width=t.width,r.height=t.height,e.bindTexture(e.TEXTURE_2D,r.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))}))},this.bind=function(e){e.bindTexture(e.TEXTURE_2D,r.id)},this.getUV=function(e,t){return ge(e,t,[r.width,r.height])},this.name=n,this.create(t)},Oe=function(){function e(){var t=this;Object(Y.a)(this,e),this.add=function(e,n){t.indexMap.set(n,t.map.size),t.map.set(n,new pe(e,n))},this.map=new Map,this.indexMap=new Map}return Object(ue.a)(e,[{key:"get",value:function(e){return this.map.get(e)}},{key:"getIndex",value:function(e){return this.indexMap.get(e)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"remove",value:function(e){this.map.delete(e)}}]),e}(),me=new function e(){var t=this;Object(Y.a)(this,e),this.addTilesFromTileset=function(){var e=Object(re.a)(ne.a.mark((function e(n,r){var a,i,c,o,s,l;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(n);case 2:for(a=e.sent,i=Math.floor(a.width/r[0]),c=Math.floor(a.height/r[1]),o=0;o<c;o++)for(s=0;s<i;s++)l=ge(o*i+s,r,[a.width,a.height]),t.tiles.set(t.length,{size:r,texture:n,uv:l}),++t.length;case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.get=function(e){return t.debug||(t.debug=!0),t.tiles.get(e)},this.tiles=new Map,this.length=0},ye="uMVP",Te="uSamplers",Ee="aPosition",we="aTextureCoord",Ie="aTextureIdx",Re="aColor",Ae="#version 300 es\n\n      in vec2 ".concat(Ee,";\n      in float ").concat(Ie,";\n      in vec2 ").concat(we,";\n      in vec4 ").concat(Re,";\n\n      out vec2 vTextureCoord;\n      out float vTextureIdx;\n      out vec4 vColor;\n\n      uniform mat4 ").concat(ye,";\n\n      void main() {\n        gl_Position = ").concat(ye," * vec4(aPosition, 0.0, 1.0);\n        vTextureCoord = ").concat(we,";\n        vTextureIdx = ").concat(Ie,";\n        vColor = ").concat(Re,";\n      }\n      "),Ce="#version 300 es\n\n      precision mediump float;\n\n      in vec2 vTextureCoord;\n      in float vTextureIdx;\n      in vec4 vColor;\n\n      out vec4 oColor;\n\n      uniform sampler2D ".concat(Te,"[11];\n\n      void main() {\n        vec4 finalColor = vec4(0.0);\n        int tid = int(vTextureIdx + 0.5);\n\n        switch (tid)\n        {\n          case 0:\n            finalColor = texture(").concat(Te,"[0], vTextureCoord);\n            break;\n          case 1:\n            finalColor = texture(").concat(Te,"[1], vTextureCoord);\n            break;\n          case 2:\n            finalColor = texture(").concat(Te,"[2], vTextureCoord);\n            break;\n          case 3:\n            finalColor = texture(").concat(Te,"[3], vTextureCoord);\n            break;\n          case 4:\n            finalColor = texture(").concat(Te,"[4], vTextureCoord);\n            break;\n          case 5:\n            finalColor = texture(").concat(Te,"[5], vTextureCoord);\n            break;\n          case 6:\n            finalColor = texture(").concat(Te,"[6], vTextureCoord);\n            break;\n          case 7:\n            finalColor = texture(").concat(Te,"[7], vTextureCoord);\n            break;\n          case 8:\n            finalColor = texture(").concat(Te,"[8], vTextureCoord);\n            break;\n          case 9:\n            finalColor = texture(").concat(Te,"[9], vTextureCoord);\n            break;\n          case 10:\n            finalColor = texture(").concat(Te,"[10], vTextureCoord);\n            break;\n        }\n\n        oColor = finalColor;\n      }\n      "),Le=function e(t,n){var r=this;Object(Y.a)(this,e),this.create=function(){r.vertices=new Float32Array(36e4),r.indices=function(e){for(var t=0,n=new Uint16Array(e),r=0;r<e;r+=6)n[r]=t,n[r+1]=t+1,n[r+2]=t+2,n[r+3]=t,n[r+4]=t+2,n[r+5]=t+3,t+=4;return n}(6e4),r.VAO=r.gl.createVertexArray(),r.VBO=r.gl.createBuffer(),r.EBO=r.gl.createBuffer(),r.gl.bindVertexArray(r.VAO),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.VBO),r.gl.bufferData(r.gl.ARRAY_BUFFER,r.vertices,r.gl.DYNAMIC_DRAW);var e=r.gl.getAttribLocation(r.shaderProgram.id,Ee);r.gl.vertexAttribPointer(e,2,r.gl.FLOAT,!1,36,0),r.gl.enableVertexAttribArray(e);var t=r.gl.getAttribLocation(r.shaderProgram.id,we);r.gl.vertexAttribPointer(t,2,r.gl.FLOAT,!1,36,8),r.gl.enableVertexAttribArray(t);var n=r.gl.getAttribLocation(r.shaderProgram.id,Ie);r.gl.vertexAttribPointer(n,1,r.gl.FLOAT,!1,36,16),r.gl.enableVertexAttribArray(n);var a=r.gl.getAttribLocation(r.shaderProgram.id,Re);r.gl.vertexAttribPointer(a,4,r.gl.FLOAT,!1,36,20),r.gl.enableVertexAttribArray(a),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,r.EBO),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,r.indices,r.gl.STATIC_DRAW),r.vertexIndex=0,r.indexCount=0},this.begin=function(){r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.VBO)},this.emplace=function(e,t,n){var a=me.get(e);if(a){var i=0,c=0,o=0,s=0;n&&(i=n.r,c=n.g,o=n.b,s=n.a);var l=0;r.textureManager.has(a.texture)||r.textureManager.add(r.gl,a.texture),l=r.textureManager.getIndex(a.texture),r.vertices[r.vertexIndex++]=t[0],r.vertices[r.vertexIndex++]=t[1],r.vertices[r.vertexIndex++]=a.uv[0][0],r.vertices[r.vertexIndex++]=a.uv[0][1],r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=t[0]+a.size[0],r.vertices[r.vertexIndex++]=t[1],r.vertices[r.vertexIndex++]=a.uv[1][0],r.vertices[r.vertexIndex++]=a.uv[1][1],r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=t[0]+a.size[0],r.vertices[r.vertexIndex++]=t[1]+a.size[1],r.vertices[r.vertexIndex++]=a.uv[2][0],r.vertices[r.vertexIndex++]=a.uv[2][1],r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=s,r.vertices[r.vertexIndex++]=t[0],r.vertices[r.vertexIndex++]=t[1]+a.size[1],r.vertices[r.vertexIndex++]=a.uv[3][0],r.vertices[r.vertexIndex++]=a.uv[3][1],r.vertices[r.vertexIndex++]=l,r.vertices[r.vertexIndex++]=i,r.vertices[r.vertexIndex++]=c,r.vertices[r.vertexIndex++]=o,r.vertices[r.vertexIndex++]=s,r.indexCount+=6}else console.error("Could not get tile data for tile ".concat(a))},this.flush=function(){r.gl.bufferSubData(r.gl.ARRAY_BUFFER,0,r.vertices.subarray(0,r.vertexIndex)),r.vertexIndex=0},this.render=function(e){if(0!==r.indexCount){var t=0;r.textureManager.map.forEach((function(e){r.gl.activeTexture(r.gl.TEXTURE0+t),e.bind(r.gl),r.shaderProgram.setInt("".concat(Te,"[").concat(t,"]"),t),++t})),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.bindVertexArray(r.VAO),r.gl.drawElements(r.gl.TRIANGLES,r.indexCount,r.gl.UNSIGNED_SHORT,0),r.indexCount=0}},this.gl=t,this.shaderProgram=n,this.textures=[],this.textureManager=new Oe,this.create()},Me=n(19),Se=[.25,.5,.75,1,1.25,1.5,1.75],Pe=function e(t,n){var r=this;Object(Y.a)(this,e),this.setOrigin=function(e,t){r.origin=[r.position[0],r.position[1]],r.clientOrigin=[e,t]},this.moveTo=function(e,t){r.position=[r.origin[0]+(r.clientOrigin[0]-e),r.origin[1]+(r.clientOrigin[1]-t),r.cameraZ],r.calculateMvp()},this.setZoom=function(e){r.zoom=r.clampZoom(e),r.calculateMvp()},this.applyZoom=function(e){r.zoom+=e,Math.abs(r.zoom)<10||(r.zoom<0?r.zoomLevel=Math.max(0,r.zoomLevel-1):r.zoom>0&&(r.zoomLevel=Math.min(Se.length-1,r.zoomLevel+1)),r.perceivedWidth=r.width/Se[r.zoomLevel],r.perceivedHeight=r.height/Se[r.zoomLevel],r.zoom=0,r.calculateMvp())},this.getMvp=function(){return r.mvp},this.getZoomLevel=function(){return Se[r.zoomLevel]},this.calculateMvp=function(){var e=r.position[0]/Se[r.zoomLevel],t=r.position[1]/Se[r.zoomLevel];Me.a.ortho(r.projection,e,r.perceivedWidth+e,r.perceivedHeight+t,t,r.near,r.far),Me.a.multiply(r.mvp,r.projection,r.modelView)},this.width=t,this.height=n,this.zoomLevel=3,this.zoom=0,this.perceivedWidth=this.width,this.perceivedHeight=this.height,this.origin=[0,0],this.clientOrigin=[0,0],this.cameraZ=80,this.position=[0,0,this.cameraZ],this.near=.1,this.far=100,this.projection=Me.a.create(),this.modelView=Me.a.create(),this.mvp=Me.a.create(),Me.a.translate(this.modelView,this.modelView,[0,0,-this.cameraZ]),this.calculateMvp()},Ne=[32,32],ke=new function e(){var t=this;Object(Y.a)(this,e),this.hasInitialized=!1,this.init=function(e){console.log("DEBUG: CONSTRUCTING RENDERER"),t.gl=e,t.gl&&(t.shaderProgram=new le(t.gl,Ae,Ce),t.shaderProgram.use(),t.camera=new Pe(t.gl.canvas.width,t.gl.canvas.height),t.shaderProgram.setMat4(ye,t.camera.getMvp()),t.batch=new Le(t.gl,t.shaderProgram),t.hasInitialized=!0)},this.setClearColor=function(e,n,r,a){t.gl.clearColor(e,n,r,a)},this.render=function(){t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.renderGrid(),window.requestAnimationFrame(t.render)},this.renderGrid=function(){if(ie.hasInitialized){t.shaderProgram.use();var e=t.gl.canvas.width,n=t.gl.canvas.height,r=oe.getState().layers;t.shaderProgram.setMat4(ye,t.camera.getMvp()),t.batch.begin();var a,i=Object(X.a)(r.names);try{for(i.s();!(a=i.n()).done;){var c=a.value,o=r.layers[c];if(o.visible&&o.id>=0)for(var s=0,l=0;l<n;s++,l+=Ne[1])for(var u=0,d=0;d<e;u++,d+=Ne[0]){var h=ie.get(u,s,o.id);-1!=h&&t.batch.emplace(h,[d,l])}}}catch(v){i.e(v)}finally{i.f()}t.batch.flush(),t.batch.render(t.shaderProgram)}}},_e=Object(a.forwardRef)((function(e,t){var n=e.id,a=e.style,i=e.onMouseDown,c=e.onMouseMove,o=e.onMouseUp,s=e.onWheel,l=e.onDragStart,u=e.onDrag;return Object(r.jsx)("canvas",{id:n,style:Object(Z.a)(Object(Z.a)({},a),{},{position:"absolute",top:"0",left:"0"}),onMouseDown:i,onMouseMove:c,onMouseUp:o,onWheel:s,onDragStart:l,onDrag:u,draggable:"true",ref:t})})),Ue=[32,32],De=function(){var e=Object(s.c)(),t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current&&(t.current.width=t.current.clientWidth,t.current.height=t.current.clientHeight,ie.hasInitialized||ie.init().then((function(){e(m(null,0,0,Math.floor(t.current.width/Ue[0])+1,Math.floor(t.current.height/Ue[1])+1))})),ke.hasInitialized||(ke.init(t.current.getContext("webgl2")),ke.setClearColor(55/255,65/255,81/255,1),window.requestAnimationFrame(ke.render)))}),[e]),Object(r.jsx)(_e,{id:"tilemap-canvas",style:{width:"100%",height:"100%",zIndex:"0"},ref:t})},ze=n(17),Fe=[32,32],Be=function(){var e=Object(a.useRef)(),t=Object(a.useState)(!1),n=Object(ze.a)(t,2),i=n[0],c=n[1],o=Object(s.d)((function(e){return{selectedLayer:e.layers.selected,layers:e.layers.layers}})),l=o.selectedLayer,u=o.layers,d=Object(s.d)((function(e){return e.tileset.selectedTile})),h=Object(s.d)((function(e){return e.canvas.selectedTool}));Object(a.useEffect)((function(){e.current&&(e.current.width=e.current.clientWidth,e.current.height=e.current.clientHeight)}),[]),Object(a.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.body.addEventListener("wheel",e,{passive:!1}),function(){document.body.removeEventListener("wheel",e)}}),[]);var v=function(e){var t=ke.camera.getZoomLevel(),n=je(e,[Fe[0]*t,Fe[1]*t],ke.camera.position),r=u[l].id;switch(h){case I:break;case R:d&&-1!==d&&ie.set.apply(ie,Object(W.a)(n).concat([d,r]))}};return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,r=Object(a.useRef)();Object(a.useEffect)((function(){r.current=t}),[t]),Object(a.useEffect)((function(){if(n&&n.addEventListener){var t=function(e){return r.current(e)};return n.addEventListener(e,t),function(){n.removeEventListener(e,t)}}}),[e,n])}("mouseup",(function(){i&&c(!1)}),document),Object(r.jsx)(_e,{id:"editor-canvas",style:{width:"100%",height:"100%",zIndex:"1"},onMouseDown:function(e){c(!0),v(e)},onMouseMove:function(e){i&&v(e)},onMouseUp:function(e){c(!0),function(e){var t=ke.camera.getZoomLevel(),n=je(e,[Fe[0]*t,Fe[1]*t],ke.camera.position),r=u[l].id;switch(h){case A:ie.fill.apply(ie,Object(W.a)(n).concat([d,r]))}}(e)},onWheel:function(e){e.altKey&&ke.camera.applyZoom(e.deltaY)},onDragStart:function(e){ke.camera.setOrigin(e.clientX,e.clientY)},onDrag:function(e){0!=e.clientX&&0!=e.clientY&&ke.camera.moveTo(e.clientX,e.clientY)},ref:e})},Ve=function(){return Object(r.jsxs)("div",{className:"col-span-3 flex flex-col",children:[Object(r.jsx)(V,{}),Object(r.jsxs)("section",{className:"relative flex-1 bg-gray-600",children:[Object(r.jsx)(Be,{}),Object(r.jsx)(De,{})]})]})},Xe=n(24),Ye=function(e){var t=e.iconPath,n=e.routerPath;return Object(r.jsx)(Xe.b,{to:n,activeClassName:"text-indigo-200 bg-indigo-900",children:Object(r.jsx)("button",{className:"px-2 py-3 hover:text-indigo-400 hover:bg-indigo-900","data-tip":!0,"data-for":n,children:Object(r.jsx)(w.a,{path:t,size:1.2})})})},Ge=function(){var e=[{path:L,icon:B.p},{path:M,icon:B.i},{path:S,icon:B.o},{path:P,icon:B.b},{path:N,icon:B.a},{path:k,icon:B.h}].map((function(e){return Object(r.jsxs)("div",{className:"flex","data-testid":e.path,children:[Object(r.jsx)(Ye,{routerPath:e.path,iconPath:e.icon}),Object(r.jsx)(T.a,{id:e.path,place:"right",effect:"solid",delayShow:600,children:U.get(e.path)})]},e.path)}));return Object(r.jsx)("div",{className:"flex flex-col justify-end bg-black",children:e})},We=function(e){return e.layers},Ze=function(e){return function(e){return We(e)?We(e).names:[]}(e).map((function(t){return function(e,t){return We(e)?Object(Z.a)(Object(Z.a)({},We(e).layers[t]),{},{name:t}):{}}(e,t)}))},He=function(e){return Ze(e).reverse()},qe=n(28),Je=function(e){var t=e.layer,n=e.index,a=e.isSelected,i=Object(s.c)(),c=function(){i(y(t.name))},o=function(){var e;i((e=t.name,{type:g,payload:{name:e}}))},l=t.visible?B.f:B.g,u=a?"bg-gray-700":"hover:bg-gray-800",d=t.visible?"layer-visible":"layer-hidden";return Object(r.jsx)(qe.b,{draggableId:t.name,index:n,children:function(e,n){var a=Object(Z.a)({cursor:"default"},e.draggableProps.style);return Object(r.jsxs)("li",Object(Z.a)(Object(Z.a)(Object(Z.a)({className:"flex items-center select-none ".concat(u),ref:e.innerRef},e.draggableProps),e.dragHandleProps),{},{style:a,"data-testid":d,children:[Object(r.jsx)("span",{className:"flex-1 pl-4 py-1",onClick:c,children:t.name}),Object(r.jsx)("span",{onClick:o,className:"cursor-pointer pr-4 py-1","data-testid":"hide-layer-button",children:Object(r.jsx)(w.a,{path:l,size:.6})})]}))}})},Ke=function(e){var t=e.selectedLayer,n=Object(s.c)();return Object(r.jsxs)("div",{className:"flex items-center justify-start py-3",children:[Object(r.jsx)("button",{onClick:function(){n(m())},"data-testid":"add-layer-button",children:Object(r.jsx)(w.a,{path:B.n,size:.7})}),Object(r.jsx)("button",{onClick:function(){n({type:x,payload:{name:t}})},"data-testid":"delete-layer-button",children:Object(r.jsx)(w.a,{path:B.e,size:.65})})]})},Qe=function(){var e=Object(s.c)(),t=Object(s.d)((function(e){return{selectedLayer:e.layers.selected,layers:He(e)}})),n=t.selectedLayer,a=t.layers,i=a.map((function(e,t){return Object(r.jsx)(Je,{index:t,layer:e,isSelected:e.name===n},e.name)})),c=a&&a.length?Object(r.jsx)(qe.a,{onDragEnd:function(t){var n,r;e((n=t.draggableId,r=a.length-t.destination.index-1,{type:j,payload:{name:n,to:r}}))},onBeforeDragStart:function(t){e(y(t.draggableId))},children:Object(r.jsx)(qe.c,{droppableId:"layers",children:function(e){return Object(r.jsxs)("ul",Object(Z.a)(Object(Z.a)({},e.droppableProps),{},{ref:e.innerRef,children:[i,e.placeholder]}))}})}):Object(r.jsx)("div",{});return Object(r.jsxs)(r.Fragment,{children:[c,Object(r.jsx)(Ke,{selectedLayer:n})]})},$e=[32,32],et=function(){var e=Object(s.c)(),t=Object(s.d)((function(e){return e.tileset.selectedTileset})),n=Object(a.useState)([-1,-1]),i=Object(ze.a)(n,2),c=i[0],o=i[1],l=Object(a.useState)(0),u=Object(ze.a)(l,2),d=u[0],v=u[1],f=Object(a.useRef)(null),x=Object(a.useRef)(null);Object(a.useEffect)((function(){if(t&&f.current&&x.current){var e=x.current,n=f.current;fe(t).then((function(t){var r=new FileReader;r.onload=function(r){var a=new Image;a.onload=function(){e.width=a.width,e.height=a.height,n.width=a.width,n.height=a.height,e.getContext("2d").drawImage(a,0,0),function(e,t){var n=e.getContext("2d");n.strokeStyle=z,n.lineWidth=1;for(var r=t[0];r<e.height;r+=t[0])n.beginPath(),n.moveTo(0,r+.5),n.lineTo(e.width,r+.5),n.stroke();for(var a=t[1];a<e.width;a+=t[1])n.beginPath(),n.moveTo(a+.5,0),n.lineTo(a+.5,e.height),n.stroke()}(e,$e),v(t.tilesetIndex)},a.src=r.target.result},r.readAsDataURL(t.file)}))}}),[t]),Object(a.useEffect)((function(){if(f.current){var e=f.current,t=e.getContext("2d");t.fillStyle="rgba(79, 70, 229, 0.4)",t.clearRect(0,0,e.width,e.height),t.fillRect(c[0]*$e[0]+1,c[1]*$e[1]+1,$e[0]-1,$e[1]-1)}}),[c]);return""===t?Object(r.jsx)("div",{}):Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)(_e,{id:"grid-canvas",style:{border:"1px solid rgba(0,0,0,0)",zIndex:"1"},onMouseUp:function(t){var n=je(t,$e),r=d+n[1]*Math.floor(t.target.width/$e[0])+n[0];e({type:h,payload:{value:r}}),o(n)},ref:f}),Object(r.jsx)(_e,{id:"tileset-canvas",style:{border:"1px solid ".concat(z),zIndex:"0"},ref:x})]})},tt=function(){var e=Object(s.c)(),t=Object(s.d)((function(e){return e.tileset})),n=t.selectedTileset,i=t.tilesetNames;Object(a.useEffect)((function(){var t=localStorage.getItem(D);t&&e(O(t))}),[e]);var c,o=[],l=Object(X.a)(i);try{for(l.s();!(c=l.n()).done;){var u=c.value;o.push(Object(r.jsx)("option",{value:u,"data-testid":u,children:u},u))}}catch(d){l.e(d)}finally{l.f()}return i.length>0&&Object(r.jsx)("select",{className:"text-gray-900",value:n,onChange:function(t){var n=t.target.value;localStorage.setItem(D,n),e(O(n))},"data-testid":"select-tileset",children:o})},nt=n(40),rt=(n(63),function(e){var t=e.title,n=e.children,i=Object(a.useState)(!0),c=Object(ze.a)(i,2),o=c[0],s=c[1],l=o?B.k:B.j;return Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{className:"flex items-center border-b border-gray-50 cursor-pointer",onDoubleClick:function(e){return s(!o)},children:[Object(r.jsx)(w.a,{path:l,size:1}),Object(r.jsx)("h1",{className:"text-sm select-none",children:t})]}),Object(r.jsx)(nt.Collapse,{isOpened:o,children:Object(r.jsx)("div",{className:"text-xs px-2 py-4",children:n})})]})}),at=function(e){var t=e.title,n=e.onUpload;return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:t}),Object(r.jsx)("input",{type:"file",min:"1",max:"100",value:"",onChange:n})]})},it=function(){var e=Object(s.c)();Object(a.useEffect)((function(){ve().then(function(){var t=Object(re.a)(ne.a.mark((function t(n){var r,a,i;return ne.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:u,payload:{names:n}}),r=Object(X.a)(n.reverse()),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=10;break}return i=a.value,t.next=8,me.addTilesFromTileset(i,[32,32]);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[2,12,15,18]])})));return function(e){return t.apply(this,arguments)}}())}),[e]);var t=function(){var t=Object(re.a)(ne.a.mark((function t(n){var r,a;return ne.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.target.files.length<=0)){t.next=2;break}return t.abrupt("return");case 2:if(r=n.target.files[0].name,t.prev=3,a=n.target.files[0]){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,xe(r,{file:a,tilesetIndex:me.length});case 9:t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(3),console.error(t.t0),t.abrupt("return");case 15:me.addTilesFromTileset(r,[32,32]),localStorage.setItem(D,r),e(p(r));case 18:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(rt,{title:"Layers",children:Object(r.jsx)(Qe,{})}),Object(r.jsxs)(rt,{title:"Tileset",children:[Object(r.jsx)(tt,{}),Object(r.jsx)(at,{title:"Add Tileset",onUpload:function(e){return t(e)}}),Object(r.jsx)(et,{})]})]})};function ct(e){return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:Object(r.jsx)("strong",{children:e.title})}),Object(r.jsxs)("span",{children:[e.value,"px"]}),Object(r.jsx)("input",{type:"range",min:"1",max:"100",value:e.value,onChange:e.onChange})]})}var ot=function(e){var t=Object(a.useState)(32),n=Object(ze.a)(t,2),i=n[0],c=n[1];return Object(r.jsxs)("div",{children:[Object(r.jsx)("h3",{children:"Map"}),Object(r.jsx)(ct,{title:"Tile size",onChange:function(e){return c(e.target.value)},value:i})]})},st=function(){return Object(r.jsx)("div",{children:Object(r.jsx)("h3",{children:"Import"})})},lt=function(e){var t=e.format,n=e.onOptionSelected,a=["json","tmx"].map((function(e){return Object(r.jsx)("option",{value:e,children:e},e)}));return Object(r.jsx)("select",{className:"text-gray-900",value:t,onChange:n,children:a})},ut=function(){var e=Object(a.useState)("tmx"),t=Object(ze.a)(e,2),n=t[0],i=t[1],c=function(){var e=Object(re.a)(ne.a.mark((function e(){var t,r,a,i;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ie.dump(n),r="tilemap."+n,a=new Blob([t],{type:"application/xml"}),(i=document.createElement("a")).href=URL.createObjectURL(a),i.download=r,i.click();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)("h3",{children:"Export"}),Object(r.jsx)(lt,{format:n,onOptionSelected:function(e){i(e.target.value)}}),Object(r.jsx)("button",{className:"bg-indigo-900 my-3 py-2 px-4 flex justify-center rounded cursor-pointer",onClick:c,children:"Export"})]})},dt=function(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("h1",{children:"Project Settings"}),Object(r.jsx)("label",{htmlFor:"show-grid",children:"Show grid"}),Object(r.jsx)("input",{type:"checkbox",name:"show-grid"})]})},ht=function(){return Object(r.jsx)("div",{children:Object(r.jsx)("h3",{children:"Help"})})},vt=n(7),ft=function(){return Object(r.jsxs)("aside",{className:"flex flex-row bg-gray-900",children:[Object(r.jsx)(Ge,{}),Object(r.jsx)("div",{className:"flex-1",children:Object(r.jsxs)(vt.c,{children:[Object(r.jsx)(vt.a,{path:"/".concat(L),children:Object(r.jsx)(it,{})}),Object(r.jsx)(vt.a,{path:"/".concat(M),children:Object(r.jsx)(ot,{})}),Object(r.jsx)(vt.a,{path:"/".concat(S),children:Object(r.jsx)(st,{})}),Object(r.jsx)(vt.a,{path:"/".concat(P),children:Object(r.jsx)(ut,{})}),Object(r.jsx)(vt.a,{path:"/".concat(N),children:Object(r.jsx)(dt,{})}),Object(r.jsx)(vt.a,{path:"/".concat(k),children:Object(r.jsx)(ht,{})})]})})]})},xt=function(){return Object(r.jsx)("div",{className:"h-screen w-screen flex flex-col text-gray-50 bg-gray-900",children:Object(r.jsxs)("main",{className:"flex-1 grid grid-cols-4",children:[Object(r.jsx)(Xe.a,{children:Object(r.jsx)(ft,{})}),Object(r.jsx)(Ve,{})]})})};n(64);o.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(s.a,{store:oe,children:Object(r.jsx)(xt,{})})}),document.getElementById("root"))}},[[65,2,3]]]);
//# sourceMappingURL=main.6ced32f2.chunk.js.map