(this.webpackJsonpaestyle=this.webpackJsonpaestyle||[]).push([[1],{63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(0),s=a.n(r),d=a(20),c=a.n(d),i=a(5),j="[TILESET] Add one",o="[TILESET] Add multiple",l="[TILESET] Select",k="[TILE] Select",u="[TOOL] Select",h="[LAYER] Add one",v="[LAYER] Delete",f="[LAYER] Select",x="[LAYER] Move",b="[LAYER] Toggle Visibility",g=function(e){return{type:j,payload:{name:e}}},p=function(e){return{type:l,payload:{name:e}}},O=function(e){return{type:u,payload:{tool:e}}},m=function(e,t,a,n,r){return{type:h,payload:{name:e,x:t,y:a,width:n,height:r}}},y=function(e){return{type:f,payload:{name:e}}},T=a(31),w=a(16),E=a.n(w),I="DEFAULT_TOOL",R="PLACEMENT_TOOL",A="FILL_TOOL",C="MOVE_TOOL",L="PAN_TOOL",M="tiles",S="map",N="import",P="save",_="settings",U="help",D=new Map;D.set(I,"default tool"),D.set(R,"placement tool"),D.set(A,"fill tool"),D.set(C,"move tool"),D.set(M,"tab tiles"),D.set(S,"tab map"),D.set(N,"tab import"),D.set(P,"tab export"),D.set(_,"settings tab"),D.set(U,"help tab");var z=D,B="lastSelectedTileset",F=function(e){var t=e.iconPath,a=e.tool,r=Object(i.c)(),s=Object(i.d)((function(e){return e.canvas.selectedTool})),d=a===s?"text-indigo-400 hover:text-indigo-500":"hover:text-indigo-500 cursor-pointer";return Object(n.jsxs)("button",{className:"px-4 py-2 cursor-default",role:"button","data-testid":a===s?"selected-tool":"",children:[Object(n.jsx)("div",{className:d,onClick:function(){r(O(a))},"data-tip":!0,"data-for":a,"data-testid":a,children:Object(n.jsx)(E.a,{path:t,size:.75})}),Object(n.jsx)(T.a,{id:a,place:"bottom",effect:"solid",delayShow:600,children:z.get(a)})]})},V="border-gray-600",X="h-9",Y=a(8),G=function(){return Object(n.jsx)("nav",{className:"flex flex-row items-stretch bg-black border-b ".concat(V," ").concat("h-9"),children:Object(n.jsxs)("div",{className:"flex flex-row justify-start items-center flex-grow",children:[Object(n.jsx)(F,{iconPath:Y.c,tool:I}),Object(n.jsx)(F,{iconPath:Y.m,tool:R}),Object(n.jsx)(F,{iconPath:Y.l,tool:A}),Object(n.jsx)(F,{iconPath:Y.d,tool:C})]})})},W=a(21),Z=a(9),H=a(14),q=a(18),J=a(4),K={tilesetNames:[],selectedTileset:"",selectedTile:-1},Q={selectedTool:I},$=a(42),ee=a(41),te=a(27),ae={selected:"",names:[],layers:{},lastIdx:0},ne=Object(H.c)({tileset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o:var a=t.payload.names;return Object(J.a)(Object(J.a)({},e),{},{tilesetNames:[].concat(Object(q.a)(e.tilesetNames),Object(q.a)(a))});case j:var n=t.payload.name;return Object(J.a)(Object(J.a)({},e),{},{tilesetNames:[].concat(Object(q.a)(e.tilesetNames),[n]),selectedTileset:n});case l:var r=t.payload.name;return Object(J.a)(Object(J.a)({},e),{},{selectedTileset:r});case k:var s=t.payload.value;return Object(J.a)(Object(J.a)({},e),{},{selectedTile:s});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:var a=t.payload.tool;return Object(J.a)(Object(J.a)({},e),{},{selectedTool:a});default:return e}},layers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:var a=t.payload.name;return a||(a="Layer ".concat(e.lastIdx+1)),Object(J.a)(Object(J.a)({},e),{},{names:[].concat(Object(q.a)(e.names),[a]),layers:Object(J.a)(Object(J.a)({},e.layers),{},Object(te.a)({},a,{id:e.lastIdx,visible:!0})),selected:a,lastIdx:e.lastIdx+1});case v:var n=t.payload.name,r=e.layers,s=(r[n],Object($.a)(r,[n].map(ee.a))),d=e.names.filter((function(e){return e!==n})),c=e.selected;if(c===n&&d.length>0){var i=Math.max(e.names.indexOf(n)-1,0);c=d[i]}else 0===d.length&&(c="");return Object(J.a)(Object(J.a)({},e),{},{names:d,layers:s,selected:c});case f:var j=t.payload.name;return Object(J.a)(Object(J.a)({},e),{},{selected:j});case x:var o=t.payload,l=o.name,k=o.to,u=e.names.indexOf(l),g=e.names;return-1!==u&&(g.splice(u,1),g.splice(k,0,l)),Object(J.a)(Object(J.a)({},e),{},{names:g});case b:var p=t.payload.name;return Object(J.a)(Object(J.a)({},e),{},{layers:Object(J.a)(Object(J.a)({},e.layers),{},Object(te.a)({},p,Object(J.a)(Object(J.a)({},e.layers[p]),{},{visible:!e.layers[p].visible})))});default:return e}}}),re=a(6),se=a.n(re),de=a(10),ce=new function e(){var t=this;Object(Z.a)(this,e),this.init=function(){var e=Object(de.a)(se.a.mark((function e(n,r){var s,d;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([a.e(0),a.e(4)]).then(a.bind(null,69));case 3:return t.wasm=e.sent,e.next=6,a.e(0).then(a.bind(null,67));case 6:s=e.sent,d=s.memory,t.map=t.wasm.Tilemap.new(),t.memory=d,t.hasInitialized=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("[x] Error loading grid: ".concat(e.t0.message));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,a){return e.apply(this,arguments)}}(),this.width=function(){return t.map.width()},this.height=function(){return t.map.height()},this.addLayer=function(e,a,n,r){e&&a||(e=0,a=0),n&&r||(n=ce.width(),r=ce.height()),t.map.add_layer(e,a,n,r)},this.get=function(e,a,n){return t.map.get(e,a,n)},this.set=function(e,a,n,r){t.map.set(e,a,n,r)},this.fill=function(e,a,n,r){t.map.fill(e,a,n,r)},this.dump=function(e){},console.log("DEBUG: CONSTRUCTING GRID"),this.hasInitialized=!1},ie=ce,je=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||H.d,oe=Object(H.e)(ne,je(Object(H.a)((function(e){return function(e){return function(t){switch(t.type){case h:var a=t.payload||{},n=a.x,r=a.y,s=a.width,d=a.height;ce.addLayer(n,r,s,d)}return e(t)}}}))));function le(e,t,a){var n=e.createShader(a);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var r=e.getShaderInfoLog(n);console.error("Could not compile shader: "+r)}return n}var ke=function e(t,a,n){var r=this;Object(Z.a)(this,e),this.init=function(){var e=le(r.gl,r.vertexSource,r.gl.VERTEX_SHADER),t=le(r.gl,r.fragmentSource,r.gl.FRAGMENT_SHADER);if(r.id=r.gl.createProgram(),r.gl.attachShader(r.id,e),r.gl.attachShader(r.id,t),r.gl.linkProgram(r.id),!r.gl.getProgramParameter(r.id,r.gl.LINK_STATUS))return console.error("Unable to initialize the shader program: "+r.gl.getProgramInfoLog(r.id)),null},this.use=function(){r.gl.useProgram(r.id)},this.setMat4=function(e,t){r.gl.uniformMatrix4fv(r.gl.getUniformLocation(r.id,e),!1,t)},this.setInt=function(e,t){r.gl.uniform1i(r.gl.getUniformLocation(r.id,e),t)},this.gl=t,this.vertexSource=a,this.fragmentSource=n,this.init()},ue=a(30),he=a(23),ve=new he.a("textures-store","textures"),fe=function(){var e=Object(de.a)(se.a.mark((function e(){var t;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(he.c)(ve);case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=Object(de.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(he.b)(t,ve);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=Object(de.a)(se.a.mark((function e(t,a){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(he.d)(t,a,ve);case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ge=function(){var e=Object(de.a)(se.a.mark((function e(t){var a;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,xe(t);case 3:if((a=e.sent).file){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",createImageBitmap(a.file));case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e,t,a){a=a||[0,0];var n=e.target.getBoundingClientRect();Math.floor(e.target.width/t[0]);return[Math.floor((e.clientX+a[0]-n.left)/t[0]),Math.floor((e.clientY+a[1]-n.top)/t[1])]},Oe=function(e,t,a){if(t[0]>=a[0]||t[1]>=a[1])return[[0,0],[0,0],[0,0],[0,0]];var n=1*t[0]/a[0],r=1*t[1]/a[1],s=Math.floor(a[0]/t[0]),d=Math.floor(a[1]/t[1]),c=s*d,i=Math.floor(e%s),j=Math.floor(e%c/s),o=i*(a[0]/s)*1/a[0],l=j*(a[1]/d)/a[1];return[[o,l],[o+n,l],[o+n,l+r],[o,l+r]]},me=function e(t,a){var n=this;Object(Z.a)(this,e),this.create=function(e){n.id=e.createTexture(),e.bindTexture(e.TEXTURE_2D,n.id),n.width=1,n.height=1;var t=new Uint8Array([0,0,0,0]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,t),ge(n.name).then((function(t){t&&(n.width=t.width,n.height=t.height,e.bindTexture(e.TEXTURE_2D,n.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))}))},this.bind=function(e){e.bindTexture(e.TEXTURE_2D,n.id)},this.getUV=function(e,t){return Oe(e,t,[n.width,n.height])},this.name=a,this.create(t)},ye=function(){function e(){var t=this;Object(Z.a)(this,e),this.add=function(e,a){t.indexMap.set(a,t.map.size),t.map.set(a,new me(e,a))},this.map=new Map,this.indexMap=new Map}return Object(ue.a)(e,[{key:"get",value:function(e){return this.map.get(e)}},{key:"getIndex",value:function(e){return this.indexMap.get(e)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"remove",value:function(e){this.map.delete(e)}}]),e}(),Te=new function e(){var t=this;Object(Z.a)(this,e),this.addTilesFromTileset=function(){var e=Object(de.a)(se.a.mark((function e(a,n){var r,s,d,c,i,j;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(a);case 2:for(r=e.sent,s=Math.floor(r.width/n[0]),d=Math.floor(r.height/n[1]),c=0;c<d;c++)for(i=0;i<s;i++)j=Oe(c*s+i,n,[r.width,r.height]),t.tiles.set(t.length,{size:n,texture:a,uv:j}),++t.length;case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.get=function(e){return t.debug||(t.debug=!0),t.tiles.get(e)},this.tiles=new Map,this.length=0},we="uMVP",Ee="uSamplers",Ie="aPosition",Re="aTextureCoord",Ae="aTextureIdx",Ce="aColor",Le="#version 300 es\n\n      in vec2 ".concat(Ie,";\n      in float ").concat(Ae,";\n      in vec2 ").concat(Re,";\n      in vec4 ").concat(Ce,";\n\n      out vec2 vTextureCoord;\n      out float vTextureIdx;\n      out vec4 vColor;\n\n      uniform mat4 ").concat(we,";\n\n      void main() {\n        gl_Position = ").concat(we," * vec4(aPosition, 0.0, 1.0);\n        vTextureCoord = ").concat(Re,";\n        vTextureIdx = ").concat(Ae,";\n        vColor = ").concat(Ce,";\n      }\n      "),Me="#version 300 es\n\n      precision mediump float;\n\n      in vec2 vTextureCoord;\n      in float vTextureIdx;\n      in vec4 vColor;\n\n      out vec4 oColor;\n\n      uniform sampler2D ".concat(Ee,"[11];\n\n      void main() {\n        vec4 finalColor = vec4(0.0);\n        int tid = int(vTextureIdx + 0.5);\n\n        switch (tid)\n        {\n          case 0:\n            finalColor = texture(").concat(Ee,"[0], vTextureCoord);\n            break;\n          case 1:\n            finalColor = texture(").concat(Ee,"[1], vTextureCoord);\n            break;\n          case 2:\n            finalColor = texture(").concat(Ee,"[2], vTextureCoord);\n            break;\n          case 3:\n            finalColor = texture(").concat(Ee,"[3], vTextureCoord);\n            break;\n          case 4:\n            finalColor = texture(").concat(Ee,"[4], vTextureCoord);\n            break;\n          case 5:\n            finalColor = texture(").concat(Ee,"[5], vTextureCoord);\n            break;\n          case 6:\n            finalColor = texture(").concat(Ee,"[6], vTextureCoord);\n            break;\n          case 7:\n            finalColor = texture(").concat(Ee,"[7], vTextureCoord);\n            break;\n          case 8:\n            finalColor = texture(").concat(Ee,"[8], vTextureCoord);\n            break;\n          case 9:\n            finalColor = texture(").concat(Ee,"[9], vTextureCoord);\n            break;\n          case 10:\n            finalColor = texture(").concat(Ee,"[10], vTextureCoord);\n            break;\n        }\n\n        oColor = finalColor;\n      }\n      "),Se=function e(t,a){var n=this;Object(Z.a)(this,e),this.create=function(){n.vertices=new Float32Array(36e4),n.indices=function(e){for(var t=0,a=new Uint16Array(e),n=0;n<e;n+=6)a[n]=t,a[n+1]=t+1,a[n+2]=t+2,a[n+3]=t,a[n+4]=t+2,a[n+5]=t+3,t+=4;return a}(6e4),n.VAO=n.gl.createVertexArray(),n.VBO=n.gl.createBuffer(),n.EBO=n.gl.createBuffer(),n.gl.bindVertexArray(n.VAO),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,n.VBO),n.gl.bufferData(n.gl.ARRAY_BUFFER,n.vertices,n.gl.DYNAMIC_DRAW);var e=n.gl.getAttribLocation(n.shaderProgram.id,Ie);n.gl.vertexAttribPointer(e,2,n.gl.FLOAT,!1,36,0),n.gl.enableVertexAttribArray(e);var t=n.gl.getAttribLocation(n.shaderProgram.id,Re);n.gl.vertexAttribPointer(t,2,n.gl.FLOAT,!1,36,8),n.gl.enableVertexAttribArray(t);var a=n.gl.getAttribLocation(n.shaderProgram.id,Ae);n.gl.vertexAttribPointer(a,1,n.gl.FLOAT,!1,36,16),n.gl.enableVertexAttribArray(a);var r=n.gl.getAttribLocation(n.shaderProgram.id,Ce);n.gl.vertexAttribPointer(r,4,n.gl.FLOAT,!1,36,20),n.gl.enableVertexAttribArray(r),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,n.EBO),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,n.indices,n.gl.STATIC_DRAW),n.vertexIndex=0,n.indexCount=0},this.begin=function(){n.gl.bindBuffer(n.gl.ARRAY_BUFFER,n.VBO)},this.emplace=function(e,t,a){var r=Te.get(e);if(r){var s=0,d=0,c=0,i=0;a&&(s=a.r,d=a.g,c=a.b,i=a.a);var j=0;n.textureManager.has(r.texture)||n.textureManager.add(n.gl,r.texture),j=n.textureManager.getIndex(r.texture),n.vertices[n.vertexIndex++]=t[0],n.vertices[n.vertexIndex++]=t[1],n.vertices[n.vertexIndex++]=r.uv[0][0],n.vertices[n.vertexIndex++]=r.uv[0][1],n.vertices[n.vertexIndex++]=j,n.vertices[n.vertexIndex++]=s,n.vertices[n.vertexIndex++]=d,n.vertices[n.vertexIndex++]=c,n.vertices[n.vertexIndex++]=i,n.vertices[n.vertexIndex++]=t[0]+r.size[0],n.vertices[n.vertexIndex++]=t[1],n.vertices[n.vertexIndex++]=r.uv[1][0],n.vertices[n.vertexIndex++]=r.uv[1][1],n.vertices[n.vertexIndex++]=j,n.vertices[n.vertexIndex++]=s,n.vertices[n.vertexIndex++]=d,n.vertices[n.vertexIndex++]=c,n.vertices[n.vertexIndex++]=i,n.vertices[n.vertexIndex++]=t[0]+r.size[0],n.vertices[n.vertexIndex++]=t[1]+r.size[1],n.vertices[n.vertexIndex++]=r.uv[2][0],n.vertices[n.vertexIndex++]=r.uv[2][1],n.vertices[n.vertexIndex++]=j,n.vertices[n.vertexIndex++]=s,n.vertices[n.vertexIndex++]=d,n.vertices[n.vertexIndex++]=c,n.vertices[n.vertexIndex++]=i,n.vertices[n.vertexIndex++]=t[0],n.vertices[n.vertexIndex++]=t[1]+r.size[1],n.vertices[n.vertexIndex++]=r.uv[3][0],n.vertices[n.vertexIndex++]=r.uv[3][1],n.vertices[n.vertexIndex++]=j,n.vertices[n.vertexIndex++]=s,n.vertices[n.vertexIndex++]=d,n.vertices[n.vertexIndex++]=c,n.vertices[n.vertexIndex++]=i,n.indexCount+=6}else console.error("Could not get tile data for tile ".concat(r))},this.flush=function(){n.gl.bufferSubData(n.gl.ARRAY_BUFFER,0,n.vertices.subarray(0,n.vertexIndex)),n.vertexIndex=0},this.render=function(e){if(0!==n.indexCount){var t=0;n.textureManager.map.forEach((function(e){n.gl.activeTexture(n.gl.TEXTURE0+t),e.bind(n.gl),n.shaderProgram.setInt("".concat(Ee,"[").concat(t,"]"),t),++t})),n.gl.activeTexture(n.gl.TEXTURE0),n.gl.bindVertexArray(n.VAO),n.gl.drawElements(n.gl.TRIANGLES,n.indexCount,n.gl.UNSIGNED_SHORT,0),n.indexCount=0}},this.gl=t,this.shaderProgram=a,this.textures=[],this.textureManager=new ye,this.create()},Ne=a(19),Pe=[.25,.5,.75,1,1.25,1.5,1.75],_e=function e(t,a){var n=this;Object(Z.a)(this,e),this.setOrigin=function(e,t){n.origin=[n.position[0],n.position[1]],n.clientOrigin=[e,t]},this.moveTo=function(e,t){n.position=[n.origin[0]+(n.clientOrigin[0]-e),n.origin[1]+(n.clientOrigin[1]-t),n.cameraZ],n.calculateMvp()},this.setZoom=function(e){n.zoom=n.clampZoom(e),n.calculateMvp()},this.applyZoom=function(e){n.zoom+=e,Math.abs(n.zoom)<10||(n.zoom<0?n.zoomLevel=Math.max(0,n.zoomLevel-1):n.zoom>0&&(n.zoomLevel=Math.min(Pe.length-1,n.zoomLevel+1)),n.perceivedWidth=n.width/Pe[n.zoomLevel],n.perceivedHeight=n.height/Pe[n.zoomLevel],n.zoom=0,n.calculateMvp())},this.getMvp=function(){return n.mvp},this.getZoomLevel=function(){return Pe[n.zoomLevel]},this.calculateMvp=function(){var e=n.position[0]/Pe[n.zoomLevel],t=n.position[1]/Pe[n.zoomLevel];Ne.a.ortho(n.projection,e,n.perceivedWidth+e,n.perceivedHeight+t,t,n.near,n.far),Ne.a.multiply(n.mvp,n.projection,n.modelView)},this.width=t,this.height=a,this.zoomLevel=3,this.zoom=0,this.perceivedWidth=this.width,this.perceivedHeight=this.height,this.origin=[0,0],this.clientOrigin=[0,0],this.cameraZ=80,this.position=[0,0,this.cameraZ],this.near=.1,this.far=100,this.projection=Ne.a.create(),this.modelView=Ne.a.create(),this.mvp=Ne.a.create(),Ne.a.translate(this.modelView,this.modelView,[0,0,-this.cameraZ]),this.calculateMvp()},Ue=[32,32],De=new function e(){var t=this;Object(Z.a)(this,e),this.hasInitialized=!1,this.init=function(e){console.log("DEBUG: CONSTRUCTING RENDERER"),t.gl=e,t.gl&&(t.shaderProgram=new ke(t.gl,Le,Me),t.shaderProgram.use(),t.camera=new _e(t.gl.canvas.width,t.gl.canvas.height),t.shaderProgram.setMat4(we,t.camera.getMvp()),t.batch=new Se(t.gl,t.shaderProgram),t.hasInitialized=!0)},this.setClearColor=function(e,a,n,r){t.gl.clearColor(e,a,n,r)},this.render=function(){t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.renderGrid(),window.requestAnimationFrame(t.render)},this.renderGrid=function(){if(ie.hasInitialized){t.shaderProgram.use();var e=t.gl.canvas.width,a=t.gl.canvas.height,n=oe.getState().layers;t.shaderProgram.setMat4(we,t.camera.getMvp()),t.batch.begin();var r,s=Object(W.a)(n.names);try{for(s.s();!(r=s.n()).done;){var d=r.value,c=n.layers[d];if(c.visible&&c.id>=0)for(var i=0,j=0;j<a;i++,j+=Ue[1])for(var o=0,l=0;l<e;o++,l+=Ue[0]){var k=ie.get(o,i,c.id);-1!=k&&t.batch.emplace(k,[l,j])}}}catch(u){s.e(u)}finally{s.f()}t.batch.flush(),t.batch.render(t.shaderProgram)}}},ze=Object(r.forwardRef)((function(e,t){var a=e.id,r=e.style,s=e.onMouseDown,d=e.onMouseMove,c=e.onMouseUp,i=e.onWheel,j=e.onDragStart,o=e.onDrag;return Object(n.jsx)("canvas",{id:a,style:Object(J.a)(Object(J.a)({},r),{},{position:"absolute",top:"0",left:"0"}),onMouseDown:s,onMouseMove:d,onMouseUp:c,onWheel:i,onDragStart:j,onDrag:o,draggable:"true",ref:t})})),Be=[32,32],Fe=function(){var e=Object(i.c)(),t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current&&(t.current.width=t.current.clientWidth,t.current.height=t.current.clientHeight,ie.hasInitialized||ie.init().then((function(){e(m(null,0,0,Math.floor(t.current.width/Be[0])+1,Math.floor(t.current.height/Be[1])+1))})),De.hasInitialized||(De.init(t.current.getContext("webgl2")),De.setClearColor(31/255,41/255,55/255,1),window.requestAnimationFrame(De.render)))}),[e]),Object(n.jsx)(ze,{id:"tilemap-canvas",style:{width:"100%",height:"100%",zIndex:"0"},ref:t})},Ve=[32,32],Xe=function(){var e=Object(i.c)(),t=Object(r.useRef)(),a=Object(i.d)((function(e){return{selectedLayer:e.layers.selected,layers:e.layers.layers}})),s=a.selectedLayer,d=a.layers,c=Object(i.d)((function(e){return e.tileset.selectedTile})),j=Object(i.d)((function(e){return e.canvas.selectedTool}));Object(r.useEffect)((function(){var e=t.current;if(e){t.current.width=e.clientWidth,t.current.height=e.clientHeight;var a=function(e){return e.preventDefault()};return e.addEventListener("wheel",a,{passive:!1}),function(){e.removeEventListener("wheel",a)}}}),[]),Object(r.useEffect)((function(){var t=function(t){" "===t.key&&e(O(L))},a=function(t){" "===t.key&&e(O(I))};return window.addEventListener("keydown",t),window.addEventListener("keyup",a),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",a)}}),[e]);var o=function(e){var t=De.camera.getZoomLevel(),a=pe(e,[Ve[0]*t,Ve[1]*t],De.camera.position),n=d[s].id;switch(j){case I:break;case R:c&&-1!==c&&ie.set.apply(ie,Object(q.a)(a).concat([c,n]));break;case L:if(0==e.clientX||0==e.clientY)break;De.camera.moveTo(e.clientX,e.clientY)}};return Object(n.jsx)(ze,{id:"editor-canvas",style:{width:"100%",height:"100%",zIndex:"1"},onMouseDown:function(e){!function(e){switch(j){case A:var t=De.camera.getZoomLevel(),a=pe(e,[Ve[0]*t,Ve[1]*t],De.camera.position),n=d[s].id;ie.fill.apply(ie,Object(q.a)(a).concat([c,n]));break;case L:De.camera.setOrigin(e.clientX,e.clientY)}}(e),o(e)},onDrag:o,onWheel:function(e){e.altKey&&De.camera.applyZoom(e.deltaY)},ref:t})},Ye=function(){return Object(n.jsxs)("div",{className:"col-span-3 flex flex-col",children:[Object(n.jsx)(G,{}),Object(n.jsxs)("section",{className:"relative flex-1 bg-gray-600",children:[Object(n.jsx)(Xe,{}),Object(n.jsx)(Fe,{})]})]})},Ge=a(24),We=function(e){var t=e.iconPath,a=e.routerPath;return Object(n.jsx)(Ge.b,{to:a,activeClassName:"text-indigo-200 bg-indigo-900",children:Object(n.jsx)("button",{className:"px-2 py-3 hover:text-indigo-400 hover:bg-indigo-900","data-tip":!0,"data-for":a,children:Object(n.jsx)(E.a,{path:t,size:1.2})})})},Ze=function(){var e=[{path:M,icon:Y.p},{path:S,icon:Y.i},{path:N,icon:Y.o},{path:P,icon:Y.b},{path:_,icon:Y.a},{path:U,icon:Y.h}].map((function(e){return Object(n.jsxs)("div",{className:"flex","data-testid":e.path,children:[Object(n.jsx)(We,{routerPath:e.path,iconPath:e.icon}),Object(n.jsx)(T.a,{id:e.path,place:"right",effect:"solid",delayShow:600,children:z.get(e.path)})]},e.path)}));return Object(n.jsx)("div",{className:"flex flex-col justify-end bg-black border-r ".concat(V),children:e})},He=function(e){var t=e.children,a=e.title;return Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{className:"".concat(X," bg-black border-b ").concat(V," px-2 flex items-center"),children:a}),t]})},qe=function(e){return e.layers},Je=function(e){return function(e){return qe(e)?qe(e).names:[]}(e).map((function(t){return function(e,t){return qe(e)?Object(J.a)(Object(J.a)({},qe(e).layers[t]),{},{name:t}):{}}(e,t)}))},Ke=function(e){return Je(e).reverse()},Qe=a(17),$e=a(40),et=(a(63),function(e){var t=e.title,a=e.children,s=Object(r.useState)(!0),d=Object(Qe.a)(s,2),c=d[0],i=d[1],j=c?Y.j:Y.k,o=c?"border-b ".concat(V):"";return Object(n.jsxs)("div",{className:o,children:[Object(n.jsxs)("div",{className:"flex items-center hover:bg-gray-800 cursor-pointer border-b ".concat(V," ").concat(X),onDoubleClick:function(e){return i(!c)},children:[Object(n.jsx)(E.a,{path:j,size:1}),Object(n.jsx)("h1",{className:"select-none",children:t})]}),Object(n.jsx)($e.Collapse,{isOpened:c,children:Object(n.jsx)("div",{className:"text-xs text-gray-400 px-2 py-4",children:a})})]})}),tt=a(28),at=function(e){var t=e.layer,a=e.index,r=e.isSelected,s=Object(i.c)(),d=function(){s(y(t.name))},c=function(){var e;s((e=t.name,{type:b,payload:{name:e}}))},j=t.visible?Y.f:Y.g,o=r?"bg-gray-700":"hover:bg-gray-800",l=t.visible?"layer-visible":"layer-hidden";return Object(n.jsx)(tt.b,{draggableId:t.name,index:a,children:function(e,a){var r=Object(J.a)({cursor:"default"},e.draggableProps.style);return Object(n.jsxs)("li",Object(J.a)(Object(J.a)(Object(J.a)({className:"flex items-center select-none ".concat(o),ref:e.innerRef},e.draggableProps),e.dragHandleProps),{},{style:r,"data-testid":l,children:[Object(n.jsx)("span",{className:"flex-1 pl-4 py-1",onClick:d,children:t.name}),Object(n.jsx)("span",{onClick:c,className:"cursor-pointer pr-4 py-1","data-testid":"hide-layer-button",children:Object(n.jsx)(E.a,{path:j,size:.6})})]}))}})},nt=function(e){var t=e.selectedLayer,a=Object(i.c)();return Object(n.jsxs)("div",{className:"flex items-center justify-start py-3",children:[Object(n.jsx)("button",{onClick:function(){a(m())},"data-testid":"add-layer-button",children:Object(n.jsx)(E.a,{path:Y.n,size:.7})}),Object(n.jsx)("button",{onClick:function(){a({type:v,payload:{name:t}})},"data-testid":"delete-layer-button",children:Object(n.jsx)(E.a,{path:Y.e,size:.65})})]})},rt=function(){var e=Object(i.c)(),t=Object(i.d)((function(e){return{selectedLayer:e.layers.selected,layers:Ke(e)}})),a=t.selectedLayer,r=t.layers,s=r.map((function(e,t){return Object(n.jsx)(at,{index:t,layer:e,isSelected:e.name===a},e.name)})),d=r&&r.length?Object(n.jsx)(tt.a,{onDragEnd:function(t){var a,n;e((a=t.draggableId,n=r.length-t.destination.index-1,{type:x,payload:{name:a,to:n}}))},onBeforeDragStart:function(t){e(y(t.draggableId))},children:Object(n.jsx)(tt.c,{droppableId:"layers",children:function(e){return Object(n.jsxs)("ul",Object(J.a)(Object(J.a)({},e.droppableProps),{},{ref:e.innerRef,children:[s,e.placeholder]}))}})}):Object(n.jsx)("div",{});return Object(n.jsxs)(et,{title:"Layers",children:[d,Object(n.jsx)(nt,{selectedLayer:a})]})},st=[32,32],dt=function(){var e=Object(i.c)(),t=Object(i.d)((function(e){return e.tileset.selectedTileset})),a=Object(r.useState)([-1,-1]),s=Object(Qe.a)(a,2),d=s[0],c=s[1],j=Object(r.useState)(0),o=Object(Qe.a)(j,2),l=o[0],u=o[1],h=Object(r.useRef)(null),v=Object(r.useRef)(null);Object(r.useEffect)((function(){if(t&&h.current&&v.current){var e=v.current,a=h.current;xe(t).then((function(t){var n=new FileReader;n.onload=function(n){var r=new Image;r.onload=function(){e.width=r.width,e.height=r.height,a.width=r.width,a.height=r.height,e.getContext("2d").drawImage(r,0,0),function(e,t){var a=e.getContext("2d");a.strokeStyle="#dddddd",a.lineWidth=1;for(var n=t[0];n<e.height;n+=t[0])a.beginPath(),a.moveTo(0,n+.5),a.lineTo(e.width,n+.5),a.stroke();for(var r=t[1];r<e.width;r+=t[1])a.beginPath(),a.moveTo(r+.5,0),a.lineTo(r+.5,e.height),a.stroke()}(e,st),u(t.tilesetIndex)},r.src=n.target.result},n.readAsDataURL(t.file)}))}}),[t]),Object(r.useEffect)((function(){if(h.current){var e=h.current,t=e.getContext("2d");t.fillStyle="rgba(79, 70, 229, 0.4)",t.clearRect(0,0,e.width,e.height),t.fillRect(d[0]*st[0]+1,d[1]*st[1]+1,st[0]-1,st[1]-1)}}),[d]);return""===t?Object(n.jsx)("div",{}):Object(n.jsx)("div",{className:"max-h-40 overflow-scroll border",children:Object(n.jsxs)("div",{className:"grid",children:[Object(n.jsx)("canvas",{id:"grid-canvas",onMouseUp:function(t){var a=pe(t,st),n=l+a[1]*Math.floor(t.target.width/st[0])+a[0];e({type:k,payload:{value:n}}),c(a)},ref:h,className:"col-span-full row-span-full z-10"}),Object(n.jsx)("canvas",{id:"tileset-canvas",ref:v,className:"col-span-full row-span-full z-0"})]})})},ct=function(){var e=Object(i.c)(),t=Object(i.d)((function(e){return e.tileset})),a=t.selectedTileset,s=t.tilesetNames;Object(r.useEffect)((function(){var t=localStorage.getItem(B);t&&e(p(t))}),[e]);var d,c=[],j=Object(W.a)(s);try{for(j.s();!(d=j.n()).done;){var o=d.value;c.push(Object(n.jsx)("option",{value:o,"data-testid":o,children:o},o))}}catch(l){j.e(l)}finally{j.f()}return s.length>0&&Object(n.jsx)("select",{className:"text-gray-900",value:a,onChange:function(t){var a=t.target.value;localStorage.setItem(B,a),e(p(a))},"data-testid":"select-tileset",children:c})},it=function(e){var t=e.title,a=e.onUpload;return Object(n.jsxs)("div",{children:[Object(n.jsx)("p",{children:t}),Object(n.jsx)("input",{type:"file",min:"1",max:"100",value:"",onChange:a})]})},jt=function(){var e=Object(i.c)();Object(r.useEffect)((function(){fe().then(function(){var t=Object(de.a)(se.a.mark((function t(a){var n,r,s;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:o,payload:{names:a}}),n=Object(W.a)(a.reverse()),t.prev=2,n.s();case 4:if((r=n.n()).done){t.next=10;break}return s=r.value,t.next=8,Te.addTilesFromTileset(s,[32,32]);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[2,12,15,18]])})));return function(e){return t.apply(this,arguments)}}())}),[e]);var t=function(){var t=Object(de.a)(se.a.mark((function t(a){var n,r;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a.target.files.length<=0)){t.next=2;break}return t.abrupt("return");case 2:if(n=a.target.files[0].name,t.prev=3,r=a.target.files[0]){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,be(n,{file:r,tilesetIndex:Te.length});case 9:t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(3),console.error(t.t0),t.abrupt("return");case 15:Te.addTilesFromTileset(n,[32,32]),localStorage.setItem(B,n),e(g(n));case 18:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(n.jsxs)(et,{title:"Tileset",children:[Object(n.jsx)(ct,{}),Object(n.jsx)(it,{title:"Add Tileset",onUpload:function(e){return t(e)}}),Object(n.jsx)(dt,{})]})},ot=function(){return Object(n.jsxs)(He,{title:"Edit",children:[Object(n.jsx)(rt,{}),Object(n.jsx)(jt,{})]})};function lt(e){return Object(n.jsxs)("div",{children:[Object(n.jsx)("p",{children:Object(n.jsx)("strong",{children:e.title})}),Object(n.jsxs)("span",{children:[e.value,"px"]}),Object(n.jsx)("input",{type:"range",min:"1",max:"100",value:e.value,onChange:e.onChange})]})}var kt=function(e){var t=Object(r.useState)(32),a=Object(Qe.a)(t,2),s=a[0],d=a[1];return Object(n.jsx)(He,{title:"Map Settings",children:Object(n.jsx)(lt,{title:"Tile size",onChange:function(e){return d(e.target.value)},value:s})})},ut=function(){return Object(n.jsx)(He,{title:"Import",children:Object(n.jsx)("h3",{children:"Import"})})},ht=function(e){var t=e.format,a=e.onOptionSelected,r=["json","tmx"].map((function(e){return Object(n.jsx)("option",{value:e,children:e},e)}));return Object(n.jsx)("select",{className:"text-gray-900",value:t,onChange:a,children:r})},vt=function(){var e=Object(r.useState)("tmx"),t=Object(Qe.a)(e,2),a=t[0],s=t[1],d=function(){var e=Object(de.a)(se.a.mark((function e(){var t,n,r,s;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ie.dump(a),n="tilemap."+a,r=new Blob([t],{type:"application/xml"}),(s=document.createElement("a")).href=URL.createObjectURL(r),s.download=n,s.click();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.jsxs)(He,{title:"Export Map",children:[Object(n.jsx)(ht,{format:a,onOptionSelected:function(e){s(e.target.value)}}),Object(n.jsx)("button",{className:"bg-indigo-900 my-3 py-2 px-4 flex justify-center rounded cursor-pointer",onClick:d,children:"Export"})]})},ft=function(){return Object(n.jsxs)(He,{title:"Project Settings",children:[Object(n.jsx)("label",{htmlFor:"show-grid",children:"Show grid"}),Object(n.jsx)("input",{type:"checkbox",name:"show-grid"})]})},xt=function(){return Object(n.jsx)(He,{title:"Help",children:Object(n.jsx)("div",{style:{height:"200px"},children:Object(n.jsx)("div",{style:{overflow:"scroll",height:"100%"},children:"ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd ajshdasjdasdajsd kjasdkj askjd kjas jdaks jdaks jdkksa dj kjadjk asjk djkjkd akskj dakj dksad kajsdk jaskjd"})})})},bt=a(7),gt=function(){return Object(n.jsxs)("aside",{className:"flex flex-row bg-gray-900 border-r ".concat(V),children:[Object(n.jsx)(Ze,{}),Object(n.jsx)("div",{className:"flex-1",children:Object(n.jsxs)(bt.c,{children:[Object(n.jsx)(bt.a,{path:"/".concat(M),children:Object(n.jsx)(ot,{})}),Object(n.jsx)(bt.a,{path:"/".concat(S),children:Object(n.jsx)(kt,{})}),Object(n.jsx)(bt.a,{path:"/".concat(N),children:Object(n.jsx)(ut,{})}),Object(n.jsx)(bt.a,{path:"/".concat(P),children:Object(n.jsx)(vt,{})}),Object(n.jsx)(bt.a,{path:"/".concat(_),children:Object(n.jsx)(ft,{})}),Object(n.jsx)(bt.a,{path:"/".concat(U),children:Object(n.jsx)(xt,{})})]})})]})},pt=function(){return Object(n.jsx)("div",{className:"h-screen w-screen flex flex-col text-gray-50 bg-gray-900 border ".concat(V," text-gray-100"),children:Object(n.jsxs)("main",{className:"flex-1 grid grid-cols-4",children:[Object(n.jsx)(Ge.a,{children:Object(n.jsx)(gt,{})}),Object(n.jsx)(Ye,{})]})})};a(64);c.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(i.a,{store:oe,children:Object(n.jsx)(pt,{})})}),document.getElementById("root"))}},[[65,2,3]]]);
//# sourceMappingURL=main.ce77b46e.chunk.js.map