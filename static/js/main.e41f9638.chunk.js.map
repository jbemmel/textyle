{"version":3,"sources":["redux/actionTypes.js","redux/actions.js","ui/canvas/tools.js","ui/sidebar/tabs.js","ui/tooltips.js","ui/constants.js","ui/canvas/Tool.js","resources/testIds.js","ui/common/styles.js","ui/canvas/Toolbar.js","redux/reducers/tileset.js","redux/reducers/canvas.js","redux/reducers/layers.js","redux/reducers/index.js","tilemap/index.js","utils/file.js","utils/tile.js","renderer/TileManager.js","idbTextureStore.js","redux/store.js","renderer/Shader.js","renderer/Texture.js","renderer/TextureManager.js","renderer/constants.js","renderer/Batch2D.js","renderer/Camera.js","renderer/Renderer.js","ui/canvas/WebGLCanvas.js","ui/canvas/EditorCanvas.js","ui/canvas/Canvas.js","ui/sidebar/TabButton.js","ui/sidebar/TabSelector.js","ui/common/Tab.js","redux/selectors.js","ui/common/CollapseTab.js","ui/sidebar/tileset/LayerListItem.js","ui/sidebar/tileset/LayerListFooter.js","ui/sidebar/tileset/LayerList.js","ui/sidebar/tileset/TilesetFooter.js","ui/sidebar/tileset/TilesetPreview.js","ui/common/Select.js","ui/sidebar/tileset/TilesetSelector.js","ui/common/Button.js","ui/common/FileInput.js","ui/sidebar/tileset/TilesetSettings.js","ui/sidebar/tileset/Edit.js","ui/common/SliderInput.js","ui/sidebar/map/MapSettings.js","ui/sidebar/import/ImportSettings.js","ui/sidebar/export/FormatSelector.js","ui/sidebar/export/formats.js","ui/sidebar/export/ExportSettings.js","ui/sidebar/project/ProjectSettings.js","ui/sidebar/Help.js","ui/sidebar/Sidebar.js","ui/App.js","index.js"],"names":["ADD_TILESET","LOAD_EXISTING_TILESETS","SELECT_TILESET","DELETE_TILESET","SELECT_TILE","SELECT_TOOL","ADD_LAYER","DELETE_LAYER","SELECT_LAYER","MOVE_LAYER","TOGGLE_LAYER_VISIBILITY","selectTileset","name","type","payload","selectTool","tool","addLayer","x","y","width","height","selectLayer","DEFAULT_TOOL","PLACEMENT_TOOL","FILL_TOOL","MOVE_TOOL","PAN_TOOL","TAB_TILES","TAB_MAP","TAB_IMPORT","TAB_EXPORT","TAB_SETTINGS","TAB_HELP","tooltips","Map","set","tools","tabs","LOCAL_STORAGE_LAST_SELECTED_TILESET","Tool","iconPath","dispatch","useDispatch","selectedTool","useSelector","state","canvas","iconClasses","className","role","data-testid","onClick","data-tip","data-for","path","size","id","place","effect","delayShow","get","dividerBorderColor","titleBarHeight","Toolbar","mdiCursorDefaultOutline","mdiPencil","mdiPail","mdiCursorMove","initialState","tilesetNames","selectedTileset","selectedTile","selected","names","layers","lastIdx","combineReducers","tileset","action","newTilesetNames","filter","n","newSelected","length","idx","Math","max","indexOf","value","visible","newLayers","newIds","to","from","reorderedNames","splice","TilemapInstance","init","a","wasm","memory","map","Tilemap","new","hasInitialized","console","error","message","add_layer","layerId","fill","targetValue","dump","format","log","this","getImageBitmap","getTextureData","fileData","file","createImageBitmap","getTilePositionOnClick","e","tileSize","offset","bounds","target","getBoundingClientRect","floor","clientX","left","clientY","top","getTileUV","frame","frameSize","textureSize","frameWidth","frameHeight","hFrames","vFrames","maxFrames","frameX","frameY","topLeftX","topLeftY","TileManagerInstance","addTilesFromTileset","texture","bitmap","i","j","uv","tiles","tile","textureStore","Store","getTextureNames","keys","textureNames","data","setTextureData","tilesetIndex","localStorage","setItem","deleteTextureData","del","getItem","removeItem","loadTilesFromExistingTilesets","tilesets","composeEnhancer","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","rootReducer","applyMiddleware","next","createShader","gl","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","info","getShaderInfoLog","ShaderProgram","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","use","useProgram","setMat4","uniformName","uniformMatrix4fv","getUniformLocation","setInt","uniform1i","Texture","create","createTexture","bindTexture","TEXTURE_2D","pixel","Uint8Array","texImage2D","RGBA","UNSIGNED_BYTE","then","texParameteri","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","bind","getUV","TextureManager","add","indexMap","has","delete","UNIFORM_MVP","UNIFORM_SAMPLERS","ATTRIB_POSITION","ATTRIB_TEXTURE_COORD","ATTRIB_TEXTURE_IDX","ATTRIB_COLOR","BATCH_VERTEX_SHADER_SOURCE","BATCH_FRAGMENT_SHADER_SOURCE","Batch2D","shaderProgram","vertices","Float32Array","maxSprites","indices","indicesSize","Uint16Array","createIndices","VAO","createVertexArray","VBO","createBuffer","EBO","bindVertexArray","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","locPosition","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","locTextureCoord","locTextureIdx","locColor","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","vertexIndex","indexCount","begin","emplace","tileValue","position","color","tileData","r","g","b","textureIdx","textureManager","getIndex","flush","bufferSubData","subarray","render","forEach","activeTexture","TEXTURE0","drawElements","TRIANGLES","UNSIGNED_SHORT","textures","zoomLevels","Camera","setOrigin","origin","clientOrigin","moveTo","cameraZ","calculateMvp","setZoom","zoom","clampZoom","applyZoom","abs","zoomLevel","min","perceivedWidth","perceivedHeight","getMvp","mvp","getZoomLevel","computedPositionX","computedPositionY","mat4","ortho","projection","near","far","multiply","modelView","translate","RendererInstance","camera","batch","setClearColor","clearColor","clear","COLOR_BUFFER_BIT","renderGrid","requestAnimationFrame","canvasWidth","canvasHeight","layersState","getState","layerName","layer","WebGLCanvas","tilesCanvasRef","useRef","useEffect","current","clientWidth","clientHeight","getContext","ref","EditorCanvas","editingCanvasRef","selectedLayer","refElement","cancelWheel","event","preventDefault","addEventListener","passive","removeEventListener","panToolStartHandler","key","panToolEndHandler","handleContinuousTools","undefined","onWheel","altKey","deltaY","onMouseDown","handleOneTimeTools","onDrag","draggable","Canvas","TabButton","routerPath","activeClassName","TabSelector","sections","icon","mdiViewModule","mdiMap","mdiUpload","mdiContentSave","mdiCog","mdiHelpCircleOutline","section","Tab","children","title","getLayersState","getLayers","getLayersNames","getLayerByName","getLayersByAddedTime","reverse","CollapseSection","useState","open","setOpen","mdiMenuDown","mdiMenuRight","sectionClass","onDoubleClick","isOpened","LayerItem","index","isSelected","handleLayerClick","handleEyeClick","mdiEye","mdiEyeOffOutline","selectedClassName","visibilityTestId","draggableId","provided","snapshop","style","cursor","draggableProps","innerRef","dragHandleProps","LayerListFooter","mdiPlaylistPlus","mdiDelete","LayerList","layerComponents","l","LayerListItem","dndArea","onDragEnd","destination","onBeforeDragStart","droppableId","droppableProps","placeholder","TilesetFooter","TilesetPreview","setSelectedTile","setTilesetIndex","tilegridCanvasRef","tilesetCanvasRef","tilesetCanvas","tilegridCanvas","reader","FileReader","onload","image","Image","drawImage","tileDimensions","context","strokeStyle","lineWidth","beginPath","lineTo","stroke","drawGridLines","src","result","readAsDataURL","fillStyle","clearRect","fillRect","onMouseUp","tilePos","tileIndex","Select","options","onChange","TilesetSelector","lastSelectedTileset","push","Button","text","FileInput","onUpload","opacity","overflow","zIndex","htmlFor","TilesetManager","onTilesetUpload","files","Edit","TilesetSettings","SliderInput","props","MapSettings","setTileSize","ImportSettings","FormatSelector","onOptionSelected","formatOptions","ExportSettings","setFormat","handleExport","rawData","filename","blob","Blob","document","createElement","href","URL","createObjectURL","download","click","ProjectSettings","Help","Sidebar","App","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e41f9638.chunk.js","sourcesContent":["export const ADD_TILESET = '[TILESET] Add one';\nexport const LOAD_EXISTING_TILESETS = '[TILESET] Load existing';\nexport const SELECT_TILESET = '[TILESET] Select';\nexport const DELETE_TILESET = '[TILESET] Delete';\nexport const SELECT_TILE = '[TILE] Select';\n\nexport const SELECT_TOOL = '[TOOL] Select';\n\nexport const ADD_LAYER = '[LAYER] Add one';\nexport const DELETE_LAYER = '[LAYER] Delete';\nexport const SELECT_LAYER = '[LAYER] Select';\nexport const MOVE_LAYER = '[LAYER] Move';\nexport const TOGGLE_LAYER_VISIBILITY = '[LAYER] Toggle Visibility';\n\n","import {\n  ADD_TILESET,\n  LOAD_EXISTING_TILESETS,\n  SELECT_TILESET,\n  DELETE_TILESET,\n  SELECT_TILE,\n  SELECT_TOOL,\n  ADD_LAYER,\n  DELETE_LAYER,\n  SELECT_LAYER,\n  MOVE_LAYER,\n  TOGGLE_LAYER_VISIBILITY,\n} from 'redux/actionTypes';\n\nexport const addTileset = (name, data) => ({\n  type: ADD_TILESET,\n  payload: { name, data },\n});\n\nexport const loadExistingTilesets = names => ({\n  type: LOAD_EXISTING_TILESETS,\n  payload: { names },\n});\n\nexport const selectTileset = name => ({\n  type: SELECT_TILESET,\n  payload: { name },\n});\n\nexport const deleteTileset = name => ({\n  type: DELETE_TILESET,\n  payload: { name },\n});\n\nexport const selectTile = value => ({\n  type: SELECT_TILE,\n  payload: { value },\n});\n\nexport const selectTool = tool => ({\n  type: SELECT_TOOL,\n  payload: { tool },\n});\n\nexport const addLayer = (name, x, y, width, height) => ({\n  type: ADD_LAYER,\n  payload: { name, x, y, width, height },\n});\n\nexport const deleteLayer = name => ({\n  type: DELETE_LAYER,\n  payload: { name },\n});\n\nexport const selectLayer = name => ({\n  type: SELECT_LAYER,\n  payload: { name },\n});\n\nexport const moveLayer = (name, to) => ({\n  type: MOVE_LAYER,\n  payload: { name, to },\n});\n\nexport const toggleLayerVisibility = name => ({\n  type: TOGGLE_LAYER_VISIBILITY,\n  payload: { name },\n});\n","export const DEFAULT_TOOL = 'DEFAULT_TOOL';\nexport const PLACEMENT_TOOL = 'PLACEMENT_TOOL';\nexport const FILL_TOOL = 'FILL_TOOL';\nexport const MOVE_TOOL = 'MOVE_TOOL';\nexport const PAN_TOOL = 'PAN_TOOL';\n\n","export const TAB_TILES = 'tiles';\nexport const TAB_MAP = 'map';\nexport const TAB_IMPORT = 'import';\nexport const TAB_EXPORT = 'save';\nexport const TAB_SETTINGS = 'settings';\nexport const TAB_HELP = 'help';\n","import * as tools from 'ui/canvas/tools';\nimport * as tabs from 'ui/sidebar/tabs';\n\nconst tooltips = new Map();\n\ntooltips.set(tools.DEFAULT_TOOL, 'default tool');\ntooltips.set(tools.PLACEMENT_TOOL, 'placement tool');\ntooltips.set(tools.FILL_TOOL, 'fill tool');\ntooltips.set(tools.MOVE_TOOL, 'move tool');\n\ntooltips.set(tabs.TAB_TILES, 'tab tiles');\ntooltips.set(tabs.TAB_MAP, 'tab map');\ntooltips.set(tabs.TAB_IMPORT, 'tab import');\ntooltips.set(tabs.TAB_EXPORT, 'tab export');\ntooltips.set(tabs.TAB_SETTINGS, 'settings tab');\ntooltips.set(tabs.TAB_HELP, 'help tab');\n\nexport default tooltips;\n","export const TILEMAP_CANVAS_ID = 'tilemap-canvas';\nexport const EDITOR_CANVAS_ID = 'editor-canvas';\nexport const GRID_CANVAS_ID = 'grid-canvas';\nexport const TILESET_CANVAS_ID = 'tileset-canvas';\nexport const LOCAL_STORAGE_LAST_SELECTED_TILESET = 'lastSelectedTileset';\n\nexport const ADD_TILESET_TITLE = 'Add Tileset';\n\nexport const GRID_COLOR = '#dddddd';\nexport const SELECTED_TILE_COLOR_OVERLAY = 'rgba(79, 70, 229, 0.4)';\n\nexport const TOOLTIP_DELAY = 600;\nexport const TOOLBAR_ICON_SIZE = 0.68;\n","import { connect, useDispatch, useSelector } from 'react-redux';\nimport { selectTool } from 'redux/actions';\nimport ReactTooltip from 'react-tooltip';\nimport Icon from '@mdi/react';\nimport tooltips from 'ui/tooltips';\nimport * as testIds from 'resources/testIds';\nimport {\n  TOOLTIP_DELAY,\n  TOOLBAR_ICON_SIZE,\n} from 'ui/constants';\n\nconst Tool = ({ iconPath, tool }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const selectedTool = useSelector(state => state.canvas.selectedTool);\n\n\n  // ====================================\n  // Logic\n  // ====================================\n  const handleOnClick = () => {\n    dispatch(selectTool(tool));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  const iconClasses = tool === selectedTool\n    ? 'text-indigo-400 hover:text-indigo-500'\n    : 'hover:text-indigo-500 cursor-pointer';\n  return (\n    <button className='px-4 py-2 cursor-default' role='button' data-testid={tool === selectedTool ? testIds.SELECTED_TOOL : ''}>\n      <div className={iconClasses} onClick={handleOnClick} data-tip data-for={tool} data-testid={tool}>\n        <Icon path={iconPath} size={TOOLBAR_ICON_SIZE} />\n      </div>\n      <ReactTooltip id={tool} place='bottom' effect='solid' delayShow={TOOLTIP_DELAY}>\n        {tooltips.get(tool)}\n      </ReactTooltip>\n    </button>\n  );\n}\n\nexport default Tool;\n\n","export const SELECTED_TOOL = 'selected-tool';\nexport const SELECT_TAG = 'select-tag';\nexport const ADD_LAYER_BUTTON = 'add-layer-button';\nexport const DELETE_LAYER_BUTTON = 'delete-layer-button';\nexport const HIDE_LAYER_BUTTON = 'hide-layer-button';\nexport const LAYER_VISIBLE = 'layer-visible';\nexport const LAYER_HIDDEN = 'layer-hidden';\n","export const dividerBorderColor = 'border-gray-600';\nexport const titleBarHeight = 'h-7';\nexport const toolbarHeight = titleBarHeight;\n","import React from 'react';\nimport Tool from 'ui/canvas/Tool';\nimport { dividerBorderColor, toolbarHeight } from 'ui/common/styles';\nimport {\n  mdiPencil,\n  mdiPail,\n  mdiSelect,\n  mdiCursorDefaultOutline,\n  mdiCursorMove,\n} from '@mdi/js';\n\nimport * as tools from 'ui/canvas/tools';\n\nconst Toolbar = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <nav className={`flex flex-row items-stretch bg-black border-b border-r ${dividerBorderColor} ${toolbarHeight}`}>\n      <div className='flex flex-row justify-start items-center flex-grow'>\n        <Tool iconPath={mdiCursorDefaultOutline} tool={tools.DEFAULT_TOOL} />\n        <Tool iconPath={mdiPencil} tool={tools.PLACEMENT_TOOL} />\n        <Tool iconPath={mdiPail} tool={tools.FILL_TOOL} />\n        <Tool iconPath={mdiCursorMove} tool={tools.MOVE_TOOL} />\n      </div>\n    </nav>\n  );\n}\n\nexport default Toolbar;\n","import {\n  ADD_TILESET,\n  LOAD_EXISTING_TILESETS,\n  SELECT_TILESET,\n  DELETE_TILESET,\n  SELECT_TILE,\n} from 'redux/actionTypes'\n\nconst initialState = {\n  tilesetNames: [],\n  selectedTileset: '',\n  selectedTile: -1,\n}\n\nexport default function(state = initialState, action) {\n  switch(action.type) {\n    case LOAD_EXISTING_TILESETS: {\n      const { names } = action.payload;\n\n      return {\n        ...state,\n        tilesetNames: names,\n      };\n    }\n\n    case ADD_TILESET: {\n      const { name } = action.payload;\n      return {\n        ...state,\n        tilesetNames: [...state.tilesetNames, name],\n        selectedTileset: name,\n      };\n    }\n\n    case SELECT_TILESET: {\n      const { name } = action.payload;\n      return {\n        ...state,\n        selectedTileset: name,\n      };\n    }\n\n    case DELETE_TILESET: {\n      const { name } = action.payload;\n      const newTilesetNames = state.tilesetNames.filter(n => n !== name);\n\n      let newSelected = state.selectedTileset;\n\n      // If the selected layer is the layer we are deleting and\n      // it is not the last layer, select a new index.\n      if (newSelected === name && newTilesetNames.length > 0) {\n        const idx = Math.max(state.tilesetNames.indexOf(name) - 1, 0);\n        newSelected = newTilesetNames[idx];\n      }\n      else if (newTilesetNames.length == 0) {\n        newSelected = '';\n      }\n\n      return {\n        ...state,\n        selectedTileset: newSelected,\n        tilesetNames: newTilesetNames,\n      };\n    }\n\n    case SELECT_TILE: {\n      const { value } = action.payload;\n      return {\n        ...state,\n        selectedTile: value,\n      };\n    }\n\n    default:\n      return state;\n  }\n}\n","import {\n  SELECT_TOOL,\n} from 'redux/actionTypes';\n\nimport {\n  DEFAULT_TOOL\n} from 'ui/canvas/tools';\n\nconst initialState = {\n  selectedTool: DEFAULT_TOOL,\n}\n\nexport default function(state = initialState, action) {\n  switch(action.type) {\n    case SELECT_TOOL: {\n      const { tool } = action.payload;\n      return {\n        ...state,\n        selectedTool: tool,\n      };\n    }\n\n    default:\n      return state;\n  }\n}\n","import {\n  ADD_LAYER,\n  DELETE_LAYER,\n  SELECT_LAYER,\n  MOVE_LAYER,\n  TOGGLE_LAYER_VISIBILITY,\n} from 'redux/actionTypes';\n\nconst initialState = {\n  selected: '',\n  names: [],\n  layers: {},\n  lastIdx: 0,\n}\n\nexport default function(state = initialState, action) {\n  switch(action.type) {\n    case ADD_LAYER: {\n      let { name } = action.payload;\n\n      // If name is not provided, add a default one\n      if (!name) {\n        name = `Layer ${state.lastIdx + 1}`;\n      }\n\n      return {\n        ...state,\n        names: [...state.names, name],\n        layers: {\n          ...state.layers,\n          [name]: {\n            id: state.lastIdx,\n            visible: true,\n          }\n        },\n        selected: name,\n        lastIdx: state.lastIdx + 1,\n      };\n    }\n\n    case DELETE_LAYER: {\n      const { name } = action.payload;\n      const { [name]: value, ...newLayers } = state.layers;\n      const newIds = state.names.filter(id => id !== name);\n\n      let newSelected = state.selected;\n\n      // If the selected layer is the layer we are deleting and\n      // it is not the last layer, select a new index.\n      if (newSelected === name && newIds.length > 0) {\n        const idx = Math.max(state.names.indexOf(name) - 1, 0);\n        newSelected = newIds[idx];\n      }\n      else if (newIds.length === 0) {\n        newSelected = '';\n      }\n\n      return {\n        ...state,\n        names: newIds,\n        layers: newLayers,\n        selected: newSelected,\n      };\n    }\n\n    case SELECT_LAYER: {\n      const { name } = action.payload;\n      return {\n        ...state,\n        selected: name,\n      };\n    }\n\n    case MOVE_LAYER: {\n      const { name, to } = action.payload;\n      const from = state.names.indexOf(name);\n      const reorderedNames = state.names;\n\n      // If the layer exists\n      if (from !== -1) {\n        reorderedNames.splice(from, 1);\n        reorderedNames.splice(to, 0, name);\n      }\n\n      return {\n        ...state,\n        names: reorderedNames,\n      };\n    }\n\n    case TOGGLE_LAYER_VISIBILITY: {\n      const { name } = action.payload;\n      return {\n        ...state,\n        layers: {\n          ...state.layers,\n          [name]: {\n            ...state.layers[name],\n            visible: !state.layers[name].visible,\n          }\n        }\n      }\n    }\n\n    default:\n      return state;\n  }\n}\n","import { combineReducers } from 'redux';\nimport tileset from 'redux/reducers/tileset';\nimport canvas from 'redux/reducers/canvas';\nimport layers from 'redux/reducers/layers';\n\nexport default combineReducers({ tileset, canvas, layers });\n","import {\n  ADD_LAYER,\n  DELETE_LAYER,\n} from 'redux/actionTypes';\n\nclass Tilemap {\n  constructor() {\n    console.log('DEBUG: CONSTRUCTING GRID');\n    this.hasInitialized = false;\n  }\n\n  init = async (width, height) => {\n    try {\n      this.wasm = await import('./pkg');\n      const { memory } = await import('./pkg/tilemap_bg');\n      this.map = this.wasm.Tilemap.new();\n      this.memory = memory;\n      this.hasInitialized = true;\n    } catch (err) {\n      console.error(`[x] Error loading grid: ${err.message}`);\n    }\n  }\n\n  width = () => {\n    return this.map.width();\n  }\n\n  height = () => {\n    return this.map.height();\n  }\n\n  addLayer = (x, y, width, height) => {\n    // Set default position to (0,0)\n    if (!x || !y) {\n      x = 0;\n      y = 0;\n    }\n\n    // Set default size to the map size\n    if (!width || !height) {\n      width = TilemapInstance.width();\n      height = TilemapInstance.height();\n    }\n\n    this.map.add_layer(x, y, width, height);\n  }\n\n  get = (x, y, layerId) => {\n    return this.map.get(x, y, layerId);\n  }\n\n  set = (x, y, value, layerId) => {\n    this.map.set(x, y, value, layerId);\n  }\n\n  fill = (x, y, targetValue, layerId) => {\n    this.map.fill(x, y, targetValue, layerId);\n  }\n\n  dump = (format) => {\n    // TODO: Implement dump for whole map\n    //return this.grid.dump(format);\n  }\n}\n\nconst tilemapReduxMiddleware = store => next => action => {\n  switch(action.type) {\n    case ADD_LAYER: {\n      let { x, y, width, height } = action.payload || {};\n      TilemapInstance.addLayer(x, y, width, height);\n      break;\n    }\n\n    case DELETE_LAYER: {\n      // TODO: Implement layer deletion\n      break;\n    }\n\n    default:\n      break;\n  }\n\n  return next(action);\n}\n\nconst TilemapInstance = new Tilemap();\n\nexport { tilemapReduxMiddleware };\nexport default TilemapInstance;\n","import { getTextureData } from 'idbTextureStore';\n\nexport const fileToBase64 = file => {\n  if (!file) {\n    return null;\n  }\n\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n    reader.readAsDataURL(file);\n  });\n}\n\nexport const getImageBitmap = async name => {\n  try {\n    const fileData = await getTextureData(name);\n    if (!fileData.file) {\n      return null;\n    }\n\n    return createImageBitmap(fileData.file);\n  } catch (err) {\n    console.error(err);\n    return null;\n  }\n}\n\n//export const getFileName = (fullpath) => {\n  //return fullpath.split('\\\\').pop().split('/').pop();\n//}\n\n\n//const base64ToFile = (data) => {\n  //const raw = window.atob(data);\n  //const rawLength = raw.length;\n  //const bytes = new Uint8Array(rawLength);\n\n  //for (let i = 0; i < rawLength; i++) {\n    //bytes[i] = raw.charCodeAt(i);\n  //}\n\n  //return bytes;\n//}\n\n","export const getTilePositionOnClick = (e, tileSize, offset) => {\n  offset = offset || [0.0, 0.0];\n  const bounds = e.target.getBoundingClientRect();\n  const w = Math.floor(e.target.width / tileSize[0]);\n  const x = Math.floor((e.clientX + offset[0] - bounds.left) / tileSize[0]);\n  const y = Math.floor((e.clientY + offset[1] - bounds.top) / tileSize[1]);\n  return [x, y];\n}\n\nexport const getTileUV = (frame, frameSize, textureSize) => {\n  // TODO: Better handling of out of bounds frame sizes\n  if (frameSize[0] >= textureSize[0] || frameSize[1] >= textureSize[1]) {\n    return [\n      [0.0, 0.0],\n      [0.0, 0.0],\n      [0.0, 0.0],\n      [0.0, 0.0],\n    ];\n  }\n\n  const frameWidth  = (frameSize[0] * 1.0) / textureSize[0];\n  const frameHeight = (frameSize[1] * 1.0) / textureSize[1];\n  const hFrames = Math.floor(textureSize[0] / frameSize[0]);\n  const vFrames = Math.floor(textureSize[1] / frameSize[1]);\n  const maxFrames = hFrames * vFrames;\n\n  const frameX = Math.floor(frame % hFrames);\n  const frameY = Math.floor((frame % maxFrames) / hFrames);\n  // Multiply the x coord of the frame in the texture atlas by the normalized value of the width one frame.\n  const topLeftX = frameX * (textureSize[0] / hFrames) * 1.0 / textureSize[0];\n  // Multiply the y coord of the frame in the tile map by the normalized value of the height one frame.\n  // Invert the value as the y axis is upwards for OpenGL\n  const topLeftY = frameY * (textureSize[1] / vFrames) / textureSize[1];\n\n  return [\n    [topLeftX, topLeftY], // top-left\n    [topLeftX + frameWidth, topLeftY], // top-right\n    [topLeftX + frameWidth, topLeftY + frameHeight], // bottom-right\n    [topLeftX, topLeftY + frameHeight], // bottom-left\n  ];\n}\n","import { getImageBitmap } from 'utils/file';\nimport { getTileUV } from 'utils/tile';\n\nclass TileManager {\n  constructor() {\n    this.tiles = new Map();\n    this.length = 0;\n  }\n\n  addTilesFromTileset = async (texture, tileSize) => {\n    const bitmap = await getImageBitmap(texture);\n    const hFrames = Math.floor(bitmap.width / tileSize[0]);\n    const vFrames = Math.floor(bitmap.height / tileSize[1]);\n\n    for (let i = 0; i < vFrames; i++) {\n      for (let j = 0; j < hFrames; j++) {\n        const idx = i * hFrames + j;\n        const uv = getTileUV(idx, tileSize, [bitmap.width, bitmap.height])\n        this.tiles.set(this.length, {\n          size: tileSize,\n          texture: texture,\n          uv: uv,\n        });\n        ++this.length;\n      }\n    }\n  }\n\n  get = (tile) => {\n    return this.tiles.get(tile);\n  }\n\n};\n\nconst TileManagerInstance = new TileManager();\n\nexport default TileManagerInstance;\n","import { set, get, del, keys, Store } from 'idb-keyval';\nimport TileManagerInstance from 'renderer/TileManager';\nimport { selectTileset } from 'redux/actions';\nimport { LOCAL_STORAGE_LAST_SELECTED_TILESET } from 'ui/constants';\nimport {\n  ADD_TILESET,\n  DELETE_TILESET,\n  LOAD_EXISTING_TILESETS\n} from 'redux/actionTypes';\n\nconst textureStore = new Store('textures-store', 'textures');\n\n// Gets all texture names available\nexport const getTextureNames = async () => {\n  try {\n    const textureNames = await keys(textureStore);\n    return textureNames;\n  } catch (err) {\n    console.error(err);\n    return [];\n  }\n};\n\nexport const getTextureData = async (name) => {\n  try {\n    const data = await get(name, textureStore);\n    return data;\n  } catch (err) {\n    console.error(err);\n    return null;\n  }\n};\n\nexport const setTextureData = async (name, data) => {\n  // TODO: If the texture already exists, choose a new name\n  try {\n    await set(name, { file: data, tilesetIndex: TileManagerInstance.length }, textureStore);\n    await TileManagerInstance.addTilesFromTileset(name, [32, 32]);\n    localStorage.setItem(LOCAL_STORAGE_LAST_SELECTED_TILESET, name);\n  } catch (err) {\n    console.error(err);\n  }\n};\n\nexport const deleteTextureData = async (name) => {\n  try {\n    await del(name, textureStore);\n    const lastSelectedTileset = localStorage.getItem(LOCAL_STORAGE_LAST_SELECTED_TILESET);\n    if (lastSelectedTileset === name) {\n      localStorage.removeItem(LOCAL_STORAGE_LAST_SELECTED_TILESET);\n    }\n  } catch (err) {\n    console.error(err);\n  }\n};\n\nexport const hasTexture = async (name) => {\n  try {\n    const textureKeys = await keys(textureStore);\n    return textureKeys.includes(name);\n  } catch (err) {\n    console.error(err);\n    return false;\n  }\n}\n\nconst loadTilesFromExistingTilesets = async (tilesets) => {\n  // Return if tiles where already loaded\n  if (TileManagerInstance.length > 0) {\n    return;\n  }\n  // Create tiles from textures\n  // Respects order of creation\n  // TODO: replace hardcoded 32 x 32 tile size with a user defined one\n  for (const tileset of tilesets) {\n    console.log(tileset);\n    await TileManagerInstance.addTilesFromTileset(tileset, [32, 32]);\n  }\n}\n\nconst idbReduxMiddleware = store => next => action => {\n  switch(action.type) {\n    case ADD_TILESET: {\n      const { name, data } = action.payload || {};\n      setTextureData(name, data);\n      break;\n    }\n\n    case LOAD_EXISTING_TILESETS: {\n      const { names } = action.payload || {};\n      loadTilesFromExistingTilesets(names);\n      break;\n    }\n\n    case DELETE_TILESET: {\n      const { name } = action.payload || {};\n      deleteTextureData(name);\n      break;\n    }\n\n    default:\n      break;\n  }\n\n  return next(action);\n}\n\nexport { idbReduxMiddleware };\n","import { compose, createStore, applyMiddleware } from 'redux';\nimport rootReducer from 'redux/reducers';\nimport { tilemapReduxMiddleware } from 'tilemap';\nimport { idbReduxMiddleware } from 'idbTextureStore';\n\n// Remove Redux Devtools in production\nconst composeEnhancer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst store = createStore(rootReducer, composeEnhancer(applyMiddleware(tilemapReduxMiddleware, idbReduxMiddleware)));\nexport default store;\n","function createShader(gl, source, type) {\n  const shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if ( !gl.getShaderParameter(shader, gl.COMPILE_STATUS) ) {\n    const info = gl.getShaderInfoLog(shader);\n    console.error('Could not compile shader: ' + info);\n  }\n\n  return shader;\n}\n\nclass ShaderProgram {\n  constructor(gl, vertexSource, fragmentSource) {\n    this.gl = gl;\n    this.vertexSource = vertexSource;\n    this.fragmentSource = fragmentSource;\n    this.init();\n  }\n\n  init = () => {\n    const vertexShader = createShader(this.gl, this.vertexSource, this.gl.VERTEX_SHADER);\n    const fragmentShader = createShader(this.gl, this.fragmentSource, this.gl.FRAGMENT_SHADER);\n\n    this.id = this.gl.createProgram();\n    this.gl.attachShader(this.id, vertexShader);\n    this.gl.attachShader(this.id, fragmentShader);\n    this.gl.linkProgram(this.id);\n\n    if (!this.gl.getProgramParameter(this.id, this.gl.LINK_STATUS)) {\n      console.error('Unable to initialize the shader program: ' + this.gl.getProgramInfoLog(this.id));\n      return null;\n    }\n  }\n\n  use = () => {\n    this.gl.useProgram(this.id);\n  }\n\n  setMat4 = (uniformName, value) => {\n    this.gl.uniformMatrix4fv(this.gl.getUniformLocation(this.id, uniformName), false, value);\n  }\n\n  setInt = (uniformName, value) => {\n    this.gl.uniform1i(this.gl.getUniformLocation(this.id, uniformName), value);\n  }\n}\n\nexport default ShaderProgram;\n","import { getImageBitmap } from 'utils/file';\nimport { getTileUV } from 'utils/tile';\n\nclass Texture {\n  constructor(gl, name) {\n    this.name = name;\n    this.create(gl);\n  }\n\n  create = gl => {\n    this.id = gl.createTexture();\n\n    gl.bindTexture(gl.TEXTURE_2D, this.id);\n\n    this.width = 1;\n    this.height = 1;\n    const pixel = new Uint8Array([0, 0, 0, 0]);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n\n    getImageBitmap(this.name).then(bitmap => {\n      if (!bitmap) {\n        return;\n      }\n\n      this.width = bitmap.width;\n      this.height = bitmap.height;\n\n      gl.bindTexture(gl.TEXTURE_2D, this.id);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, bitmap);\n\n      gl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n      gl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n      gl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri (gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    });\n  }\n\n  bind = (gl) => {\n    gl.bindTexture(gl.TEXTURE_2D, this.id);\n  }\n\n  getUV = (frame, frameSize) => {\n    return getTileUV(frame, frameSize, [this.width, this.height]);\n    //// If the texture has not been initialized yet\n    //if (this.width == 1 && this.height == 1) {\n      //return [\n        //[0.0, 0.0],\n        //[0.0, 0.0],\n        //[0.0, 0.0],\n        //[0.0, 0.0],\n      //];\n    //}\n\n    //const frameWidth  = (frameSize[0] * 1.0) / this.width;\n    //const frameHeight = (frameSize[1] * 1.0) / this.height;\n    //const hFrames = Math.floor(this.width / frameSize[0]);\n    //const vFrames = Math.floor(this.height / frameSize[1]);\n    //const maxFrames = hFrames * vFrames;\n\n    //const frameX = Math.floor(frame % hFrames);\n    //const frameY = Math.floor((frame % maxFrames) / hFrames);\n    //// Multiply the x coord of the frame in the texture atlas by the normalized value of the width one frame.\n    //const topLeftX = frameX * (this.width / hFrames) * 1.0 / this.width;\n    //// Multiply the y coord of the frame in the tile map by the normalized value of the height one frame.\n    //// Invert the value as the y axis is upwards for OpenGL\n    //const topLeftY = frameY * (this.height / vFrames) / this.height;\n\n    //return [\n      //[topLeftX, topLeftY],\n      //[topLeftX + frameWidth, topLeftY],\n      //[topLeftX + frameWidth, topLeftY + frameHeight],\n      //[topLeftX, topLeftY + frameHeight],\n    //];\n  }\n}\n\nexport default Texture;\n\n","import Texture from 'renderer/Texture';\n\nclass TextureManager {\n  constructor() {\n    this.map = new Map();\n    this.indexMap = new Map();\n  }\n\n  add = (gl, name) => {\n    this.indexMap.set(name, this.map.size);\n    this.map.set(name, new Texture(gl, name));\n  }\n\n  get(name) {\n    return this.map.get(name);\n  }\n\n  getIndex(name) {\n    return this.indexMap.get(name);\n  }\n\n  has(name) {\n    return this.map.has(name);\n  }\n\n  remove(name) {\n    this.map.delete(name);\n  }\n}\n\nexport default TextureManager;\n","export const UNIFORM_PROJECTION = 'uProjectionMatrix';\nexport const UNIFORM_MVP = 'uMVP';\nexport const UNIFORM_SAMPLERS = 'uSamplers';\n\nexport const ATTRIB_POSITION = 'aPosition';\nexport const ATTRIB_TEXTURE_COORD = 'aTextureCoord';\nexport const ATTRIB_TEXTURE_IDX = 'aTextureIdx';\nexport const ATTRIB_COLOR = 'aColor';\n\nexport const BATCH_VERTEX_SHADER_SOURCE = `#version 300 es\n\n      in vec2 ${ATTRIB_POSITION};\n      in float ${ATTRIB_TEXTURE_IDX};\n      in vec2 ${ATTRIB_TEXTURE_COORD};\n      in vec4 ${ATTRIB_COLOR};\n\n      out vec2 vTextureCoord;\n      out float vTextureIdx;\n      out vec4 vColor;\n\n      uniform mat4 ${UNIFORM_MVP};\n\n      void main() {\n        gl_Position = ${UNIFORM_MVP} * vec4(aPosition, 0.0, 1.0);\n        vTextureCoord = ${ATTRIB_TEXTURE_COORD};\n        vTextureIdx = ${ATTRIB_TEXTURE_IDX};\n        vColor = ${ATTRIB_COLOR};\n      }\n      `;\n\nexport const BATCH_FRAGMENT_SHADER_SOURCE = `#version 300 es\n\n      precision mediump float;\n\n      in vec2 vTextureCoord;\n      in float vTextureIdx;\n      in vec4 vColor;\n\n      out vec4 oColor;\n\n      uniform sampler2D ${UNIFORM_SAMPLERS}[11];\n\n      void main() {\n        vec4 finalColor = vec4(0.0);\n        int tid = int(vTextureIdx + 0.5);\n\n        switch (tid)\n        {\n          case 0:\n            finalColor = texture(${UNIFORM_SAMPLERS}[0], vTextureCoord);\n            break;\n          case 1:\n            finalColor = texture(${UNIFORM_SAMPLERS}[1], vTextureCoord);\n            break;\n          case 2:\n            finalColor = texture(${UNIFORM_SAMPLERS}[2], vTextureCoord);\n            break;\n          case 3:\n            finalColor = texture(${UNIFORM_SAMPLERS}[3], vTextureCoord);\n            break;\n          case 4:\n            finalColor = texture(${UNIFORM_SAMPLERS}[4], vTextureCoord);\n            break;\n          case 5:\n            finalColor = texture(${UNIFORM_SAMPLERS}[5], vTextureCoord);\n            break;\n          case 6:\n            finalColor = texture(${UNIFORM_SAMPLERS}[6], vTextureCoord);\n            break;\n          case 7:\n            finalColor = texture(${UNIFORM_SAMPLERS}[7], vTextureCoord);\n            break;\n          case 8:\n            finalColor = texture(${UNIFORM_SAMPLERS}[8], vTextureCoord);\n            break;\n          case 9:\n            finalColor = texture(${UNIFORM_SAMPLERS}[9], vTextureCoord);\n            break;\n          case 10:\n            finalColor = texture(${UNIFORM_SAMPLERS}[10], vTextureCoord);\n            break;\n        }\n\n        oColor = finalColor;\n      }\n      `;\n        \n","import TextureManager from 'renderer/TextureManager';\nimport TileManagerInstance from 'renderer/TileManager';\nimport {\n  ATTRIB_POSITION,\n  ATTRIB_TEXTURE_COORD,\n  ATTRIB_TEXTURE_IDX,\n  ATTRIB_COLOR,\n  UNIFORM_SAMPLERS,\n} from 'renderer/constants';\n\nconst createIndices = (indicesSize) => {\n  let offset = 0;\n  let indices = new Uint16Array(indicesSize);\n\n  for (let i = 0; i < indicesSize; i += 6)\n  {\n    indices[i]     = offset;\n    indices[i + 1] = offset + 1;\n    indices[i + 2] = offset + 2;\n\n    indices[i + 3] = offset;\n    indices[i + 4] = offset + 2;\n    indices[i + 5] = offset + 3;\n\n    offset += 4;\n  }\n\n  return indices;\n}\n\nexport default class Batch2D {\n  constructor(gl, shaderProgram) {\n    this.gl = gl;\n    this.shaderProgram = shaderProgram;\n    this.textures = [];\n    this.textureManager = new TextureManager();\n    this.create();\n  }\n\n  create = () => {\n    const maxSprites  = 10000;\n    const floatsPerVertex = 9;\n    const bytesPerVertex = 4 * floatsPerVertex;\n    const floatsPerSprite = floatsPerVertex * 4;\n    const totalFloats = maxSprites * floatsPerSprite;\n    const indicesSize = 6 * maxSprites;\n\n    this.vertices = new Float32Array(totalFloats);\n    this.indices = createIndices(indicesSize);\n\n    this.VAO = this.gl.createVertexArray();\n    this.VBO = this.gl.createBuffer();\n    this.EBO = this.gl.createBuffer();\n\n    this.gl.bindVertexArray(this.VAO);\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.VBO);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.vertices, this.gl.DYNAMIC_DRAW);\n\n    // Position\n    const locPosition = this.gl.getAttribLocation(this.shaderProgram.id, ATTRIB_POSITION);\n    this.gl.vertexAttribPointer(locPosition, 2, this.gl.FLOAT, false, bytesPerVertex, 0);\n    this.gl.enableVertexAttribArray(locPosition);\n\n    // TextureCoord\n    const locTextureCoord = this.gl.getAttribLocation(this.shaderProgram.id, ATTRIB_TEXTURE_COORD);\n    this.gl.vertexAttribPointer(locTextureCoord, 2, this.gl.FLOAT, false, bytesPerVertex, 2 * 4);\n    this.gl.enableVertexAttribArray(locTextureCoord);\n\n    // TextureIdx\n    const locTextureIdx = this.gl.getAttribLocation(this.shaderProgram.id, ATTRIB_TEXTURE_IDX);\n    this.gl.vertexAttribPointer(locTextureIdx, 1, this.gl.FLOAT, false, bytesPerVertex, 4 * 4);\n    this.gl.enableVertexAttribArray(locTextureIdx);\n\n    // Color\n    const locColor = this.gl.getAttribLocation(this.shaderProgram.id, ATTRIB_COLOR);\n    this.gl.vertexAttribPointer(locColor, 4, this.gl.FLOAT, false, bytesPerVertex, 5 * 4);\n    this.gl.enableVertexAttribArray(locColor);\n\n    this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.EBO);\n    this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, this.indices, this.gl.STATIC_DRAW);\n\n    // Used for emplacing tiles\n    this.vertexIndex = 0;\n\n    // Used for rendering\n    this.indexCount = 0;\n  }\n\n  begin = () => {\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.VBO);\n  }\n\n  emplace = (tileValue, position, color) => {\n    const tileData = TileManagerInstance.get(tileValue);\n    if (!tileData) {\n      console.error(`Could not get tile data for tile ${tileData}`);\n      return;\n    }\n\n    let r = 0.0;\n    let g = 0.0;\n    let b = 0.0;\n    let a = 0.0;\n\n    if (color) {\n      r = color.r;\n      g = color.g;\n      b = color.b;\n      a = color.a;\n    }\n\n    let textureIdx = 0.0;\n\n    if (this.textureManager.has(tileData.texture)) {\n      textureIdx = this.textureManager.getIndex(tileData.texture);\n    }\n    else {\n      this.textureManager.add(this.gl, tileData.texture);\n      textureIdx = this.textureManager.getIndex(tileData.texture);\n    }\n\n    // Top left\n    this.vertices[this.vertexIndex++] = position[0];\n    this.vertices[this.vertexIndex++] = position[1];\n    this.vertices[this.vertexIndex++] = tileData.uv[0][0];\n    this.vertices[this.vertexIndex++] = tileData.uv[0][1];\n    this.vertices[this.vertexIndex++] = textureIdx;\n    this.vertices[this.vertexIndex++] = r;\n    this.vertices[this.vertexIndex++] = g;\n    this.vertices[this.vertexIndex++] = b;\n    this.vertices[this.vertexIndex++] = a;\n\n    // Top right\n    this.vertices[this.vertexIndex++] = position[0] + tileData.size[0];\n    this.vertices[this.vertexIndex++] = position[1];\n    this.vertices[this.vertexIndex++] = tileData.uv[1][0];\n    this.vertices[this.vertexIndex++] = tileData.uv[1][1];\n    this.vertices[this.vertexIndex++] = textureIdx;\n    this.vertices[this.vertexIndex++] = r;\n    this.vertices[this.vertexIndex++] = g;\n    this.vertices[this.vertexIndex++] = b;\n    this.vertices[this.vertexIndex++] = a;\n\n    // Bottom right\n    this.vertices[this.vertexIndex++] = position[0] + tileData.size[0];\n    this.vertices[this.vertexIndex++] = position[1] + tileData.size[1];\n    this.vertices[this.vertexIndex++] = tileData.uv[2][0];\n    this.vertices[this.vertexIndex++] = tileData.uv[2][1];\n    this.vertices[this.vertexIndex++] = textureIdx;\n    this.vertices[this.vertexIndex++] = r;\n    this.vertices[this.vertexIndex++] = g;\n    this.vertices[this.vertexIndex++] = b;\n    this.vertices[this.vertexIndex++] = a;\n\n    // Bottom left\n    this.vertices[this.vertexIndex++] = position[0];\n    this.vertices[this.vertexIndex++] = position[1] + tileData.size[1];\n    this.vertices[this.vertexIndex++] = tileData.uv[3][0];\n    this.vertices[this.vertexIndex++] = tileData.uv[3][1];\n    this.vertices[this.vertexIndex++] = textureIdx;\n    this.vertices[this.vertexIndex++] = r;\n    this.vertices[this.vertexIndex++] = g;\n    this.vertices[this.vertexIndex++] = b;\n    this.vertices[this.vertexIndex++] = a;\n\n    this.indexCount += 6;\n  }\n\n  flush = () => {\n    this.gl.bufferSubData(this.gl.ARRAY_BUFFER, 0, this.vertices.subarray(0, this.vertexIndex));\n    this.vertexIndex = 0;\n  }\n\n  render = (shader) => {\n    if (this.indexCount === 0) {\n      return;\n    }\n\n    let idx = 0;\n    this.textureManager.map.forEach(texture => {\n      this.gl.activeTexture(this.gl.TEXTURE0 + idx);\n      texture.bind(this.gl);\n      this.shaderProgram.setInt(`${UNIFORM_SAMPLERS}[${idx}]`, idx);\n      ++idx;\n    });\n\n    this.gl.activeTexture(this.gl.TEXTURE0);\n\n    this.gl.bindVertexArray(this.VAO);\n    this.gl.drawElements(this.gl.TRIANGLES, this.indexCount, this.gl.UNSIGNED_SHORT, 0);\n    this.indexCount = 0;\n  }\n}\n","import { mat4 } from 'gl-matrix';\n\nconst ZOOM_MAX = 5.0;\nconst ZOOM_MIN = 0.25;\nconst ZOOM_THRESHOLD = 10;\n\nconst zoomLevels = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75];\n\nclass Camera {\n  constructor(width, height) {\n    this.width = width;\n    this.height = height;\n    this.zoomLevel = 3;\n    this.zoom = 0;\n    this.perceivedWidth = this.width;\n    this.perceivedHeight = this.height;\n    this.origin = [0.0, 0.0];\n    this.clientOrigin = [0.0, 0.0];\n    this.cameraZ = 80.0;\n    this.position = [0.0, 0.0, this.cameraZ];\n    this.near = 0.1;\n    this.far = 100.0;\n    this.projection = mat4.create();\n    this.modelView = mat4.create();\n    this.mvp = mat4.create();\n\n    mat4.translate(this.modelView, this.modelView, [0.0, 0.0, -this.cameraZ]);\n    this.calculateMvp();\n  }\n\n  setOrigin = (x, y) => {\n    this.origin = [this.position[0], this.position[1]];\n    this.clientOrigin = [x, y];\n  }\n\n  moveTo = (x, y) => {\n    this.position = [this.origin[0] + (this.clientOrigin[0] - x), this.origin[1] + (this.clientOrigin[1] - y), this.cameraZ];\n    this.calculateMvp();\n  }\n\n  setZoom = (zoom) => {\n    // Clamp zoom value\n    this.zoom = this.clampZoom(zoom);\n    this.calculateMvp();\n  }\n\n  applyZoom = (zoom) => {\n    this.zoom += zoom;\n\n    if (Math.abs(this.zoom) < ZOOM_THRESHOLD) {\n      return;\n    }\n\n    if (this.zoom < 0) {\n      this.zoomLevel = Math.max(0, this.zoomLevel - 1);\n    }\n    else if (this.zoom > 0) {\n      this.zoomLevel = Math.min(zoomLevels.length - 1, this.zoomLevel + 1);\n    }\n\n    this.perceivedWidth = this.width / zoomLevels[this.zoomLevel];\n    this.perceivedHeight = this.height / zoomLevels[this.zoomLevel];\n    this.zoom = 0;\n    this.calculateMvp();\n  }\n\n  getMvp = () => {\n    return this.mvp;\n  }\n\n  getZoomLevel = () => {\n    return zoomLevels[this.zoomLevel];\n  }\n\n  calculateMvp = () => {\n    // TODO: Anchor on center when zooming\n    const computedPositionX = this.position[0] / zoomLevels[this.zoomLevel];\n    const computedPositionY = this.position[1] / zoomLevels[this.zoomLevel];\n\n    mat4.ortho(this.projection,\n               computedPositionX,\n               this.perceivedWidth + computedPositionX,\n               this.perceivedHeight + computedPositionY,\n               computedPositionY,\n               this.near,\n               this.far);\n\n    //mat4.ortho(this.projection,\n              //(this.width - this.perceivedWidth) + this.position[0] / zoomLevels[this.zoomLevel],\n              //this.perceivedWidth + this.position[0] / zoomLevels[this.zoomLevel],\n              //this.perceivedHeight + this.position[1] / zoomLevels[this.zoomLevel],\n              //(this.height - this.perceivedHeight) + this.position[1] / zoomLevels[this.zoomLevel],\n              //this.near,\n              //this.far);\n\n    mat4.multiply(this.mvp, this.projection, this.modelView);\n  }\n};\n\nexport default Camera;\n","import store from 'redux/store';\nimport TilemapInstance from 'tilemap';\nimport ShaderProgram from 'renderer/Shader';\nimport Batch2D from 'renderer/Batch2D';\nimport Texture from 'renderer/Texture';\nimport Camera from 'renderer/Camera';\nimport {\n  UNIFORM_MVP,\n  BATCH_VERTEX_SHADER_SOURCE,\n  BATCH_FRAGMENT_SHADER_SOURCE,\n} from 'renderer/constants';\n\n// TODO: Provide a method to change tile size per layer\nconst tileSize = [32, 32];\n\nclass Renderer {\n  hasInitialized = false\n\n  init = (gl) => {\n    console.log('DEBUG: CONSTRUCTING RENDERER');\n\n    this.gl = gl;\n    if (!this.gl) {\n      return;\n    }\n\n    this.shaderProgram = new ShaderProgram(this.gl, BATCH_VERTEX_SHADER_SOURCE, BATCH_FRAGMENT_SHADER_SOURCE);\n    this.shaderProgram.use();\n\n    this.camera = new Camera(this.gl.canvas.width, this.gl.canvas.height);\n    //this.camera.setPosition(100, 100);\n\n    this.shaderProgram.setMat4(UNIFORM_MVP, this.camera.getMvp());\n\n    this.batch = new Batch2D(this.gl, this.shaderProgram);\n    this.hasInitialized = true;\n  }\n\n  setClearColor = (r, g, b, a) => {\n    this.gl.clearColor(r, g, b, a);\n  }\n\n  //updateViewport = (width, height) => {\n    //this.gl.viewport(0, 0, width, height);\n    //const projectionMatrix = mat4.create();\n    //mat4.ortho(projectionMatrix, 0, width, height, 0, 0.1, 100.0);\n    //this.shaderProgram.use();\n    //this.shaderProgram.setMat4(UNIFORM_PROJECTION, projectionMatrix);\n  //}\n\n  render = () => {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n    this.renderGrid();\n    window.requestAnimationFrame(this.render);\n  }\n\n  renderGrid = () => {\n    // Return early if the wasm module hasn't loaded yet\n    if (!TilemapInstance.hasInitialized) {\n      return;\n    }\n\n    this.shaderProgram.use();\n\n    // TODO: Get offset and zoom from camera\n    // to get the actual tiles to render from rust\n    const canvasWidth = this.gl.canvas.width;\n    const canvasHeight = this.gl.canvas.height;\n    const layersState = store.getState().layers;\n    this.shaderProgram.setMat4(UNIFORM_MVP, this.camera.getMvp());\n\n    this.batch.begin();\n\n    for (const layerName of layersState.names) {\n      const layer = layersState.layers[layerName];\n      if (!layer.visible) {\n        continue;\n      }\n\n      if (layer.id >= 0) {\n        for (let i = 0, y = 0; y < canvasHeight; i++, y += tileSize[1]) {\n          for (let j = 0, x = 0; x < canvasWidth; j++, x += tileSize[0]) {\n            const value = TilemapInstance.get(j, i, layer.id);\n\n            if (value != -1) {\n              this.batch.emplace(value, [x, y]);\n            }\n          }\n        }\n      }\n    }\n\n\n    this.batch.flush();\n    this.batch.render(this.shaderProgram);\n  }\n}\n\nconst RendererInstance = new Renderer();\n\nexport default RendererInstance;\n","import { useEffect, useRef } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { addLayer } from 'redux/actions';\nimport RendererInstance from 'renderer/Renderer';\nimport TilemapInstance from 'tilemap';\nimport { TILEMAP_CANVAS_ID } from 'ui/constants';\n\n// TODO: Provide a method to change tile size per layer\nconst tileSize = [32, 32];\n\nconst WebGLCanvas = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const tilesCanvasRef = useRef();\n\n  // ====================================\n  // Logic\n  // ====================================\n  useEffect(() => {\n    if (!tilesCanvasRef.current) {\n      return;\n    }\n\n    // Update canvas sizes\n    tilesCanvasRef.current.width = tilesCanvasRef.current.clientWidth;\n    tilesCanvasRef.current.height = tilesCanvasRef.current.clientHeight;\n\n    if (!TilemapInstance.hasInitialized) {\n      // TODO: Remove dispatch from here and add a layer only if there isn't any\n      TilemapInstance.init().then(() => {\n        dispatch(addLayer(null, 0, 0, Math.floor(tilesCanvasRef.current.width / tileSize[0]) + 1,\n                                      Math.floor(tilesCanvasRef.current.height / tileSize[1]) + 1));\n      });\n    }\n\n    if (!RendererInstance.hasInitialized) {\n      RendererInstance.init(tilesCanvasRef.current.getContext('webgl2'));\n      //RendererInstance.setClearColor(55.0 / 255.0, 65.0 / 255.0, 81.0 / 255.0, 1.0);\n      RendererInstance.setClearColor(31.0 / 255.0, 41.0 / 255.0, 55.0 / 255.0, 1.0);\n      window.requestAnimationFrame(RendererInstance.render);\n    }\n  }, [dispatch]);\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <canvas id={TILEMAP_CANVAS_ID} ref={tilesCanvasRef} className='col-span-full row-span-full z-0 w-full h-full' />\n  );\n}\n    //<AbsoluteCanvas\n      //id={TILEMAP_CANVAS_ID}\n      //style={{ width: '100%', height: '100%', zIndex: '0' }}\n      //ref={tilesCanvasRef}\n    ///>\n\nexport default WebGLCanvas;\n","import { useEffect, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { selectTool } from 'redux/actions';\nimport { getTilePositionOnClick } from 'utils/tile';\nimport { EDITOR_CANVAS_ID } from 'ui/constants';\nimport RendererInstance from 'renderer/Renderer';\nimport TilemapInstance from 'tilemap';\nimport * as tools from 'ui/canvas/tools';\n\n// TODO: Provide a method to change tile size per layer\nconst tileSize = [32, 32];\n\nconst EditorCanvas = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const editingCanvasRef = useRef();\n  const { selectedLayer, layers } = useSelector(state => ({ selectedLayer: state.layers.selected, layers: state.layers.layers }));\n  const selectedTile = useSelector(state => state.tileset.selectedTile);\n  const selectedTool = useSelector(state => state.canvas.selectedTool);\n\n  // ====================================\n  // Logic\n  // ====================================\n  useEffect(() => {\n    const refElement = editingCanvasRef.current;\n    if (!refElement) {\n      return;\n    }\n\n    editingCanvasRef.current.width = refElement.clientWidth;\n    editingCanvasRef.current.height = refElement.clientHeight;\n\n    // Used to allow preventing default wheel behavior on chrome\n    const cancelWheel = event => event.preventDefault();\n    refElement.addEventListener('wheel', cancelWheel, {passive: false});\n    return () => {\n        refElement.removeEventListener('wheel', cancelWheel);\n    }\n  }, []);\n\n  useEffect(() => {\n    const panToolStartHandler = ({ key }) => {\n      if (key === ' ') {\n        dispatch(selectTool(tools.PAN_TOOL));\n      }\n    }\n\n    // TODO: Create a stack of tools to be able to get back\n    // to the previous tool instead of the default one\n    const panToolEndHandler = ({ key }) => {\n      if (key === ' ') {\n        dispatch(selectTool(tools.DEFAULT_TOOL));\n      }\n    }\n\n    window.addEventListener('keydown', panToolStartHandler);\n    window.addEventListener('keyup', panToolEndHandler);\n    return () => {\n      window.removeEventListener('keydown', panToolStartHandler);\n      window.removeEventListener('keyup', panToolEndHandler);\n    };\n  }, [dispatch]);\n\n  const handleOneTimeTools = e => {\n    switch (selectedTool) {\n      case tools.FILL_TOOL: {\n        const zoomLevel = RendererInstance.camera.getZoomLevel();\n        const position = getTilePositionOnClick(e, [tileSize[0] * zoomLevel, tileSize[1] * zoomLevel], RendererInstance.camera.position);\n        const layerId = layers[selectedLayer].id;\n\n        TilemapInstance.fill(...position, selectedTile, layerId);\n        break;\n      }\n\n      case tools.PAN_TOOL: {\n        RendererInstance.camera.setOrigin(e.clientX, e.clientY);\n        break;\n      }\n\n      default:\n        break;\n    }\n  }\n\n  const handleContinuousTools = e => {\n    const zoomLevel = RendererInstance.camera.getZoomLevel();\n    const position = getTilePositionOnClick(e, [tileSize[0] * zoomLevel, tileSize[1] * zoomLevel], RendererInstance.camera.position);\n    const layerId = layers[selectedLayer].id;\n\n    switch (selectedTool) {\n      case tools.DEFAULT_TOOL: {\n        break;\n      }\n\n      case tools.PLACEMENT_TOOL: {\n        if (selectedTile !== null && selectedTile !== undefined && selectedTile !== -1) {\n          TilemapInstance.set(...position, selectedTile, layerId);\n        }\n        break;\n      }\n\n      case tools.PAN_TOOL: {\n        if (e.clientX == 0 || e.clientY == 0) {\n          break;\n        }\n\n        RendererInstance.camera.moveTo(e.clientX, e.clientY);\n        break;\n      }\n\n      default:\n        break;\n    }\n  }\n\n  const handleMouseDown = e => {\n    handleOneTimeTools(e);\n    handleContinuousTools(e);\n  }\n\n  const handleDrag = e => {\n    handleContinuousTools(e);\n  }\n\n  const handleWheel = e => {\n    if (!e.altKey) {\n      return;\n    }\n\n    RendererInstance.camera.applyZoom(e.deltaY);\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <canvas id={EDITOR_CANVAS_ID}\n            ref={editingCanvasRef}\n            onWheel={handleWheel}\n            onMouseDown={handleMouseDown}\n            onDrag={handleContinuousTools}\n            draggable='true'\n            className='col-span-full row-span-full z-10 w-full h-full'\n    />\n  );\n}\n    //<AbsoluteCanvas\n      //id={EDITOR_CANVAS_ID}\n      //style={{ width: '100%', height: '100%', zIndex: '1' }}\n      //onMouseDown={handleMouseDown}\n      //onDrag={handleContinuousTools}\n      //onWheel={handleWheel}\n      //ref={editingCanvasRef}\n    ///>\n\nexport default EditorCanvas;\n","import Toolbar from 'ui/canvas/Toolbar';\nimport WebGLCanvas from 'ui/canvas/WebGLCanvas';\nimport EditorCanvas from 'ui/canvas/EditorCanvas';\n\nconst Canvas = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div className='col-span-3 flex flex-col'>\n      <Toolbar />\n      <section className='grid flex-1 bg-gray-600'>\n        <EditorCanvas />\n        <WebGLCanvas />\n      </section>\n    </div>\n  );\n}\n\nexport default Canvas;\n","import { NavLink } from \"react-router-dom\";\nimport Icon from '@mdi/react';\n\nconst TabButton = ({ iconPath, routerPath }) => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <NavLink to={routerPath} activeClassName='text-indigo-200 bg-indigo-900'>\n      <button className='px-2 py-3 hover:text-indigo-400 hover:bg-indigo-900' data-tip data-for={routerPath}>\n        <Icon path={iconPath} size={1.2} />\n      </button>\n    </NavLink>\n  );\n}\n\nexport default TabButton;\n","import ReactTooltip from \"react-tooltip\";\nimport tooltips from 'ui/tooltips';\nimport TabButton from 'ui/sidebar/TabButton';\nimport * as tabs from 'ui/sidebar/tabs';\nimport { dividerBorderColor } from 'ui/common/styles';\nimport { TOOLTIP_DELAY } from 'ui/constants';\nimport {\n  mdiMap,\n  mdiViewModule,\n  mdiContentSave,\n  mdiUpload,\n  mdiHelpCircleOutline,\n  mdiCog,\n} from '@mdi/js';\n\nconst TabSelector = () => {\n  // ====================================\n  // Render\n  // ====================================\n  const sectionsData = [\n    { path: tabs.TAB_TILES, icon: mdiViewModule },\n    { path: tabs.TAB_MAP, icon: mdiMap },\n    { path: tabs.TAB_IMPORT, icon: mdiUpload },\n    { path: tabs.TAB_EXPORT, icon: mdiContentSave },\n    { path: tabs.TAB_SETTINGS, icon: mdiCog },\n    { path: tabs.TAB_HELP, icon: mdiHelpCircleOutline },\n  ];\n\n  const sections = sectionsData.map(section =>\n    <div key={section.path} className='flex' data-testid={section.path}>\n      <TabButton routerPath={section.path} iconPath={section.icon}/>\n      <ReactTooltip id={section.path} place='right' effect='solid' delayShow={TOOLTIP_DELAY}>\n        {tooltips.get(section.path)}\n      </ReactTooltip>\n    </div>);\n\n  return (\n    <div className={`flex flex-col justify-end bg-black border-r ${dividerBorderColor}`}>\n      {sections}\n    </div>\n  );\n}\n\nexport default TabSelector;\n","import { dividerBorderColor, titleBarHeight } from './styles.js';\n\nconst Tab = ({ children, title }) => {\n  return (\n    <div className='flex-1 flex flex-col text-sm'>\n      <h2 className={`${titleBarHeight} bg-black border-b ${dividerBorderColor} px-2 flex items-center`}>\n        {title}\n      </h2>\n      {children}\n    </div>\n  );\n}\n\nexport default Tab;\n","export const getLayersState = state => state.layers;\n\nexport const getLayersNames = state =>\n  getLayersState(state) ? getLayersState(state).names : [];\n\nexport const getLayerByName = (state, name) =>\n  getLayersState(state) ? { ...getLayersState(state).layers[name], name } : {};\n\nexport const getLayers = state =>\n  getLayersNames(state).map(name => getLayerByName(state, name));\n\nexport const getLayersByAddedTime = state => getLayers(state).reverse();\n\nexport const getVisibleLayers = state => {\n  const layersState = getLayersState(state);\n  return layersState.names.filter(name => layersState.layers[name].visible).reverse();\n}\n","import { useState } from 'react';\nimport { Collapse } from 'react-collapse';\nimport Icon from '@mdi/react';\nimport { mdiMenuDown, mdiMenuRight } from '@mdi/js';\nimport { dividerBorderColor, titleBarHeight } from './styles.js';\n\nconst CollapseSection = ({ title, children }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const [open, setOpen] = useState(true);\n  const icon = open ? mdiMenuDown : mdiMenuRight;\n  const sectionClass = open ? `border-b ${dividerBorderColor}` : '';\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div className={sectionClass}>\n      <div className={`text-xs flex items-center hover:bg-gray-800 cursor-pointer border-b ${dividerBorderColor} ${titleBarHeight}`}\n           onDoubleClick={e => setOpen(!open)}\n      >\n        <Icon path={icon} size={1} />\n\n        <h1 className='select-none'>\n          {title}\n        </h1>\n      </div>\n\n      <Collapse isOpened={open}>\n        <div className='text-xs text-gray-300 px-2 py-2'>\n          {children}\n        </div>\n      </Collapse>\n    </div>\n  );\n}\n\nexport default CollapseSection;\n","import { useDispatch } from 'react-redux';\nimport { Draggable } from 'react-beautiful-dnd';\nimport { selectLayer, toggleLayerVisibility } from 'redux/actions';\nimport { mdiEye, mdiEyeOffOutline } from '@mdi/js';\nimport Icon from '@mdi/react';\nimport * as testIds from 'resources/testIds';\n\nconst LayerItem = ({ layer, index, isSelected }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n\n  // ====================================\n  // Logic\n  // ====================================\n  const handleLayerClick = () => {\n    dispatch(selectLayer(layer.name));\n  }\n\n  const handleEyeClick = () => {\n    dispatch(toggleLayerVisibility(layer.name));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  const icon = layer.visible ? mdiEye : mdiEyeOffOutline;\n  const selectedClassName = isSelected ? 'bg-gray-700' : 'bg-gray-800 hover:bg-gray-900';\n  const visibilityTestId = layer.visible ? testIds.LAYER_VISIBLE : testIds.LAYER_HIDDEN;\n\n  return (\n    <div className='border-t border-gray-700 first:border-t-0'>\n    <Draggable draggableId={layer.name} index={index}>\n      {(provided, snapshop) => {\n        const style = {\n          cursor: 'default',\n          ...provided.draggableProps.style,\n        };\n\n        return (\n          <li className={`flex items-center select-none ${selectedClassName}`}\n              ref={provided.innerRef}\n              {...provided.draggableProps}\n              {...provided.dragHandleProps}\n              style={style}\n              data-testid={visibilityTestId}\n          >\n            <span className='flex-1 pl-4 py-1' onClick={handleLayerClick}>\n              {layer.name}\n            </span>\n            <span onClick={handleEyeClick} className='cursor-pointer pr-4 py-1' data-testid={testIds.HIDE_LAYER_BUTTON}>\n              <Icon path={icon} size={0.6} />\n            </span>\n          </li>);\n        }\n      }\n    </Draggable>\n    </div>\n  );\n}\n\nexport default LayerItem;\n","import { useDispatch } from 'react-redux';\nimport { addLayer, deleteLayer } from 'redux/actions';\nimport { mdiDelete, mdiPlaylistPlus } from '@mdi/js';\nimport Icon from '@mdi/react';\nimport * as testIds from 'resources/testIds';\n\nconst LayerListFooter = ({ selectedLayer }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n\n  // ====================================\n  // Logic\n  // ====================================\n  const handleAddClick = () => {\n    dispatch(addLayer());\n  }\n\n  const handleDeleteClick = () => {\n    dispatch(deleteLayer(selectedLayer));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div className='flex items-center justify-start mt-1'>\n      <button onClick={handleAddClick} data-testid={testIds.ADD_LAYER_BUTTON}>\n        <Icon path={mdiPlaylistPlus} size={0.7} />\n      </button>\n      <button onClick={handleDeleteClick} data-testid={testIds.DELETE_LAYER_BUTTON}>\n        <Icon path={mdiDelete} size={0.65} />\n      </button>\n    </div>\n  );\n}\n\nexport default LayerListFooter;\n","import { useSelector, useDispatch } from 'react-redux';\nimport { getLayersByAddedTime } from 'redux/selectors';\nimport CollapseSection from 'ui/common/CollapseTab';\nimport LayerListItem from 'ui/sidebar/tileset/LayerListItem';\nimport LayerListFooter from 'ui/sidebar/tileset/LayerListFooter';\nimport { DragDropContext, Droppable } from 'react-beautiful-dnd';\nimport { selectLayer, moveLayer } from 'redux/actions';\n\nconst LayerList = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n\n  // ====================================\n  // Logic\n  // ====================================\n  const { selectedLayer, layers } =\n    useSelector(state => ({ selectedLayer: state.layers.selected, layers: getLayersByAddedTime(state) }));\n\n  const handleLayerBeforeDragStart = e => {\n    dispatch(selectLayer(e.draggableId));\n  }\n\n  const handleLayerDragEnd = e => {\n    dispatch(moveLayer(e.draggableId, layers.length - e.destination.index - 1));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  const layerComponents =\n    layers.map((l, i) => <LayerListItem key={l.name}\n                                        index={i}\n                                        layer={l}\n                                        isSelected={l.name === selectedLayer}\n                         />);\n\n  const dndArea = layers && layers.length\n    ? <DragDropContext onDragEnd={handleLayerDragEnd} onBeforeDragStart={handleLayerBeforeDragStart}>\n        <Droppable droppableId='layers'>\n          {(provided) => (\n            <ul {...provided.droppableProps} ref={provided.innerRef} className='border rounded-sm border-gray-700'>\n              {layerComponents}\n              {provided.placeholder}\n            </ul>\n          )}\n        </Droppable>\n      </DragDropContext>\n    : <div />;\n\n  return (\n    <CollapseSection title='Layers'>\n      {dndArea}\n      <LayerListFooter selectedLayer={selectedLayer} />\n    </CollapseSection>\n  );\n}\n\nexport default LayerList;\n","import { useDispatch } from 'react-redux';\nimport { deleteTileset } from 'redux/actions';\nimport { mdiDelete, mdiCog } from '@mdi/js';\nimport Icon from '@mdi/react';\nimport * as testIds from 'resources/testIds';\n\nconst TilesetFooter = ({ selectedTileset }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n\n  // ====================================\n  // Logic\n  // ====================================\n  const handleSettingsClick = () => {\n  }\n\n  const handleDeleteClick = () => {\n    dispatch(deleteTileset(selectedTileset));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div className='flex items-center justify-start'>\n      <button onClick={handleSettingsClick}>\n        <Icon path={mdiCog} size={0.6} />\n      </button>\n      <button onClick={handleDeleteClick}>\n        <Icon path={mdiDelete} size={0.65} />\n      </button>\n    </div>\n  );\n}\n\nexport default TilesetFooter;\n\n","import { useEffect, useState, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { getTextureData, hasTexture } from 'idbTextureStore';\nimport { selectTile } from 'redux/actions';\nimport { getTilePositionOnClick } from 'utils/tile';\nimport TilesetFooter from 'ui/sidebar/tileset/TilesetFooter';\nimport {\n  GRID_COLOR,\n  GRID_CANVAS_ID,\n  TILESET_CANVAS_ID,\n  SELECTED_TILE_COLOR_OVERLAY,\n} from 'ui/constants';\n\nconst tileSize = [32, 32];\n\nconst drawGridLines = (canvas, tileDimensions) => {\n  const context = canvas.getContext('2d');\n  context.strokeStyle = GRID_COLOR;\n  context.lineWidth = 1;\n\n  // Draw horizontal lines\n  for (let j = tileDimensions[0]; j < canvas.height; j += tileDimensions[0]) {\n    context.beginPath();\n    context.moveTo(0, j + 0.5);\n    context.lineTo(canvas.width, j + 0.5);\n    context.stroke();\n  }\n\n  // Draw vertical lines\n  for (let i = tileDimensions[1]; i < canvas.width; i += tileDimensions[1]) {\n    context.beginPath();\n    context.moveTo(i + 0.5, 0);\n    context.lineTo(i + 0.5, canvas.height);\n    context.stroke();\n  }\n}\n\nconst TilesetPreview = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const selectedTileset = useSelector(state => state.tileset.selectedTileset);\n  const [selectedTile, setSelectedTile] = useState([-1, -1]);\n  const [tilesetIndex, setTilesetIndex] = useState(0);\n  const tilegridCanvasRef = useRef(null);\n  const tilesetCanvasRef = useRef(null);\n\n  // ====================================\n  // Logic\n  // ====================================\n  // Load a new tileset to the preview\n  useEffect(() => {\n    if (!selectedTileset || selectedTileset === '' || !tilegridCanvasRef.current || !tilesetCanvasRef.current) {\n      return;\n    }\n\n    const tilesetCanvas = tilesetCanvasRef.current;\n    const tilegridCanvas = tilegridCanvasRef.current;\n\n    // Add image to canvas\n    getTextureData(selectedTileset).then(data => {\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        const image = new Image();\n        image.onload = () => {\n          tilesetCanvas.width = image.width;\n          tilesetCanvas.height = image.height;\n\n          tilegridCanvas.width = image.width;\n          tilegridCanvas.height = image.height;\n\n          const tilesetContext = tilesetCanvas.getContext('2d');\n          tilesetContext.drawImage(image, 0, 0);\n          drawGridLines(tilesetCanvas, tileSize);\n          setTilesetIndex(data.tilesetIndex);\n        }\n        image.src = e.target.result;\n      }\n      reader.readAsDataURL(data.file);\n    });\n  }, [selectedTileset]);\n\n  // Draw highlight on selected tile\n  useEffect(() => {\n    if (!tilegridCanvasRef.current) {\n      return;\n    }\n\n    const canvas = tilegridCanvasRef.current;\n    const context = canvas.getContext('2d');\n    // Draw square on selected tile\n    context.fillStyle = SELECTED_TILE_COLOR_OVERLAY;\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    context.fillRect(selectedTile[0] * tileSize[0] + 1,\n                     selectedTile[1] * tileSize[1] + 1,\n                     tileSize[0] - 1,\n                     tileSize[1] - 1);\n  }, [selectedTile]);\n\n  const onSelectTile = e => {\n    const tilePos = getTilePositionOnClick(e, tileSize);\n    const tileIndex = tilesetIndex + tilePos[1] * Math.floor(e.target.width / tileSize[0]) + tilePos[0]\n    dispatch(selectTile(tileIndex));\n    setSelectedTile(tilePos);\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  const tilesetPreview = selectedTileset === ''\n    ? <div />\n    : (<>\n         <div className='max-h-40 max-w-full overflow-scroll border inline-block rounded-sm mt-2'>\n           <div className='grid'>\n             <canvas id={GRID_CANVAS_ID} onMouseUp={onSelectTile} ref={tilegridCanvasRef} className='col-span-full row-span-full z-10 overflow-hidden' />\n             <canvas id={TILESET_CANVAS_ID} ref={tilesetCanvasRef} className='col-span-full row-span-full z-0 overflow-hidden' />\n           </div>\n         </div>\n         <TilesetFooter selectedTileset={selectedTileset} />\n       </>\n    );\n\n  return tilesetPreview;\n}\n\nexport default TilesetPreview;\n","import { SELECT_TAG } from 'resources/testIds';\n\nconst Select = ({ value, options, onChange }) => {\n  return (\n    <select\n      className='text-gray-400 w-full px-1 py-1 bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-sm'\n      value={value}\n      onChange={onChange}\n      data-testid={SELECT_TAG}\n    >\n      {options}\n    </select>\n  );\n}\n\nexport default Select;\n","import { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { selectTileset } from 'redux/actions';\nimport { LOCAL_STORAGE_LAST_SELECTED_TILESET } from 'ui/constants';\nimport Select from 'ui/common/Select';\n\nconst TilesetSelector = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const { selectedTileset, tilesetNames } = useSelector(state => state.tileset);\n\n  // ====================================\n  // Logic\n  // ====================================\n  // Get last tileset used from localStorage\n  useEffect(() => {\n    const lastSelectedTileset = localStorage.getItem(LOCAL_STORAGE_LAST_SELECTED_TILESET);\n\n    // TODO: Check if tileset exists\n    if (lastSelectedTileset && lastSelectedTileset !== '') {\n      dispatch(selectTileset(lastSelectedTileset));\n    }\n    else {\n      localStorage.setItem(LOCAL_STORAGE_LAST_SELECTED_TILESET, '');\n    }\n  }, [dispatch]);\n\n  const onOptionSelected = e => {\n    const name = e.target.value;\n    localStorage.setItem(LOCAL_STORAGE_LAST_SELECTED_TILESET, name);\n    dispatch(selectTileset(name));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  const options = [];\n  for (const value of tilesetNames) {\n    options.push(<option value={value} key={value} data-testid={value}>{value}</option>);\n  }\n\n  return (\n    tilesetNames.length > 0 &&\n    <Select value={selectedTileset} options={options} onChange={onOptionSelected} />\n  );\n}\n\nexport default TilesetSelector;\n","const Button = ({ text, onClick }) => {\n  return (\n    <div\n      className='cursor-pointer block bg-indigo-800 px-1 py-2 flex items-center text-center rounded-sm w-full'\n      onClick={onClick}\n    >\n      <p className='flex-1 text-white'>\n        {text}\n      </p>\n    </div>\n  );\n}\n\nexport default Button;\n","import Button from 'ui/common/Button';\n\nconst FileInput = ({ title, onUpload }) => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div>\n      <input\n        type='file'\n        name='tilesetFile'\n        id='tilesetFile'\n        min='1'\n        max='100'\n        value=''\n        onChange={onUpload}\n        style={{ width: '0.1px', height: '0.1px', opacity: 0, overflow: 'hidden', position: 'absolute', zIndex: '-1' }}\n      />\n      <label htmlFor='tilesetFile' className='block '>\n        <Button text='Choose a file...' />\n      </label>\n    </div>\n  );\n};\n\nexport default FileInput;\n","import { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { addTileset, loadExistingTilesets } from 'redux/actions';\nimport { setTextureData, getTextureNames, hasTexture } from 'idbTextureStore';\nimport LayerList from 'ui/sidebar/tileset/LayerList';\nimport TilesetPreview from 'ui/sidebar/tileset/TilesetPreview';\nimport TilesetSelector from 'ui/sidebar/tileset/TilesetSelector';\nimport TileManagerInstance from 'renderer/TileManager';\nimport CollapseSection from 'ui/common/CollapseTab';\nimport FileInput from 'ui/common/FileInput';\nimport {\n  ADD_TILESET_TITLE\n} from 'ui/constants';\n\nconst TilesetManager = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const dispatch = useDispatch();\n  const tilesetNames = useSelector(state => state.tileset.tilesetNames);\n\n  // ====================================\n  // Logic\n  // ====================================\n  // Load existing tilesets\n  useEffect(() => {\n    getTextureNames().then(textures => {\n      dispatch(loadExistingTilesets(textures));\n    }); // eslint-disable-next-line\n  }, []);\n\n  const onTilesetUpload = async (event) => {\n    // Return if file is invalid\n    if (event.target.files.length <= 0 || !event.target.files[0]) {\n      return;\n    }\n\n    dispatch(addTileset(event.target.files[0].name, event.target.files[0]));\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <CollapseSection title='Tileset'>\n      <TilesetSelector />\n      <div className='mt-2'>\n        <FileInput title={ADD_TILESET_TITLE} onUpload={e => onTilesetUpload(e) }/>\n      </div>\n      <TilesetPreview />\n    </CollapseSection>\n  );\n}\n\nexport default TilesetManager;\n","import Tab from 'ui/common/Tab';\nimport LayerList from 'ui/sidebar/tileset/LayerList';\nimport TilesetSettings from 'ui/sidebar/tileset/TilesetSettings';\n\nconst Edit = () => {\n  return (\n    <Tab title='Edit'>\n      <LayerList />\n      <TilesetSettings />\n    </Tab>\n  );\n}\n\nexport default Edit;\n","export default function SliderInput(props) {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div>\n      <p><strong>{props.title}</strong></p>\n      <span>{props.value}px</span>\n      <input\n        type='range'\n        min='1'\n        max='100'\n        value={props.value}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport Tab from 'ui/common/Tab';\nimport Slider from 'ui/common/SliderInput';\n\nconst MapSettings = (props) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const [tileSize, setTileSize] = useState(32);\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <Tab title='Map Settings'>\n      <Slider title=\"Tile size\" onChange={e => setTileSize(e.target.value)} value={tileSize} />\n    </Tab>\n  );\n}\n\nexport default MapSettings;\n","import Tab from 'ui/common/Tab';\n\nconst ImportSettings = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <Tab title='Import'>\n      <h3>Import</h3>\n    </Tab>\n  );\n}\n\nexport default ImportSettings;\n","import * as formats from 'ui/sidebar/export/formats';\nimport Select from 'ui/common/Select';\n\nconst FormatSelector = ({ format, onOptionSelected }) => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const formatsArray = [\n    formats.FORMAT_JSON,\n    formats.FORMAT_TMX,\n  ];\n\n  // ====================================\n  // Render\n  // ====================================\n  const formatOptions = formatsArray.map(format => <option key={format} value={format}>{format}</option>);\n\n  return (\n    <Select value={format} options={formatOptions} onChange={onOptionSelected} />\n  );\n}\n\nexport default FormatSelector;\n","export const FORMAT_JSON = 'json';\nexport const FORMAT_TMX = 'tmx';\n","import { useState } from 'react';\nimport Tab from 'ui/common/Tab';\nimport * as formats from 'ui/sidebar/export/formats';\nimport TilemapInstance from 'tilemap';\nimport FormatSelector from 'ui/sidebar/export/FormatSelector';\nimport Button from 'ui/common/Button';\n\nconst ExportSettings = () => {\n  // ====================================\n  // Initialize\n  // ====================================\n  const [format, setFormat] = useState(formats.FORMAT_TMX);\n\n  // ====================================\n  // Logic\n  // ====================================\n  const onOptionSelected = e => {\n    setFormat(e.target.value);\n  }\n\n  const handleExport = async () => {\n    const rawData = TilemapInstance.dump(format);\n    const filename = 'tilemap.' + format;\n    const blob = new Blob([rawData], {type : 'application/xml'});\n    const a = document.createElement('a');\n\n    a.href = URL.createObjectURL(blob);\n    a.download =  filename;\n    a.click();\n  }\n\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <Tab title='Export Map'>\n      <FormatSelector format={format} onOptionSelected={onOptionSelected} />\n      <Button text='Export' onClick={handleExport} />\n    </Tab>\n  );\n}\n      //<button className='bg-indigo-900 my-3 py-2 px-4 flex justify-center rounded cursor-pointer'\n              //onClick={handleExport}\n      //>\n        //Export\n      //</button>\n\nexport default ExportSettings;\n","import Tab from 'ui/common/Tab';\n\nconst ProjectSettings = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <Tab title='Project Settings'>\n      <label htmlFor='show-grid'>Show grid</label>\n      <input type='checkbox' name='show-grid' />\n    </Tab>\n  );\n}\n\nexport default ProjectSettings;\n","import Tab from 'ui/common/Tab';\n\nconst Help = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <Tab title='Help'>\n    </Tab>\n  );\n}\n\nexport default Help;\n\n","import TabSelector from 'ui/sidebar/TabSelector';\nimport Edit from 'ui/sidebar/tileset/Edit';\nimport MapSettings from 'ui/sidebar/map/MapSettings';\nimport ImportSettings from 'ui/sidebar/import/ImportSettings';\nimport ExportSettings from 'ui/sidebar/export/ExportSettings';\nimport ProjectSettings from 'ui/sidebar/project/ProjectSettings';\nimport Help from 'ui/sidebar/Help';\nimport { Switch, Route } from \"react-router-dom\";\nimport { dividerBorderColor } from 'ui/common/styles';\nimport * as tabs from './tabs';\n\nconst Sidebar = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <aside className={`flex flex-row bg-gray-900 border-r border-b ${dividerBorderColor}`}>\n      <TabSelector />\n        <Switch>\n          <Route path={`/${tabs.TAB_TILES}`}>\n            <Edit />\n          </Route>\n\n          <Route path={`/${tabs.TAB_MAP}`}>\n            <MapSettings />\n          </Route>\n\n          <Route path={`/${tabs.TAB_IMPORT}`}>\n            <ImportSettings />\n          </Route>\n\n          <Route path={`/${tabs.TAB_EXPORT}`}>\n            <ExportSettings />\n          </Route>\n\n          <Route path={`/${tabs.TAB_SETTINGS}`}>\n            <ProjectSettings />\n          </Route>\n\n          <Route path={`/${tabs.TAB_HELP}`}>\n            <Help />\n          </Route>\n        </Switch>\n    </aside>\n  );\n};\n\nexport default Sidebar;\n","import Canvas from 'ui/canvas/Canvas';\nimport Sidebar from 'ui/sidebar/Sidebar';\nimport { HashRouter } from \"react-router-dom\";\nimport { dividerBorderColor } from 'ui/common/styles';\n\nconst App = () => {\n  // ====================================\n  // Render\n  // ====================================\n  return (\n    <div className={`h-screen w-screen flex flex-col text-gray-50 bg-gray-900 border-l border-t ${dividerBorderColor} text-gray-100`}>\n      <main className='flex-1 grid grid-cols-4'>\n        <HashRouter>\n          <Sidebar />\n        </HashRouter>\n        <Canvas />\n      </main>\n    </div>\n  );\n};\n\nexport default App;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport App from 'ui/App';\nimport store from 'redux/store';\n\nimport 'index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}